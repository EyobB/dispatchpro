import{a as G}from"./chunk-EFQSH5YV.js";import{a as z}from"./chunk-OV624ATH.js";import{a as K}from"./chunk-S57OZ2R5.js";import{a as J}from"./chunk-3QMJAE3L.js";import{a as S}from"./chunk-7GTRUKFK.js";import{b as A,d as R,g as L,l as j,m as B,n as U,u as q}from"./chunk-2PVWNWUN.js";import{a as H}from"./chunk-LIL63FBP.js";import{a as P}from"./chunk-OXCJF6DH.js";import"./chunk-NBSK5KUW.js";import{a as O}from"./chunk-IMHYAPIP.js";import"./chunk-XPCCV2FB.js";import{c as V,e as W,f as N}from"./chunk-3TOGTSGL.js";import"./chunk-FSJQQIFH.js";import{l as M,m as F}from"./chunk-QAAQ2EEP.js";import{$ as w,Ab as D,Cb as E,Eb as g,Fb as _,Gb as f,La as s,Qa as m,Qb as I,Va as b,_ as h,_a as d,a as y,gb as u,kb as o,lb as n,pb as T,sb as v,tb as p,x,yb as C,zb as l}from"./chunk-QJGZKU5F.js";var k=class{id;dotNumber;plate;trailerPlate;type;driver;insuredUntil;documents;warnings=[];constructor(){this.id="",this.dotNumber="",this.plate="",this.type="",this.driver=null,this.insuredUntil=null,this.documents=[],this.trailerPlate="",this.warnings=[]}};function X(c,e){if(c&1&&(o(0,"option",19),l(1),n()),c&2){let t=e.$implicit;u("ngValue",t),s(),D(t.name)}}function Y(c,e){if(c&1&&(o(0,"option",20),l(1),n()),c&2){let t=e.$implicit;u("value",t),s(),D(t)}}function Z(c,e){if(c&1&&(o(0,"li"),l(1),n()),c&2){let t=e.$implicit;s(),D(t)}}function $(c,e){if(c&1&&(o(0,"div",21)(1,"strong"),l(2,"Warnings:"),n(),o(3,"ul",22),d(4,Z,2,1,"li",23),n()()),c&2){let t=p();s(4),u("ngForOf",t.truck.warnings)}}function ee(c,e){c&1&&(o(0,"span",32),l(1,"\u26A0\uFE0F"),n())}function te(c,e){if(c&1){let t=T();o(0,"li")(1,"a",29),v("click",function(){let a=h(t).$implicit,r=p(3);return w(r.viewDocument(a))}),l(2),n(),d(3,ee,2,0,"span",30),o(4,"button",31),v("click",function(){let a=h(t).$implicit,r=p(3);return w(r.deleteDocument(a.id))}),l(5," Delete "),n()()}if(c&2){let t=e.$implicit,i=p(3);s(2),E(" ",t.documentType," (",t.expires?"Exp: "+t.expires:"No Expiry",") "),s(),u("ngIf",i.expiryWarning(t))}}function ie(c,e){if(c&1&&(o(0,"div")(1,"ul",28),d(2,te,6,3,"li",23),n()()),c&2){let t=p(2);s(2),u("ngForOf",t.truck.documents)}}function re(c,e){c&1&&(o(0,"div",33),l(1,"No documents available."),n())}function ne(c,e){if(c&1){let t=T();o(0,"div")(1,"div",24),l(2,"Documents:"),n(),d(3,ie,3,1,"div",25)(4,re,2,0,"ng-template",null,0,I),o(6,"div",26)(7,"app-add-document",27),v("documentAdded",function(a){h(t);let r=p();return w(r.addDocument(a))}),n()()()}if(c&2){let t=C(5),i=p();s(3),u("ngIf",i.truck.documents&&i.truck.documents.length>0)("ngIfElse",t),s(4),u("truckId",i.truck.id)("documentTypes",i.documentTypes)}}var Q=class c{constructor(e,t,i,a,r,oe,ce){this.route=e;this.router=t;this.trucksService=i;this.settingsService=a;this.documentsService=r;this.driversService=oe;this.toastService=ce}truck=new k;newTruck=!1;drivers=[];truckTypes=["Reefer","Dry Van","Flatbed","Box Truck","Tanker","Step Deck"];documentTypes=["Insurance","Registration","CDL"];newDocument={type:"",url:""};selectedFile=null;showDocumentViewer=!1;currentDocument=new S;ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(!e)throw new Error("Truck ID is required");this.settingsService.getSettings().subscribe(t=>{this.documentTypes=t.truckDocuments}),e==="new"?(this.newTruck=!0,this.truck=new k):x({truck:this.trucksService.getTruck(e),drivers:this.driversService.getDrivers()}).subscribe(({truck:t,drivers:i})=>{this.truck=t,this.drivers=i})}onFileSelected(e){let t=e.target;t.files&&t.files.length>0&&(this.selectedFile=t.files[0],this.newDocument.url=this.selectedFile.name)}addDocument(e){e.documentType&&e.url&&e.expires&&(this.truck.documents=this.truck.documents||[],this.truck.documents.push(y({},e)))}deleteDocument(e){e&&this.documentsService.deleteDocument(e).subscribe({next:()=>{this.toastService.showSuccess("Document deleted successfully"),this.truck.documents=this.truck.documents.filter(t=>t.id!==e)},error:t=>{console.error("Error deleting document:",t),this.toastService.showError("Failed to delete document")}})}expiryWarning(e){if(!e.expires)return!1;let t=this.truck.documents.filter(r=>r.documentType===e.documentType),i=new Date,a=new Date;return a.setMonth(i.getMonth()+1),t.every(r=>new Date(r.expires)<a)}saveTruckDetails(){this.truck.id?this.trucksService.updateTruck(this.truck).subscribe({next:e=>{this.toastService.showSuccess("Truck updated successfully"),this.router.navigate(["/dispatcher/trucks"])},error:e=>{console.error("Error updating truck:",e),this.toastService.showError("Failed to update truck")}}):this.trucksService.addTruck(this.truck).subscribe({next:e=>{this.truck=e,this.toastService.showSuccess("Truck created successfully"),this.router.navigate(["/dispatcher/trucks"])},error:e=>{console.error("Error creating truck:",e),this.toastService.showError("Failed to create truck")}})}viewDocument(e){this.currentDocument=e,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new S}onDownloadError(e){console.error("Download failed:",e),this.toastService.showError("Failed to download document")}static \u0275fac=function(t){return new(t||c)(m(V),m(W),m(z),m(K),m(H),m(O),m(P))};static \u0275cmp=b({type:c,selectors:[["app-truck-detail"]],decls:39,vars:11,consts:[["noDocs",""],[1,"mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],["routerLink","/dispatcher/trucks",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium","mb-4"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],[1,"mb-6","grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"font-semibold"],["type","text",1,"border","rounded","p-2","w-full","mb-2",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-x-2"],[1,"border","rounded","p-2","w-full","mb-2",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],[3,"value",4,"ngFor","ngForOf"],[1,"mb-6"],["class","bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-2 rounded mb-4",4,"ngIf"],[1,"flex","gap-4","mb-4"],[1,"bg-green-600","hover:bg-green-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[4,"ngIf"],[3,"close","downloadError","document","isVisible"],[3,"ngValue"],[3,"value"],[1,"bg-yellow-100","border","border-yellow-400","text-yellow-700","px-4","py-2","rounded","mb-4"],[1,"list-disc","pl-5"],[4,"ngFor","ngForOf"],[1,"font-semibold","mb-2"],[4,"ngIf","ngIfElse"],[1,"py-2","w-1/2"],[3,"documentAdded","truckId","documentTypes"],[1,"list-disc","pl-5","space-y-1"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],["class","ml-2 text-yellow-500 align-middle",4,"ngIf"],[1,"ml-2","text-red-500","hover:text-red-700",3,"click"],[1,"ml-2","text-yellow-500","align-middle"],[1,"italic","text-gray-500"]],template:function(t,i){t&1&&(o(0,"div",1)(1,"a",2)(2,"span",3),l(3,"\u2190"),n(),l(4," Back to Trucks "),n(),o(5,"h2",4)(6,"span"),l(7,"\u{1F69A}"),n(),l(8," Truck Details "),n(),o(9,"div",5)(10,"div")(11,"div",6),l(12,"DOT #:"),n(),o(13,"input",7),f("ngModelChange",function(r){return _(i.truck.dotNumber,r)||(i.truck.dotNumber=r),r}),n(),o(14,"div",8)(15,"div",6),l(16,"Plate:"),n(),o(17,"div",6),l(18,"Trailer Plate:"),n(),o(19,"input",7),f("ngModelChange",function(r){return _(i.truck.plate,r)||(i.truck.plate=r),r}),n(),o(20,"input",7),f("ngModelChange",function(r){return _(i.truck.trailerPlate,r)||(i.truck.trailerPlate=r),r}),n()()(),o(21,"div")(22,"div",6),l(23,"Assigned Driver:"),n(),o(24,"select",9),f("ngModelChange",function(r){return _(i.truck.driver,r)||(i.truck.driver=r),r}),o(25,"option",10),l(26,"Select Driver"),n(),d(27,X,2,2,"option",11),n(),o(28,"div",6),l(29,"Type:"),n(),o(30,"select",9),f("ngModelChange",function(r){return _(i.truck.type,r)||(i.truck.type=r),r}),d(31,Y,2,2,"option",12),n()()(),o(32,"div",13),d(33,$,5,1,"div",14),o(34,"div",15)(35,"button",16),v("click",function(){return i.saveTruckDetails()}),l(36," Save Truck "),n()(),d(37,ne,8,4,"div",17),n()(),o(38,"app-document-viewer",18),v("close",function(){return i.closeDocumentViewer()})("downloadError",function(r){return i.onDownloadError(r)}),n()),t&2&&(s(13),g("ngModel",i.truck.dotNumber),s(6),g("ngModel",i.truck.plate),s(),g("ngModel",i.truck.trailerPlate),s(4),g("ngModel",i.truck.driver),s(3),u("ngForOf",i.drivers),s(3),g("ngModel",i.truck.type),s(),u("ngForOf",i.truckTypes),s(2),u("ngIf",i.truck.warnings&&i.truck.warnings.length>0),s(4),u("ngIf",!i.newTruck),s(),u("document",i.currentDocument)("isVisible",i.showDocumentViewer))},dependencies:[F,M,N,q,B,U,A,j,R,L,G,J],encapsulation:2})};export{Q as TruckDetailComponent};
