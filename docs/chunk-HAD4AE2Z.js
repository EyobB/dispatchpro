import{a as ie}from"./chunk-MSIQXZHU.js";import{a as re}from"./chunk-PM57GPI3.js";import{a as ne}from"./chunk-4CWGDVG7.js";import{a as te}from"./chunk-6QKKABF2.js";import{b as ee}from"./chunk-DDEBU2FK.js";import{a as oe}from"./chunk-D7DOKIYQ.js";import{a as Y}from"./chunk-SMTY5PGD.js";import{a as T,c as k}from"./chunk-7GTRUKFK.js";import{a as $}from"./chunk-DGRNXT7C.js";import{b as G,d as J,g as q,i as z,l as H,m as K,n as Q,u as X}from"./chunk-VDT5TDP2.js";import"./chunk-7LAHPUI6.js";import{a as Z}from"./chunk-A3LUHI23.js";import"./chunk-25LA7BX7.js";import{a as B}from"./chunk-ZTGCRYCC.js";import"./chunk-XPCCV2FB.js";import{c as L,e as j,f as R,j as U}from"./chunk-KM6ROI6B.js";import"./chunk-2DXK6GBI.js";import{l as P,m as W}from"./chunk-TKJYB7RJ.js";import{$ as _,Ab as x,Bb as w,Cb as I,Db as b,Eb as S,Fb as C,Ib as A,Ka as l,Pa as v,Ua as M,Za as p,_ as g,a as O,fb as s,hb as F,ib as N,jb as n,kb as e,lb as E,ob as f,rb as u,sb as m,x as V,yb as i,zb as D}from"./chunk-ITTAAY47.js";var le=d=>["/order-checkins-map",d];function ae(d,r){if(d&1&&(n(0,"option",36),i(1),e()),d&2){let t=r.$implicit;s("value",t.id),l(),x(" ",t.name," ")}}function se(d,r){if(d&1&&(n(0,"div",37)(1,"div"),i(2),e(),n(3,"div"),i(4),e()()),d&2){let t=m();l(2),D(t.selectedDriver==null?null:t.selectedDriver.phone),l(2),w("License: ",t.selectedDriver==null?null:t.selectedDriver.licenseState," - ",t.selectedDriver==null?null:t.selectedDriver.licenseNumber,"")}}function ce(d,r){if(d&1&&(n(0,"option",36),i(1),e()),d&2){let t=r.$implicit;s("value",t.id),l(),w(" ",t.plate," - ",t.type," ")}}function me(d,r){if(d&1&&(n(0,"div",37)(1,"div"),i(2),e(),n(3,"div"),i(4),e()()),d&2){let t=m();l(2),D(t.selectedTruck==null?null:t.selectedTruck.type),l(2),x("DOT: ",t.selectedTruck==null?null:t.selectedTruck.dotNumber,"")}}function pe(d,r){if(d&1){let t=f();n(0,"button",38),u("click",function(){g(t);let a=m();return _(a.assignDriverTruck())}),i(1," Assign Driver & Truck "),e()}if(d&2){let t=m();N(!t.order.driverId||!t.order.truckId?"bg-gray-300 text-gray-500 cursor-not-allowed p-2 my-2 rounded":"bg-green-600 hover:bg-green-700 text-white p-2 my-2 rounded"),s("disabled",!t.order.driverId||!t.order.truckId)}}function ue(d,r){if(d&1){let t=f();n(0,"li")(1,"a",41),u("click",function(){let a=g(t).$implicit,c=m(2);return _(c.viewDocument(a))}),i(2),e()()}if(d&2){let t=r.$implicit;l(2),w(" ",t.documentType," (",t.fileName,") ")}}function ve(d,r){if(d&1&&(n(0,"div")(1,"ul",39),p(2,ue,3,2,"li",40),e()()),d&2){let t=m();l(2),s("ngForOf",t.order.documents)}}function ge(d,r){if(d&1){let t=f();n(0,"div",42)(1,"app-add-document",43),u("documentAdded",function(a){g(t);let c=m();return _(c.addDocument(a))}),e()()}if(d&2){let t=m();l(),s("orderId",t.order.id)("documentTypes",t.documentTypes)}}function _e(d,r){if(d&1){let t=f();n(0,"div",44)(1,"div",45)(2,"span",13),i(3),e(),n(4,"input",46),C("ngModelChange",function(a){let c=g(t).$implicit;return S(c.amount,a)||(c.amount=a),_(a)}),e()()()}if(d&2){let t=r.$implicit;F("opacity-60",t.amount===0),l(3),D(t.description),l(),b("ngModel",t.amount)}}function fe(d,r){d&1&&(n(0,"li",52)(1,"span",53),i(2,"\u2022"),e(),i(3," Driver must be selected "),e())}function xe(d,r){d&1&&(n(0,"li",52)(1,"span",53),i(2,"\u2022"),e(),i(3," Truck must be selected "),e())}function he(d,r){d&1&&(n(0,"li",52)(1,"span",53),i(2,"\u2022"),e(),i(3," Proof of Delivery (PoD) document must be uploaded "),e())}function De(d,r){d&1&&(n(0,"li",52)(1,"span",53),i(2,"\u2022"),e(),i(3," PoD # must be entered "),e())}function be(d,r){if(d&1&&(n(0,"div",47)(1,"div",48)(2,"p",49),i(3,"Cannot convert to invoice:"),e(),n(4,"ul",50),p(5,fe,4,0,"li",51)(6,xe,4,0,"li",51)(7,he,4,0,"li",51)(8,De,4,0,"li",51),e()()()),d&2){let t=m();l(5),s("ngIf",!t.order.driverId),l(),s("ngIf",!t.order.truckId),l(),s("ngIf",!t.isPodUploaded),l(),s("ngIf",!t.order.podNumber)}}function Se(d,r){if(d&1){let t=f();n(0,"button",54),u("click",function(){g(t);let a=m();return _(a.updateOrder())}),i(1," Update Order "),e()}}function Ce(d,r){if(d&1){let t=f();n(0,"button",55),u("click",function(){g(t);let a=m();return _(a.createInvoice())}),i(1," Convert To Invoice "),e()}if(d&2){let t=m();s("disabled",!t.isValidForInvoice())}}function we(d,r){if(d&1){let t=f();n(0,"button",56),u("click",function(){g(t);let a=m();return _(a.deleteOrder())}),i(1," Delete Order "),e()}}var de=class d{constructor(r,t,o,a,c,y,h,ye){this.router=r;this.route=t;this.ordersService=o;this.driversService=a;this.trucksService=c;this.settingsService=y;this.invoiceService=h;this.toastService=ye}order=new ee;podUrl=null;availableDrivers=[];availableTrucks=[];selectedDriver=null;selectedTruck=null;costTypes=[];isUploading=!1;uploadError=null;showDocumentViewer=!1;currentDocument=new T;documentTypes=[k.RATE_CON];ngOnInit(){let r=this.route.snapshot.paramMap.get("id")||"";V({order:this.ordersService.getOrder(r),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks(),settings:this.settingsService.getSettings()}).subscribe(({order:t,drivers:o,trucks:a,settings:c})=>{this.order=t,this.availableDrivers=o,this.availableTrucks=a,this.onDriverSelect(),this.onTruckSelect(),this.costTypes=c.driverCosts,this.costTypes=c.driverCosts,this.costTypes.forEach(y=>{if(this.order.driverCosts=this.order.driverCosts||[],!this.order.driverCosts.some(h=>h.description===y)){let h=new ie;h.description=y,h.amount=0,this.order.driverCosts.push(h)}})})}updateOrder(){this.order.driverId=this.order.driverId||null,this.order.truckId=this.order.truckId||null,this.ordersService.updateOrder(this.order).subscribe(()=>{this.toastService.showSuccess("Order updated successfully")},r=>{console.error("Error updating order:",r)})}assignDriverTruck(){this.ordersService.assignDriver(this.order).subscribe(()=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},r=>{console.error("Error assigning driver and truck:",r)})}markDelivered(){this.order&&(this.order.status="Delivered")}get isPodUploaded(){return this.order.documents?.some(r=>r.documentType===k.POD)??!1}markInTransit(){this.order&&(this.order.status="In Transit")}deleteOrder(){this.order&&confirm("Are you sure you want to delete this order?")&&this.ordersService.deleteOrder(this.order.id).subscribe(()=>{this.toastService.showSuccess("Order deleted successfully"),this.router.navigate(["/dispatcher/orders"])},r=>{console.error("Error deleting order:",r),this.toastService.showError("Failed to delete order")})}removePod(){confirm("Are you sure you want to remove the PoD document?")&&(this.order.documents&&(this.order.documents=this.order.documents.filter(r=>r.documentType!=="PoD")),this.podUrl=null)}addDocument(r){r.documentType&&r.url&&r.expires&&(this.order.documents=this.order.documents||[],this.order.documents.push(O({},r)))}createInvoice(){this.ordersService.updateOrder(this.order).subscribe(()=>{this.invoiceService.createInvoice(this.order.id).subscribe(r=>{this.router.navigate(["/dispatcher/carrier-invoices",r.id])},r=>{console.error("Error creating invoice:",r),this.toastService.showError("Failed to create invoice")})},r=>{console.error("Error updating order:",r)})}onDriverSelect(){this.selectedDriver=this.availableDrivers.find(r=>r.id===this.order.driverId)??null}onTruckSelect(){this.selectedTruck=this.availableTrucks.find(r=>r.id===this.order.truckId)??null}isValidForInvoice(){return!!(this.order.driverId&&this.order.truckId&&this.isPodUploaded&&this.order.podNumber&&!this.isOrderComplete())}isOrderComplete(){return this.order.status==="Completed"}viewDocument(r){this.currentDocument=r,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new T}onDownloadError(r){console.error("Download failed:",r),this.toastService.showError("Failed to download document")}static \u0275fac=function(t){return new(t||d)(v(j),v(L),v($),v(B),v(te),v(ne),v(oe),v(Z))};static \u0275cmp=M({type:d,selectors:[["app-order-detail"]],decls:116,vars:33,consts:[[1,"max-w-3xl","mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"text-3xl","font-bold","mb-2","text-green-900","flex","items-center","gap-2"],[1,"mb-4","flex","gap-2","text-gray-600"],[1,"bg-gray-100","px-3","py-1","rounded"],[1,"font-medium"],[1,"flex-1"],[1,"bg-blue-100","px-3","py-1","rounded","hover:bg-blue-200","transition",3,"routerLink"],[1,"text-blue-600"],["routerLink","/dispatcher/orders",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"mb-4","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"font-semibold"],[1,"mb-4"],[1,"flex","flex-col","sm:flex-row","gap-8"],[1,"flex-1","bg-gray-50","rounded","p-4"],[1,"text-xs","text-gray-500"],[1,"mt-2"],[1,"w-full","p-2","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-2 p-2 mt-0 pt-0 bg-white rounded shadow-sm text-xs text-gray-900",4,"ngIf"],[3,"disabled","class","click",4,"ngIf"],[4,"ngIf"],["class","py-2 w-1/2",4,"ngIf"],[1,"w-36","p-1","mb-4","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"mb-4","flex-row"],[1,"space-y-0","w-1/2"],["class","bg-gray-50 p-2 rounded transition-colors",3,"opacity-60",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],["class","w-full mb-4",4,"ngIf"],["class","bg-green-600 text-white px-6 py-2 rounded shadow font-semibold transition",3,"click",4,"ngIf"],["class","px-6 py-2 rounded shadow font-semibold transition bg-green-600 hover:bg-green-700 text-white",3,"disabled","click",4,"ngIf"],["class","bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded shadow font-semibold transition",3,"click",4,"ngIf"],[3,"close","downloadError","document","isVisible"],[3,"value"],[1,"mt-2","p-2","mt-0","pt-0","bg-white","rounded","shadow-sm","text-xs","text-gray-900"],[3,"click","disabled"],[1,"list-disc","pl-5","space-y-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],[1,"py-2","w-1/2"],[3,"documentAdded","orderId","documentTypes"],[1,"bg-gray-50","p-2","rounded","transition-colors"],[1,"flex","justify-between","items-center","mb-1"],["type","number","placeholder","0.00",1,"w-36","p-1","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-red-50","border","border-red-200","rounded","p-3"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","space-y-1"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500"],[1,"bg-green-600","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"px-6","py-2","rounded","shadow","font-semibold","transition","bg-green-600","hover:bg-green-700","text-white",3,"click","disabled"],[1,"bg-red-600","hover:bg-red-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"]],template:function(t,o){t&1&&(n(0,"div",0)(1,"h2",1)(2,"span"),i(3,"\u{1F4E6}"),e(),i(4," Order Details "),e(),n(5,"div",2)(6,"div",3)(7,"span",4),i(8,"Order #:"),e(),i(9),e(),n(10,"div",3)(11,"span",4),i(12,"Load #:"),e(),i(13),e(),E(14,"div",5),n(15,"a",6)(16,"span",4),i(17,"View Map"),e(),n(18,"span",7),i(19,"\u{1F4CD}"),e()(),n(20,"a",8)(21,"span",9),i(22,"\u2190"),e(),i(23," Go Back "),e()(),n(24,"div",10)(25,"h3",11)(26,"span"),i(27,"\u{1F464}"),e(),i(28," Customer Information "),e(),n(29,"div",12)(30,"div")(31,"span",13),i(32,"Name:"),e(),i(33),e(),n(34,"div")(35,"span",13),i(36,"Contact:"),e(),i(37),e()()(),n(38,"div",14)(39,"h3",11)(40,"span"),i(41,"\u{1F5FA}\uFE0F"),e(),i(42," Route "),e(),n(43,"div",15)(44,"div",16)(45,"span",13),i(46,"Origin:"),e(),n(47,"div",4),i(48),e(),n(49,"div",17),i(50),e()(),n(51,"div",16)(52,"span",13),i(53,"Destination:"),e(),n(54,"div",4),i(55),e(),n(56,"div",17),i(57),e()()()(),n(58,"div",14)(59,"h3",11)(60,"span"),i(61,"\u{1F4E6}"),e(),i(62," Load Details "),e(),n(63,"div")(64,"span",13),i(65,"Description:"),e(),i(66),e()(),n(67,"div",14)(68,"h3",11)(69,"span"),i(70,"\u{1F9D1}\u200D\u2708\uFE0F"),e(),i(71," Driver & Truck "),e(),n(72,"div",15)(73,"div",5)(74,"span",13),i(75,"Driver: "),e(),n(76,"div",18)(77,"select",19),C("ngModelChange",function(c){return S(o.order.driverId,c)||(o.order.driverId=c),c}),u("change",function(){return o.onDriverSelect()}),n(78,"option",20),i(79,"Select a driver"),e(),p(80,ae,2,2,"option",21),e(),p(81,se,5,3,"div",22),e()(),n(82,"div",5)(83,"span",13),i(84,"Truck: "),e(),n(85,"div",18)(86,"select",19),C("ngModelChange",function(c){return S(o.order.truckId,c)||(o.order.truckId=c),c}),u("change",function(){return o.onTruckSelect()}),n(87,"option",20),i(88,"Select a truck"),e(),p(89,ce,2,3,"option",21),e(),p(90,me,5,2,"div",22),e()()(),p(91,pe,2,3,"button",23),e(),n(92,"div",14)(93,"h3",11)(94,"span"),i(95,"\u{1F4C4}"),e(),i(96," Documents "),e(),p(97,ve,3,1,"div",24),e(),p(98,ge,2,2,"div",25),n(99,"span",13),i(100,"PoD #:"),e(),E(101,"br"),n(102,"input",26),C("ngModelChange",function(c){return S(o.order.podNumber,c)||(o.order.podNumber=c),c}),e(),n(103,"div",27)(104,"h3",11)(105,"span"),i(106,"\u{1F4B2}"),e(),i(107," Driver Costs "),e(),n(108,"div",28),p(109,_e,5,4,"div",29),e()(),n(110,"div",30),p(111,be,9,4,"div",31)(112,Se,2,0,"button",32)(113,Ce,2,1,"button",33)(114,we,2,0,"button",34),e()(),n(115,"app-document-viewer",35),u("close",function(){return o.closeDocumentViewer()})("downloadError",function(c){return o.onDownloadError(c)}),e()),t&2&&(l(9),x(" ",o.order.orderNumber," "),l(4),x(" ",o.order.loadNumber," "),l(2),s("routerLink",A(31,le,o.order.id)),l(18),x(" ",o.order.brokerName,""),l(4),x(" ",o.order.brokerContact,""),l(11),D(o.order.originStreetAddress),l(2),I("",o.order.originCity,", ",o.order.originState," ",o.order.originZipcode," "),l(5),D(o.order.destinationStreetAddress),l(2),I("",o.order.destinationCity,", ",o.order.destinationState," ",o.order.destinationZipcode,""),l(9),x(" ",o.order.description," "),l(11),b("ngModel",o.order.driverId),l(3),s("ngForOf",o.availableDrivers),l(),s("ngIf",o.order.driverId),l(5),b("ngModel",o.order.truckId),l(3),s("ngForOf",o.availableTrucks),l(),s("ngIf",o.order.truckId),l(),s("ngIf",!o.isOrderComplete()),l(6),s("ngIf",o.order.documents&&o.order.documents.length>0),l(),s("ngIf",!o.isOrderComplete()),l(4),b("ngModel",o.order.podNumber),l(7),s("ngForOf",o.order.driverCosts),l(2),s("ngIf",!o.isValidForInvoice()&&!o.isOrderComplete()),l(),s("ngIf",!o.isOrderComplete()),l(),s("ngIf",o.isValidForInvoice()),l(),s("ngIf",!o.isOrderComplete()),l(),s("document",o.currentDocument)("isVisible",o.showDocumentViewer))},dependencies:[W,P,U,R,X,K,Q,G,z,H,J,q,re,Y],encapsulation:2})};export{de as OrderDetailComponent};
