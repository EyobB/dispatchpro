import{a as u}from"./chunk-IMHYAPIP.js";import{a as f}from"./chunk-XPCCV2FB.js";import{b as d}from"./chunk-FSJQQIFH.js";import{L as m,O as p,T as s,n as a,r as c,z as g}from"./chunk-QJGZKU5F.js";var v=class i{constructor(o,e){this.http=o;this.driversService=e}logout(){localStorage.removeItem("loggedInUser")}getLoggedInUser(){let o=localStorage.getItem("loggedInUser");if(!o)return null;let e=JSON.parse(o);if(e&&e.token){let t=this.extractRolesFromToken(e.token);t&&(e.roles=t)}return e}getCurrentDriverId(){return localStorage.getItem("driverId")??null}extractRolesFromToken(o){try{let e=o.split(".")[1],t=JSON.parse(atob(e)),r=t.roles||t.role||t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]||t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role"];return typeof r=="string"?[r]:Array.isArray(r)?r:null}catch(e){return console.error("Error decoding token:",e),null}}login(o,e){let t={email:o,password:e};return this.http.post(`${f.apiUrl}/Auth/login`,t).pipe(c(r=>{if(r){localStorage.setItem("loggedInUser",JSON.stringify(r));let n=this.extractRolesFromToken(r.token);return n&&(r.roles=n,n.includes("Driver")&&this.driversService.getDriverByEmail(r?.email).pipe(m(l=>{l?localStorage.setItem("driverId",l.id):localStorage.removeItem("driverId")})).subscribe()),r}return null}),g(r=>(console.error("Login failed:",r),a(null))))}isLoggedIn(){return this.getLoggedInUser()!==null}isMobileScreen(){return window.innerWidth<768}static \u0275fac=function(e){return new(e||i)(s(d),s(u))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{v as a};
