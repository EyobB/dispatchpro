import{a as K}from"./chunk-4JJQQMPF.js";import{a as z}from"./chunk-TBJVONL5.js";import{a as G}from"./chunk-VXI25XYZ.js";import{a as J}from"./chunk-NIADREZY.js";import{a as y}from"./chunk-CFVKQP3S.js";import{b as A,d as R,g as L,l as j,m as B,n as U,u as q}from"./chunk-SVMRWARE.js";import{a as H}from"./chunk-MWYPBBRY.js";import{a as P}from"./chunk-DA7YCHM5.js";import"./chunk-U7GEWMPU.js";import{a as O}from"./chunk-N2E3WRFD.js";import"./chunk-IRZ6KZAB.js";import{c as V,e as W,f as N}from"./chunk-KA6K7UZ3.js";import"./chunk-GDLZFIOX.js";import{l as M,m as F}from"./chunk-GEVPNXBN.js";import{Bb as g,Cb as _,Db as f,Ja as l,Nb as I,Oa as m,Ta as b,Y as h,Ya as d,Z as w,a as S,eb as u,ib as c,jb as n,nb as T,qb as v,rb as p,v as x,vb as C,wb as s,xb as D,zb as E}from"./chunk-YSP72ENP.js";var k=class{id;dotNumber;plate;trailerPlate;type;driver;insuredUntil;documents;warnings=[];constructor(){this.id="",this.dotNumber="",this.plate="",this.type="",this.driver=null,this.insuredUntil=null,this.documents=[],this.trailerPlate="",this.warnings=[]}};function X(o,e){if(o&1&&(c(0,"option",18),s(1),n()),o&2){let t=e.$implicit;u("ngValue",t),l(),D(t.name)}}function Y(o,e){if(o&1&&(c(0,"option",19),s(1),n()),o&2){let t=e.$implicit;u("value",t),l(),D(t)}}function Z(o,e){if(o&1&&(c(0,"li"),s(1),n()),o&2){let t=e.$implicit;l(),D(t)}}function $(o,e){if(o&1&&(c(0,"div",20)(1,"strong"),s(2,"Warnings:"),n(),c(3,"ul",21),d(4,Z,2,1,"li",22),n()()),o&2){let t=p();l(4),u("ngForOf",t.truck.warnings)}}function ee(o,e){o&1&&(c(0,"span",31),s(1,"\u26A0\uFE0F"),n())}function te(o,e){if(o&1){let t=T();c(0,"li")(1,"a",28),v("click",function(){let a=h(t).$implicit,r=p(3);return w(r.viewDocument(a))}),s(2),n(),d(3,ee,2,0,"span",29),c(4,"button",30),v("click",function(){let a=h(t).$implicit,r=p(3);return w(r.deleteDocument(a.id))}),s(5," Delete "),n()()}if(o&2){let t=e.$implicit,i=p(3);l(2),E(" ",t.documentType," (",t.expires?"Exp: "+t.expires:"No Expiry",") "),l(),u("ngIf",i.expiryWarning(t))}}function ie(o,e){if(o&1&&(c(0,"div")(1,"ul",27),d(2,te,6,3,"li",22),n()()),o&2){let t=p(2);l(2),u("ngForOf",t.truck.documents)}}function re(o,e){o&1&&(c(0,"div",32),s(1,"No documents available."),n())}function ne(o,e){if(o&1){let t=T();c(0,"div")(1,"div",23),s(2,"Documents:"),n(),d(3,ie,3,1,"div",24)(4,re,2,0,"ng-template",null,0,I),c(6,"div",25)(7,"app-add-document",26),v("documentAdded",function(a){h(t);let r=p();return w(r.addDocument(a))}),n()()()}if(o&2){let t=C(5),i=p();l(3),u("ngIf",i.truck.documents&&i.truck.documents.length>0)("ngIfElse",t),l(4),u("truckId",i.truck.id)("documentTypes",i.documentTypes)}}var Q=class o{constructor(e,t,i,a,r,oe,ce){this.route=e;this.router=t;this.trucksService=i;this.settingsService=a;this.documentsService=r;this.driversService=oe;this.toastService=ce}truck=new k;newTruck=!1;drivers=[];truckTypes=["Reefer","Dry Van","Flatbed","Box Truck","Tanker","Step Deck"];documentTypes=["Insurance","Registration","CDL"];newDocument={type:"",url:""};selectedFile=null;showDocumentViewer=!1;currentDocument=new y;ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(!e)throw new Error("Truck ID is required");this.settingsService.getSettings().subscribe(t=>{this.documentTypes=t.truckDocuments}),e==="new"?(this.newTruck=!0,this.truck=new k):x({truck:this.trucksService.getTruck(e),drivers:this.driversService.getDrivers()}).subscribe(({truck:t,drivers:i})=>{this.truck=t,this.drivers=i})}onFileSelected(e){let t=e.target;t.files&&t.files.length>0&&(this.selectedFile=t.files[0],this.newDocument.url=this.selectedFile.name)}addDocument(e){e.documentType&&e.url&&e.expires&&(this.truck.documents=this.truck.documents||[],this.truck.documents.push(S({},e)))}deleteDocument(e){e&&this.documentsService.deleteDocument(e).subscribe({next:()=>{this.toastService.showSuccess("Document deleted successfully"),this.truck.documents=this.truck.documents.filter(t=>t.id!==e)},error:t=>{console.error("Error deleting document:",t),this.toastService.showError("Failed to delete document")}})}expiryWarning(e){if(!e.expires)return!1;let t=this.truck.documents.filter(r=>r.documentType===e.documentType),i=new Date,a=new Date;return a.setMonth(i.getMonth()+1),t.every(r=>new Date(r.expires)<a)}saveTruckDetails(){this.truck.id?this.trucksService.updateTruck(this.truck).subscribe({next:e=>{this.toastService.showSuccess("Truck updated successfully"),this.router.navigate(["/dispatcher/trucks"])},error:e=>{console.error("Error updating truck:",e),this.toastService.showError("Failed to update truck")}}):this.trucksService.addTruck(this.truck).subscribe({next:e=>{this.truck=e,this.toastService.showSuccess("Truck created successfully"),this.router.navigate(["/dispatcher/trucks"])},error:e=>{console.error("Error creating truck:",e),this.toastService.showError("Failed to create truck")}})}viewDocument(e){this.currentDocument=e,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new y}onDownloadError(e){console.error("Download failed:",e),this.toastService.showError("Failed to download document")}static \u0275fac=function(t){return new(t||o)(m(V),m(W),m(z),m(G),m(H),m(O),m(P))};static \u0275cmp=b({type:o,selectors:[["app-truck-detail"]],decls:37,vars:11,consts:[["noDocs",""],[1,"mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],["routerLink","/dispatcher/trucks",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium","mb-4"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],[1,"mb-6","grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"font-semibold"],["type","text",1,"border","rounded","p-2","w-full","mb-2",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-x-2"],[1,"border","rounded","p-2","w-full","mb-2",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"value",4,"ngFor","ngForOf"],[1,"mb-6"],["class","bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-2 rounded mb-4",4,"ngIf"],[1,"flex","gap-4","mb-4"],[1,"bg-green-600","hover:bg-green-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[4,"ngIf"],[3,"close","downloadError","document","isVisible"],[3,"ngValue"],[3,"value"],[1,"bg-yellow-100","border","border-yellow-400","text-yellow-700","px-4","py-2","rounded","mb-4"],[1,"list-disc","pl-5"],[4,"ngFor","ngForOf"],[1,"font-semibold","mb-2"],[4,"ngIf","ngIfElse"],[1,"py-2","w-1/2"],[3,"documentAdded","truckId","documentTypes"],[1,"list-disc","pl-5","space-y-1"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],["class","ml-2 text-yellow-500 align-middle",4,"ngIf"],[1,"ml-2","text-red-500","hover:text-red-700",3,"click"],[1,"ml-2","text-yellow-500","align-middle"],[1,"italic","text-gray-500"]],template:function(t,i){t&1&&(c(0,"div",1)(1,"a",2)(2,"span",3),s(3,"\u2190"),n(),s(4," Back to Trucks "),n(),c(5,"h2",4)(6,"span"),s(7,"\u{1F69A}"),n(),s(8," Truck Details "),n(),c(9,"div",5)(10,"div")(11,"div",6),s(12,"DOT #:"),n(),c(13,"input",7),f("ngModelChange",function(r){return _(i.truck.dotNumber,r)||(i.truck.dotNumber=r),r}),n(),c(14,"div",8)(15,"div",6),s(16,"Plate:"),n(),c(17,"div",6),s(18,"Trailer Plate:"),n(),c(19,"input",7),f("ngModelChange",function(r){return _(i.truck.plate,r)||(i.truck.plate=r),r}),n(),c(20,"input",7),f("ngModelChange",function(r){return _(i.truck.trailerPlate,r)||(i.truck.trailerPlate=r),r}),n()()(),c(21,"div")(22,"div",6),s(23,"Assigned Driver:"),n(),c(24,"select",9),f("ngModelChange",function(r){return _(i.truck.driver,r)||(i.truck.driver=r),r}),d(25,X,2,2,"option",10),n(),c(26,"div",6),s(27,"Type:"),n(),c(28,"select",9),f("ngModelChange",function(r){return _(i.truck.type,r)||(i.truck.type=r),r}),d(29,Y,2,2,"option",11),n()()(),c(30,"div",12),d(31,$,5,1,"div",13),c(32,"div",14)(33,"button",15),v("click",function(){return i.saveTruckDetails()}),s(34," Save Truck "),n()(),d(35,ne,8,4,"div",16),n()(),c(36,"app-document-viewer",17),v("close",function(){return i.closeDocumentViewer()})("downloadError",function(r){return i.onDownloadError(r)}),n()),t&2&&(l(13),g("ngModel",i.truck.dotNumber),l(6),g("ngModel",i.truck.plate),l(),g("ngModel",i.truck.trailerPlate),l(4),g("ngModel",i.truck.driver),l(),u("ngForOf",i.drivers),l(3),g("ngModel",i.truck.type),l(),u("ngForOf",i.truckTypes),l(2),u("ngIf",i.truck.warnings&&i.truck.warnings.length>0),l(4),u("ngIf",!i.newTruck),l(),u("document",i.currentDocument)("isVisible",i.showDocumentViewer))},dependencies:[F,M,N,q,B,U,A,j,R,L,K,J],encapsulation:2})};export{Q as TruckDetailComponent};
