import{a as B}from"./chunk-D7VAPAMZ.js";import{b as T,c,d as M,e as R,h as q,j as D,k as O,l as L,m as $,n as j,t as G,v as P}from"./chunk-WJZQNLUY.js";import{a as k}from"./chunk-A3LUHI23.js";import"./chunk-XPCCV2FB.js";import"./chunk-5UMXG57Q.js";import{j as I,k as A,l as V}from"./chunk-O5HBUBIU.js";import{$ as _,Ab as w,Bb as F,Jb as C,Ka as l,Pa as E,Ua as S,Za as p,_ as b,fb as m,jb as r,kb as i,lb as f,ob as N,rb as h,sb as v,yb as n,zb as y}from"./chunk-ITTAAY47.js";var U=class{id=null;firstName;lastName;email;password;phoneNumber;roles;status;constructor(e,t,s,a,u,g,x){this.firstName=e,this.lastName=t,this.email=s,this.password=a,this.phoneNumber=u,this.roles=g,this.status=x}};var z=(o,e)=>({"bg-green-100 text-green-800":o,"bg-red-100 text-red-800":e});function J(o,e){o&1&&(r(0,"div",32),n(1," First name is required "),i())}function K(o,e){o&1&&(r(0,"div",32),n(1," Last name is required "),i())}function Q(o,e){o&1&&(r(0,"div",32),n(1," Valid email is required "),i())}function W(o,e){o&1&&(r(0,"div",32),n(1," Valid phone number is required "),i())}function X(o,e){o&1&&(r(0,"div",32),n(1," Password must be at least 6 characters "),i())}function Y(o,e){if(o&1){let t=N();r(0,"div",33)(1,"input",34),h("change",function(a){let u=b(t).$implicit,g=v(2);return _(g.onRoleChange(a,u))}),i(),r(2,"label",35),n(3),i()()}if(o&2){let t=e.$implicit;l(),m("id",t)("value",t),l(),m("for",t),l(),y(t)}}function Z(o,e){o&1&&(r(0,"div",32),n(1," At least one role must be selected "),i())}function ee(o,e){if(o&1){let t=N();r(0,"div",12)(1,"h3",13),n(2),i(),r(3,"form",14),h("ngSubmit",function(){b(t);let a=v();return _(a.saveUser())}),r(4,"div",15)(5,"div")(6,"label",16),n(7,"First Name"),i(),f(8,"input",17),p(9,J,2,0,"div",18),i(),r(10,"div")(11,"label",16),n(12,"Last Name"),i(),f(13,"input",19),p(14,K,2,0,"div",18),i()(),r(15,"div",15)(16,"div")(17,"label",16),n(18,"Email"),i(),f(19,"input",20),p(20,Q,2,0,"div",18),i(),r(21,"div")(22,"label",16),n(23,"Phone #"),i(),f(24,"input",21),p(25,W,2,0,"div",18),i()(),r(26,"div",15)(27,"div",22)(28,"label",16),n(29),i(),f(30,"input",23),p(31,X,2,0,"div",18),i(),r(32,"div")(33,"label",16),n(34,"Status"),i(),r(35,"select",24)(36,"option",25),n(37,"Active"),i(),r(38,"option",26),n(39,"Inactive"),i()()(),r(40,"div",15)(41,"div")(42,"label",16),n(43,"Roles"),i(),r(44,"div",27),p(45,Y,4,4,"div",28),i(),p(46,Z,2,0,"div",18),i()()(),r(47,"div",29)(48,"button",30),h("click",function(){b(t);let a=v();return _(a.cancelAddUser())}),n(49," Cancel "),i(),r(50,"button",31),n(51),i()()()()}if(o&2){let t,s,a,u,g,x,d=v();l(2),w(" ",d.isEditMode?"Edit User":"Add New User"," "),l(),m("formGroup",d.userForm),l(6),m("ngIf",((t=d.userForm.get("firstName"))==null?null:t.invalid)&&((t=d.userForm.get("firstName"))==null?null:t.touched)),l(5),m("ngIf",((s=d.userForm.get("lastName"))==null?null:s.invalid)&&((s=d.userForm.get("lastName"))==null?null:s.touched)),l(6),m("ngIf",((a=d.userForm.get("email"))==null?null:a.invalid)&&((a=d.userForm.get("email"))==null?null:a.touched)),l(5),m("ngIf",((u=d.userForm.get("phoneNumber"))==null?null:u.invalid)&&((u=d.userForm.get("phoneNumber"))==null?null:u.touched)),l(4),w(" Password ",d.isEditMode?"(Leave blank to keep current)":""," "),l(),m("placeholder",d.isEditMode?"(optional)":""),l(),m("ngIf",((g=d.userForm.get("password"))==null?null:g.invalid)&&((g=d.userForm.get("password"))==null?null:g.touched)),l(14),m("ngForOf",d.availableRoles),l(),m("ngIf",((x=d.userForm.get("roles"))==null?null:x.invalid)&&((x=d.userForm.get("roles"))==null?null:x.touched)),l(4),m("disabled",!d.userForm.valid),l(),w(" ",d.isEditMode?"Update User":"Save User"," ")}}function te(o,e){if(o&1){let t=N();r(0,"tr",36)(1,"td",37),n(2),i(),r(3,"td",38),n(4),i(),r(5,"td",38),n(6),i(),r(7,"td",38),n(8),i(),r(9,"td",38)(10,"span",39),n(11),i()(),r(12,"td",38)(13,"button",40),h("click",function(){let a=b(t).$implicit,u=v();return _(u.viewUser(a))}),n(14," Edit "),i(),r(15,"button",41),h("click",function(){let a=b(t).$implicit,u=v();return _(u.deleteUser(a))}),n(16," Delete "),i()()()}if(o&2){let t=e.$implicit;l(2),F("",t.firstName," ",t.lastName,""),l(2),y(t.email),l(2),y(t.phoneNumber),l(2),y(t.roles.join(", ")),l(2),m("ngClass",C(7,z,t.isActive,!t.isActive)),l(),w(" ",t.isActive?"Active":"Inactive"," ")}}function ie(o,e){o&1&&(r(0,"div",42)(1,"div",43),f(2,"div",44),r(3,"p",45),n(4,"Loading users..."),i()()())}var H=class o{constructor(e,t,s){this.fb=e;this.usersService=t;this.toastService=s;this.userForm=this.fb.group({firstName:["",[c.required]],lastName:["",[c.required]],email:["",[c.required,c.email]],phoneNumber:["",[c.required]],password:["",[c.required,c.minLength(6)]],roles:[[],[c.required]],status:["Active",[c.required]]})}loading=!1;users=[];showAddUserForm=!1;userForm;availableRoles=["Dispatcher","Driver","Admin"];isEditMode=!1;editingUserId=null;ngOnInit(){this.loadUsers()}loadUsers(){this.loading=!0,this.usersService.getUsers().subscribe(e=>{this.users=e,this.loading=!1},e=>{console.error("Error loading users",e),this.loading=!1,this.toastService.showError("Failed to load users. Please try again later.")})}toggleAddUserForm(){this.showAddUserForm=!this.showAddUserForm,this.showAddUserForm&&this.resetForm()}resetForm(){this.isEditMode=!1,this.editingUserId=null,this.userForm.reset(),this.userForm.patchValue({status:"Active",roles:[]}),this.userForm.get("password")?.setValidators([c.required,c.minLength(6)]),this.userForm.get("password")?.updateValueAndValidity(),this.clearRoleCheckboxes()}clearRoleCheckboxes(){this.availableRoles.forEach(e=>{let t=document.getElementById(e);t&&(t.checked=!1)})}viewUser(e){this.isEditMode=!0,this.editingUserId=e.id,this.showAddUserForm=!0,this.userForm.get("password")?.clearValidators(),this.userForm.get("password")?.updateValueAndValidity();let t=[];typeof e.roles=="string"?t=e.roles.split(",").map(s=>s.trim()):Array.isArray(e.roles)&&(t=e.roles),this.userForm.patchValue({firstName:e.firstName||e.name?.split(" ")[0]||"",lastName:e.lastName||e.name?.split(" ")[1]||"",email:e.email,password:"",phoneNumber:e.phoneNumber||"",roles:t,status:e.status==="Active"?"Active":"Inactive"}),setTimeout(()=>{this.updateRoleCheckboxes(t)},0)}updateRoleCheckboxes(e){this.availableRoles.forEach(t=>{let s=document.getElementById(t);s&&(s.checked=e.includes(t))})}onRoleChange(e,t){let s=this.userForm.get("roles")?.value||[];if(e.target.checked)s.includes(t)||s.push(t);else{let a=s.indexOf(t);a>-1&&s.splice(a,1)}this.userForm.patchValue({roles:s})}saveUser(){this.userForm.valid&&(this.isEditMode?this.updateUser():this.createUser())}createUser(){let e=this.userForm.value,t=new U(e.firstName,e.lastName,e.email,e.password,e.phoneNumber,e.roles,e.status);this.usersService.addUser(t).subscribe({next:s=>{this.showAddUserForm=!1,this.resetForm(),this.loadUsers()},error:s=>{console.error("Error adding user:",s)}})}updateUser(){let e=this.userForm.value,t={id:this.editingUserId,firstName:e.firstName,lastName:e.lastName,email:e.email,phoneNumber:e.phoneNumber,roles:e.roles,isActive:e.status==="Active"};e.password&&(t.password=e.password),this.usersService.updateUser(t).subscribe({next:s=>{this.showAddUserForm=!1,this.resetForm(),this.loadUsers()},error:s=>{console.error("Error updating user:",s)}})}cancelAddUser(){this.showAddUserForm=!1,this.resetForm()}deleteUser(e){confirm(`Are you sure you want to delete ${e.firstName} ${e.lastName}?`)&&this.usersService.deleteUser(e.id).subscribe({next:()=>{this.toastService.showSuccess("User deleted successfully"),this.loadUsers()},error:t=>{this.toastService.showError("Error deleting user"),console.error("Error deleting user:",t)}})}static \u0275fac=function(t){return new(t||o)(E(G),E(B),E(k))};static \u0275cmp=S({type:o,selectors:[["app-users"]],decls:28,vars:3,consts:[[1,"p-6","pt-0"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-3xl","font-bold","text-green-900","flex","items-center","gap-2"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded","shadow","font-semibold","transition",3,"click"],["class","bg-white rounded-lg shadow-lg p-6 mb-6",4,"ngIf"],[1,"overflow-x-auto","rounded-lg","shadow-lg","bg-white"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-green-900","text-white"],[1,"px-4","py-3","text-left","font-semibold"],[1,"bg-white","divide-y","divide-gray-100"],["class","hover:bg-green-50 transition",4,"ngFor","ngForOf"],["class","grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"bg-white","rounded-lg","shadow-lg","p-6","mb-6"],[1,"text-xl","font-semibold","text-green-900","mb-4"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","formControlName","firstName",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500"],["class","text-red-500 text-xs mt-1",4,"ngIf"],["type","text","formControlName","lastName",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500"],["type","email","formControlName","email",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500"],["type","text","formControlName","phoneNumber",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500"],[1,"mb-4"],["type","password","formControlName","password",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500",3,"placeholder"],["formControlName","status",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-500"],["value","Active"],["value","Inactive"],[1,"space-y-2"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","justify-end","space-x-3"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","text-gray-700","hover:bg-gray-50","transition",3,"click"],["type","submit",1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","transition","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"text-red-500","text-xs","mt-1"],[1,"flex","items-center"],["type","checkbox",1,"h-4","w-4","text-green-600","focus:ring-green-500","border-gray-300","rounded",3,"change","id","value"],[1,"ml-2","block","text-sm","text-gray-900",3,"for"],[1,"hover:bg-green-50","transition"],[1,"px-4","py-2","font-medium","text-green-900"],[1,"px-4","py-2"],[1,"px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[1,"bg-blue-600","hover:bg-blue-700","transition","text-white","px-3","py-1","rounded","shadow",3,"click"],[1,"bg-red-600","hover:bg-red-700","transition","text-white","px-3","py-1","ml-2","rounded","shadow",3,"click"],[1,"grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"]],template:function(t,s){t&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2)(3,"span"),n(4,"\u{1F465}"),i(),n(5," Users "),i(),r(6,"button",3),h("click",function(){return s.toggleAddUserForm()}),n(7," + Add User "),i()(),p(8,ee,52,13,"div",4),r(9,"div",5)(10,"table",6)(11,"thead",7)(12,"tr")(13,"th",8),n(14,"Name"),i(),r(15,"th",8),n(16,"Email"),i(),r(17,"th",8),n(18,"Phone #"),i(),r(19,"th",8),n(20,"Roles"),i(),r(21,"th",8),n(22,"Status"),i(),r(23,"th",8),n(24,"Actions"),i()()(),r(25,"tbody",9),p(26,te,17,10,"tr",10),i()()(),p(27,ie,5,0,"div",11),i()),t&2&&(l(8),m("ngIf",s.showAddUserForm),l(18),m("ngForOf",s.users),l(),m("ngIf",s.loading))},dependencies:[I,A,V,P,q,$,j,T,L,M,R,D,O],encapsulation:2})};export{H as UsersComponent};
