import{a as L,b as j}from"./chunk-UIIJYSZH.js";import{a as V,b as O,c as B}from"./chunk-7GTRUKFK.js";import{a as z}from"./chunk-7FUB44TE.js";import{u as M}from"./chunk-2PVWNWUN.js";import{a as R}from"./chunk-LIL63FBP.js";import"./chunk-NBSK5KUW.js";import"./chunk-IMHYAPIP.js";import"./chunk-XPCCV2FB.js";import{c as T,e as D}from"./chunk-3TOGTSGL.js";import"./chunk-FSJQQIFH.js";import{m as C,s as k}from"./chunk-QAAQ2EEP.js";import{$ as u,Ab as h,Bb as I,Ha as S,La as l,Qa as x,Va as P,_ as c,_a as v,aa as g,ba as b,gb as s,hb as U,ib as E,kb as r,lb as n,mb as p,pb as _,sb as f,tb as m,x as w,yb as F,zb as d}from"./chunk-QJGZKU5F.js";function H(o,t){if(o&1){let e=_();r(0,"div",16),f("click",function(){c(e),m();let a=F(8);return u(a.click())}),r(1,"div",17),g(),r(2,"svg",18),p(3,"path",19)(4,"polyline",20)(5,"line",21),n()(),b(),r(6,"h3",22),d(7,"Choose a pdf file"),n(),r(8,"p",23),d(9,"Maximum file size: 10MB"),n(),r(10,"button",24),d(11," Browse Files "),n()()}}function N(o,t){if(o&1&&(r(0,"div",37),p(1,"img",38),n()),o&2){let e=m(2);l(),s("src",e.previewUrl,S)("alt",e.selectedFile.name)}}function W(o,t){if(o&1){let e=_();r(0,"div",25)(1,"div",26),v(2,N,2,2,"div",27),r(3,"div",28)(4,"div",29),d(5),n(),r(6,"div",30)(7,"h4",31),d(8),n(),r(9,"p",32),d(10),n()(),r(11,"button",33),f("click",function(){c(e);let a=m();return u(a.removePod())}),g(),r(12,"svg",34),p(13,"line",35)(14,"line",36),n()()()()()}if(o&2){let e=m();l(2),s("ngIf",e.previewUrl),l(3),h(e.getFileIcon(e.selectedFile)),l(3),h(e.selectedFile.name),l(2),h(e.formatFileSize(e.selectedFile.size))}}function J(o,t){if(o&1&&(r(0,"div",39)(1,"div",40),p(2,"div",41),n(),r(3,"p",42),d(4),n()()),o&2){let e=m();l(2),U("width",e.uploadProgress,"%"),l(2),I("Uploading... ",e.uploadProgress,"%")}}function q(o,t){if(o&1&&(r(0,"div",43),g(),r(1,"svg",44),p(2,"circle",45)(3,"line",46)(4,"line",47),n(),b(),r(5,"span"),d(6),n()()),o&2){let e=m();l(6),h(e.uploadError)}}function K(o,t){o&1&&(r(0,"div",48),g(),r(1,"svg",44),p(2,"polyline",49),n(),b(),r(3,"span"),d(4,"POD uploaded successfully!"),n()())}function Y(o,t){o&1&&(r(0,"span"),d(1,"Upload POD"),n())}function Q(o,t){o&1&&(r(0,"span"),d(1,"Uploading..."),n())}var G=class o{constructor(t,e,i,a){this.documentsService=t;this.ordersService=e;this.route=i;this.router=a}selectedFile=null;previewUrl=null;isUploading=!1;uploadProgress=0;uploadError=null;uploadSuccess=!1;allowedTypes=["image/jpeg","image/jpg","image/png","image/webp","application/pdf"];maxFileSize=5*1024*1024;order=new j;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(!t){this.uploadError="Order ID is required to upload POD",this.isUploading=!1;return}this.ordersService.getCurrentOrder(t).subscribe(e=>{if(!e){this.uploadError="Order not found",this.isUploading=!1;return}this.order.id=t,this.order=e})}onPodSelected(t){let e=t.target;if(this.uploadError=null,this.uploadSuccess=!1,e.files&&e.files.length>0){let i=e.files[0];if(!this.allowedTypes.includes(i.type)){this.uploadError="Please select a valid image file (JPEG, PNG, WebP) or PDF";return}if(i.size>this.maxFileSize){this.uploadError="File size must be less than 5MB";return}if(this.selectedFile=i,i.type.startsWith("image/")){let a=new FileReader;a.onload=y=>{this.previewUrl=y.target?.result},a.readAsDataURL(i)}else this.previewUrl=null}else this.selectedFile=null,this.previewUrl=null}uploadPod(){if(!this.selectedFile){this.uploadError="Please select a file first";return}this.isUploading=!0,this.uploadProgress=0,this.uploadError=null;let t=new V;t.documentType=B.POD,t.fileType=this.selectedFile.type,t.fileName=this.selectedFile.name,t.expires=new Date().toISOString().substring(0,10);let e=new O(t,this.selectedFile);e.orderId=this.order.id,w({doc:this.documentsService.uploadFile(e),order:this.ordersService.updateOrderStatus(this.order.id,L.PARTIALLY_DELIVERED)}).subscribe({next:({doc:i,order:a})=>{this.isUploading=!1,this.uploadSuccess=!0,this.uploadProgress=100,this.resetForm()},error:i=>{console.error("Upload failed:",i),this.isUploading=!1,this.uploadError="Failed to upload POD. Please try again.",this.uploadProgress=0}})}removePod(){this.selectedFile=null,this.previewUrl=null,this.uploadError=null,this.uploadSuccess=!1}resetForm(){this.router.navigate(["/driver/current-orders"])}getFileIcon(t){return t.type.startsWith("image/")?"\u{1F5BC}\uFE0F":t.type==="application/pdf"?"\u{1F4C4}":"\u{1F4CE}"}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,i=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,a)).toFixed(2))+" "+i[a]}static \u0275fac=function(e){return new(e||o)(x(R),x(z),x(T),x(D))};static \u0275cmp=P({type:o,selectors:[["app-upload-pod"]],decls:20,vars:13,consts:[["fileInput",""],[1,"max-w-2xl","mx-auto","p-6","font-sans"],[1,"text-center","mb-8"],[1,"text-gray-900","text-2xl","font-semibold","mb-2"],[1,"text-gray-600","text-sm"],[1,"border-2","border-dashed","rounded-xl","bg-gray-50","transition-all","duration-300","overflow-hidden"],["type","file","id","pod-file","accept","image/*,.pdf",1,"hidden",3,"change"],["class","p-12 text-center cursor-pointer transition-colors duration-200 hover:bg-gray-100",3,"click",4,"ngIf"],["class","p-6",4,"ngIf"],["class","my-4",4,"ngIf"],["class","flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-lg text-sm my-4",4,"ngIf"],["class","flex items-center gap-2 p-3 bg-green-50 text-green-700 border border-green-200 rounded-lg text-sm my-4",4,"ngIf"],[1,"flex","gap-3","justify-center","mt-6","sm:flex-row","flex-col"],["type","button",1,"px-6","py-3","bg-green-600","text-white","rounded-lg","text-sm","font-medium","transition-all","duration-200","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","sm:w-auto","w-full",3,"click","disabled"],[4,"ngIf"],["type","button",1,"px-6","py-3","bg-gray-100","text-gray-700","border","border-gray-300","rounded-lg","text-sm","font-medium","transition-all","duration-200","hover:bg-gray-200","disabled:opacity-50","disabled:cursor-not-allowed","sm:w-auto","w-full",3,"click","disabled"],[1,"p-12","text-center","cursor-pointer","transition-colors","duration-200","hover:bg-gray-100",3,"click"],[1,"text-gray-400","mb-4"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-12","h-12","mx-auto"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","7,10 12,15 17,10"],["x1","12","y1","15","x2","12","y2","3"],[1,"text-gray-800","text-lg","font-medium","mb-2"],[1,"text-gray-500","text-sm","mb-6"],["type","button",1,"bg-blue-500","text-white","px-5","py-2.5","rounded-lg","text-sm","font-medium","hover:bg-blue-600","transition-colors","duration-200"],[1,"p-6"],[1,"flex","flex-col","gap-4"],["class","text-center",4,"ngIf"],[1,"flex","items-center","gap-3","p-4","bg-white","rounded-lg","shadow-sm"],[1,"text-3xl"],[1,"flex-1","min-w-0"],[1,"text-gray-800","text-base","font-medium","mb-1","break-words"],[1,"text-gray-500","text-sm"],["type","button","title","Remove file",1,"text-red-500","p-2","rounded","hover:bg-red-50","transition-colors","duration-200",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"text-center"],[1,"max-w-full","max-h-80","rounded-lg","shadow-md","mx-auto",3,"src","alt"],[1,"my-4"],[1,"w-full","h-2","bg-gray-200","rounded-full","overflow-hidden","mb-2"],[1,"h-full","bg-blue-500","rounded-full","transition-all","duration-300","ease-out"],[1,"text-center","text-gray-500","text-sm"],[1,"flex","items-center","gap-2","p-3","bg-red-50","text-red-700","border","border-red-200","rounded-lg","text-sm","my-4"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4","flex-shrink-0"],["cx","12","cy","12","r","10"],["x1","15","y1","9","x2","9","y2","15"],["x1","9","y1","9","x2","15","y2","15"],[1,"flex","items-center","gap-2","p-3","bg-green-50","text-green-700","border","border-green-200","rounded-lg","text-sm","my-4"],["points","20,6 9,17 4,12"]],template:function(e,i){if(e&1){let a=_();r(0,"div",1)(1,"div",2)(2,"h2",3),d(3,"Upload Proof of Delivery"),n(),r(4,"p",4),d(5,"Upload a PDF document as proof of delivery"),n()(),r(6,"div",5)(7,"input",6,0),f("change",function(A){return c(a),u(i.onPodSelected(A))}),n(),v(9,H,12,0,"div",7)(10,W,15,4,"div",8),n(),v(11,J,5,3,"div",9)(12,q,7,1,"div",10)(13,K,5,0,"div",11),r(14,"div",12)(15,"button",13),f("click",function(){return c(a),u(i.uploadPod())}),v(16,Y,2,0,"span",14)(17,Q,2,0,"span",14),n(),r(18,"button",15),f("click",function(){return c(a),u(i.resetForm())}),d(19," Back "),n()()()}e&2&&(l(6),E("border-blue-500",i.selectedFile)("bg-blue-50",i.selectedFile),l(3),s("ngIf",!i.selectedFile),l(),s("ngIf",i.selectedFile),l(),s("ngIf",i.isUploading),l(),s("ngIf",i.uploadError),l(),s("ngIf",i.uploadSuccess),l(2),s("disabled",!i.selectedFile||i.isUploading),l(),s("ngIf",!i.isUploading),l(),s("ngIf",i.isUploading),l(),s("disabled",i.isUploading))},dependencies:[k,C,M],encapsulation:2})};export{G as UploadPodComponent};
