import{a as R}from"./chunk-IGQEBQMV.js";import{a as A}from"./chunk-RYHISPQ6.js";import{a as j}from"./chunk-J75B7AT2.js";import{a as F}from"./chunk-NSSVMM7K.js";import"./chunk-ZFFVO34L.js";import{b as W,c as B,f as k,h as V,o as P}from"./chunk-WIAEWHLW.js";import{d as O,f as D,k as N}from"./chunk-3KQDNKNL.js";import{l as E,p as M}from"./chunk-B35W4A7H.js";import{Ab as u,Ga as d,Hb as b,Jb as _,La as v,Qa as w,Va as C,ab as S,db as i,ea as h,eb as e,fa as f,ib as y,lb as g,mb as I,tb as t,ub as T,vb as m,yb as c,zb as p}from"./chunk-WMTXBNFA.js";var x=class{id;number;customer;date;amount;status;orderId;terms;paymentInstructions;notes;constructor(){this.id="",this.number="",this.customer="",this.date="",this.amount=0,this.status="",this.orderId="",this.terms="",this.paymentInstructions="",this.notes=""}};function z(l,a){if(l&1){let r=y();i(0,"div",31)(1,"span"),t(2),e(),i(3,"div",32)(4,"span",33),t(5,"$"),e(),i(6,"input",34),u("ngModelChange",function(s){let o=h(r).$implicit;return p(o.amount,s)||(o.amount=s),f(s)}),g("change",function(){h(r);let s=I();return f(s.recalculateTotals())}),e()()()}if(l&2){let r=a.$implicit;d(2),T(r.description),d(4),c("ngModel",r.amount)}}function G(l,a){if(l&1){let r=y();i(0,"div",31)(1,"span"),t(2),e(),i(3,"div",32)(4,"span",33),t(5,"$"),e(),i(6,"input",34),u("ngModelChange",function(s){let o=h(r).$implicit;return p(o.amount,s)||(o.amount=s),f(s)}),g("change",function(){h(r);let s=I();return f(s.recalculateTotals())}),e()()()}if(l&2){let r=a.$implicit;d(2),T(r.description),d(4),c("ngModel",r.amount)}}var L=class l{constructor(a,r,n,s,o){this.route=a;this.router=r;this.ordersService=n;this.settingsService=s;this.invoicesService=o}order=new R;invoice=new x;paymentTerms="";paymentInstructions="";invoiceNotes="";orderTotal=0;driverTotal=0;dispatcherTotal=0;dispatcherCode="";ngOnInit(){let a=this.route.snapshot.paramMap.get("id");a&&(this.settingsService.getSettings().subscribe(r=>{this.dispatcherCode=r.dispatcherCode,this.paymentTerms=r.paymentTerms,this.paymentInstructions=r.paymentInstructions,this.invoiceNotes=r.invoiceNotes}),this.ordersService.getOrder(a).subscribe(r=>{this.order=r,this.initializeInvoice()}))}initializeInvoice(){this.driverTotal=this.order.driverCosts?.reduce((a,r)=>a+r.amount,0)||0,this.dispatcherTotal=this.order.dispatcherCosts?.reduce((a,r)=>a+r.amount,0)||0,this.orderTotal=this.order.rate+this.driverTotal+this.dispatcherTotal,this.invoice.customer=this.order.customerName,this.invoice.date=new Date().toISOString().split("T")[0],this.invoice.amount=this.orderTotal,this.invoice.status="Draft",this.invoice.number=`${this.dispatcherCode}-INV-${this.order.orderNumber}`}generateInvoice(){this.invoice.orderId=this.order.id,this.invoice.amount=this.orderTotal,this.invoice.terms=this.paymentTerms,this.invoice.paymentInstructions=this.paymentInstructions,this.invoice.notes=this.invoiceNotes,this.invoicesService.createInvoice(this.invoice).subscribe(a=>{this.order.invoiceId=a.id,this.ordersService.updateOrder(this.order).subscribe(()=>{this.router.navigate(["/dispatcher/invoices",a.id])})})}goBack(){this.router.navigate(["/dispatcher/orders",this.order.id])}recalculateTotals(){this.driverTotal=this.order.driverCosts?.reduce((a,r)=>a+(r.amount||0),0)||0,this.dispatcherTotal=this.order.dispatcherCosts?.reduce((a,r)=>a+(r.amount||0),0)||0,this.orderTotal=this.order.rate+this.driverTotal+this.dispatcherTotal,this.invoice.amount=this.orderTotal}static \u0275fac=function(r){return new(r||l)(v(O),v(D),v(j),v(A),v(F))};static \u0275cmp=w({type:l,selectors:[["app-order-to-invoice"]],decls:109,vars:27,consts:[[1,"mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"mb-4"],[1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium",3,"click"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],[1,"mb-6","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"font-semibold"],[1,"mb-6"],[1,"mb-4","bg-blue-50","rounded","p-4"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-bold","text-blue-900"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-6"],[1,"bg-gray-50","rounded","p-4"],[1,"font-semibold","mb-2","flex","items-center","gap-2"],[1,"space-y-2"],["class","flex justify-between items-center space-x-4",4,"ngFor","ngForOf"],[1,"border-t","pt-2","mt-4","flex","justify-between","font-semibold"],[1,"mt-4","bg-green-100","p-4","rounded"],[1,"flex","justify-between","items-center","text-lg","font-bold","text-green-900"],[1,"space-y-4"],[1,"block","font-medium","mb-1"],["type","text",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","date",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","2",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","6",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","3","placeholder","Additional notes for the invoice...",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],[1,"bg-green-600","hover:bg-green-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-gray-600","hover:bg-gray-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"flex","justify-between","items-center","space-x-4"],[1,"flex","items-center"],[1,"mr-1"],["type","number","placeholder","0.00",1,"w-24","p-1","border","rounded","focus:border-green-500","focus:outline-none","text-right",3,"ngModelChange","change","ngModel"]],template:function(r,n){r&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return n.goBack()}),i(3,"span",3),t(4,"\u2190"),e(),t(5," Back to Order "),e()(),i(6,"h2",4)(7,"span"),t(8,"\u{1F4C4}"),e(),t(9," Generate Invoice "),e(),i(10,"div",5)(11,"h3",6)(12,"span"),t(13,"\u{1F4E6}"),e(),t(14," Order Information "),e(),i(15,"div",7)(16,"div")(17,"span",8),t(18,"Order #:"),e(),t(19),e(),i(20,"div")(21,"span",8),t(22,"Rate Con #:"),e(),t(23),e(),i(24,"div")(25,"span",8),t(26,"Customer:"),e(),t(27),e(),i(28,"div")(29,"span",8),t(30,"Contact:"),e(),t(31),e()()(),i(32,"div",9)(33,"h3",6)(34,"span"),t(35,"\u{1F4B2}"),e(),t(36," Cost Summary "),e(),i(37,"div",10)(38,"div",11)(39,"span",8),t(40,"Rate Amount"),e(),i(41,"span",12),t(42),b(43,"number"),e()()(),i(44,"div",13)(45,"div",14)(46,"h4",15)(47,"span"),t(48,"\u{1F69B}"),e(),t(49," Driver Costs "),e(),i(50,"div",16),C(51,z,7,2,"div",17),i(52,"div",18)(53,"span"),t(54,"Driver Total"),e(),i(55,"span"),t(56),b(57,"number"),e()()()(),i(58,"div",14)(59,"h4",15)(60,"span"),t(61,"\u{1F4CB}"),e(),t(62," Dispatcher Costs "),e(),i(63,"div",16),C(64,G,7,2,"div",17),i(65,"div",18)(66,"span"),t(67,"Dispatcher Total"),e(),i(68,"span"),t(69),b(70,"number"),e()()()()(),i(71,"div",19)(72,"div",20)(73,"span"),t(74,"Order Total"),e(),i(75,"span"),t(76),b(77,"number"),e()()()(),i(78,"div",9)(79,"h3",6)(80,"span"),t(81,"\u{1F4DD}"),e(),t(82," Invoice Details "),e(),i(83,"div",21)(84,"div")(85,"label",22),t(86,"Invoice Number"),e(),i(87,"input",23),u("ngModelChange",function(o){return p(n.invoice.number,o)||(n.invoice.number=o),o}),e()(),i(88,"div")(89,"label",22),t(90,"Invoice Date"),e(),i(91,"input",24),u("ngModelChange",function(o){return p(n.invoice.date,o)||(n.invoice.date=o),o}),e()(),i(92,"div")(93,"label",22),t(94,"Payment Terms"),e(),i(95,"textarea",25),u("ngModelChange",function(o){return p(n.paymentTerms,o)||(n.paymentTerms=o),o}),e()(),i(96,"div")(97,"label",22),t(98,"Payment Instructions"),e(),i(99,"textarea",26),u("ngModelChange",function(o){return p(n.paymentInstructions,o)||(n.paymentInstructions=o),o}),e()(),i(100,"div")(101,"label",22),t(102,"Notes"),e(),i(103,"textarea",27),u("ngModelChange",function(o){return p(n.invoiceNotes,o)||(n.invoiceNotes=o),o}),e()()()(),i(104,"div",28)(105,"button",29),g("click",function(){return n.generateInvoice()}),t(106," Generate Invoice "),e(),i(107,"button",30),g("click",function(){return n.goBack()}),t(108," Cancel "),e()()()),r&2&&(d(19),m(" ",n.order.orderNumber,""),d(4),m(" ",n.order.rateConNumber,""),d(4),m(" ",n.order.customerName,""),d(4),m(" ",n.order.customerContact,""),d(11),m("$ ",_(43,15,n.order.rate,"1.2-2"),""),d(9),S("ngForOf",n.order.driverCosts),d(5),m("$ ",_(57,18,n.driverTotal,"1.2-2"),""),d(8),S("ngForOf",n.order.dispatcherCosts),d(5),m("$ ",_(70,21,n.dispatcherTotal,"1.2-2"),""),d(7),m("$ ",_(77,24,n.orderTotal,"1.2-2"),""),d(11),c("ngModel",n.invoice.number),d(4),c("ngModel",n.invoice.date),d(4),c("ngModel",n.paymentTerms),d(4),c("ngModel",n.paymentInstructions),d(4),c("ngModel",n.invoiceNotes))},dependencies:[E,N,P,W,V,B,k,M],encapsulation:2})};export{L as OrderToInvoiceComponent};
