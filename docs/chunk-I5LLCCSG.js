import{a as J}from"./chunk-BI46WA4O.js";import{a as G}from"./chunk-NTYF7ZMB.js";import{a as W,d as z,g as $,l as B,m as H,n as Z,u as q}from"./chunk-SVMRWARE.js";import{a as P}from"./chunk-DA7YCHM5.js";import"./chunk-3TXZS4HG.js";import{a as R}from"./chunk-5R44ZK2D.js";import"./chunk-XPCCV2FB.js";import{c as j,e as L}from"./chunk-KA6K7UZ3.js";import"./chunk-GDLZFIOX.js";import{k as V,l as N,m as A}from"./chunk-GEVPNXBN.js";import{$ as k,Ab as b,Bb as C,Cb as w,Db as y,Ib as M,Ja as l,Nb as F,Oa as x,Ta as I,Y as v,Ya as u,Z as _,_ as O,eb as m,ib as i,jb as r,kb as D,nb as h,qb as g,rb as c,v as E,vb as T,wb as s,xb as p,yb as f}from"./chunk-YSP72ENP.js";var Q=(o,t,e)=>({"bg-green-100 text-green-800":o,"bg-yellow-100 text-yellow-800":t,"bg-red-100 text-red-800":e});function U(o,t){if(o&1){let e=h();i(0,"label",23)(1,"input",28),y("ngModelChange",function(a){let d=v(e).$implicit,S=c(2);return w(S.selectedStatusesMap[d],a)||(S.selectedStatusesMap[d]=a),_(a)}),g("change",function(){v(e);let a=c(2);return _(a.onStatusFilterChange())}),r(),s(2),r()}if(o&2){let e=t.$implicit,n=c(2);l(),C("ngModel",n.selectedStatusesMap[e]),l(),f(" ",e," ")}}function X(o,t){if(o&1){let e=h();i(0,"div",21)(1,"div",22)(2,"label",23)(3,"input",24),g("change",function(a){v(e);let d=c();return _(d.toggleSelectAllStatuses(a))}),r(),i(4,"span",25),s(5,"Select/Deselect All"),r()()(),i(6,"div",26),u(7,U,3,2,"label",27),r()()}if(o&2){let e=c();l(3),m("checked",e.allStatusesSelected()),l(4),m("ngForOf",e.orderStatuses)}}function Y(o,t){if(o&1){let e=h();i(0,"div",29),g("click",function(){v(e);let a=c();return _(a.showStatusDropdown=!1)}),r()}}function ee(o,t){if(o&1&&(i(0,"option",30),s(1),r()),o&2){let e=t.$implicit;m("value",e),l(),p(e)}}function te(o,t){if(o&1&&(i(0,"div")(1,"div"),s(2),r(),i(3,"div",35),s(4),r()()),o&2){let e,n,a=c().$implicit,d=c();l(2),p((e=d.getDriver(a))==null?null:e.name),l(2),p((n=d.getDriver(a))==null?null:n.phone)}}function re(o,t){if(o&1&&(i(0,"option",30),s(1),r()),o&2){let e=t.$implicit;m("value",e.id),l(),f(" ",e.name," ")}}function ie(o,t){if(o&1){let e=h();i(0,"select",38),g("change",function(a){v(e);let d=c().$implicit,S=c();return _(S.assignDriver(d,a))}),i(1,"option",13),s(2,"Select Driver..."),r(),u(3,re,2,2,"option",14),r()}if(o&2){let e=c(2);l(3),m("ngForOf",e.drivers)}}function ne(o,t){if(o&1){let e=h();i(0,"tr",31)(1,"td",32)(2,"div"),s(3),r(),i(4,"span",33),s(5),r()(),i(6,"td",34)(7,"div",25),s(8),r(),i(9,"div",35),s(10),r()(),i(11,"td",34)(12,"div",25),s(13),r()(),i(14,"td",34)(15,"div"),s(16),r(),i(17,"div",35),s(18),r()(),i(19,"td",34)(20,"div"),s(21),r(),i(22,"div",35),s(23),r()(),i(24,"td",34),u(25,te,5,2,"div",36)(26,ie,4,1,"ng-template",null,0,F),r(),i(28,"td",34)(29,"button",37),g("click",function(){let a=v(e).$implicit,d=c();return _(d.viewOrder(a.id))}),s(30," View "),r()()()}if(o&2){let e=t.$implicit,n=T(27),a=c();l(3),p(e.orderNumber),l(),m("ngClass",M(16,Q,e.status==="Delivered",e.status==="In Transit",e.status==="Cancelled")),l(),f(" ",e.status," "),l(3),p(e.brokerName),l(2),p(e.brokerContact),l(3),p(e.loadNumber),l(3),p(e.originStreetAddress),l(2),b("",e.originCity,", ",e.originState," ",e.originZipcode,""),l(3),p(e.destinationStreetAddress),l(2),b("",e.destinationCity,", ",e.destinationState," ",e.destinationZipcode,""),l(2),m("ngIf",a.getDriver(e))("ngIfElse",n)}}var K=class o{constructor(t,e,n,a,d,S){this.router=t;this.route=e;this.toastService=n;this.ordersService=a;this.driversService=d;this.trucksService=S}orderStatuses=["New","In Transit","Delivered","Cancelled"];selectedStatusesMap={};orders=[];filteredOrders=[];showStatusDropdown=!1;customerNames=[];selectedCustomer="";drivers=[];trucks=[];ngOnInit(){this.loadOrders(),this.applyStatusFilters(),this.onStatusFilterChange()}loadOrders(){E({orders:this.ordersService.getOrders(),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks()}).subscribe(({orders:t,drivers:e,trucks:n})=>{this.orders=t,this.filteredOrders=t,this.drivers=e,this.trucks=n},t=>{console.error("Error loading orders:",t)}),this.ordersService.getOrders().subscribe(t=>{this.orders=t,this.customerNames=Array.from(new Set(t.map(e=>e.brokerName))).sort(),this.filteredOrders=t},t=>{console.error("Error loading orders:",t)})}getDriver(t){return this.drivers.find(e=>e.id===t.driverId)||null}getTruck(t){return this.trucks.find(e=>e.id===t.truckId)||null}applyStatusFilters(){let t=this.route.snapshot.queryParamMap.get("status")||"";t?(this.orderStatuses.forEach(e=>{this.selectedStatusesMap[e]=!1}),this.selectedStatusesMap[t]=!0):(this.orderStatuses.forEach(e=>{this.selectedStatusesMap[e]=!0}),this.selectedStatusesMap.Cancelled=!1)}onStatusFilterChange(){this.applyFilters()}onCustomerFilterChange(){this.applyFilters()}applyFilters(){let t=this.orderStatuses.filter(e=>this.selectedStatusesMap[e]);this.filteredOrders=this.orders.filter(e=>{let n=t.includes(e.status),a=!this.selectedCustomer||e.brokerName===this.selectedCustomer;return n&&a})}viewOrder(t){this.router.navigate(["/dispatcher/orders/",t])}getSelectedStatusesLabel(){let t=this.orderStatuses.filter(e=>this.selectedStatusesMap[e]);return t.length===0?"None selected":t.length===this.orderStatuses.length?"All selected":t.join(", ")}allStatusesSelected(){return this.orderStatuses.every(t=>this.selectedStatusesMap[t])}toggleSelectAllStatuses(t){let e=t.target.checked;this.orderStatuses.forEach(n=>this.selectedStatusesMap[n]=e),this.onStatusFilterChange()}assignDriver(t,e){let n=e.target.value,a=this.trucks[0].id;if(!n||!a){this.toastService.showError("Please select a valid driver");return}t.driverId=n,t.truckId=a,this.ordersService.assignDriver(t).subscribe({next:d=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},error:d=>{this.toastService.showError("Error assigning driver and truck:"+d)}})}static \u0275fac=function(e){return new(e||o)(x(L),x(j),x(P),x(G),x(R),x(J))};static \u0275cmp=I({type:o,selectors:[["app-orders"]],decls:43,vars:6,consts:[["noDriverAssigned",""],[1,"p-6","pt-0"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],[1,"mb-4","flex","items-center","gap-4","relative"],[1,"flex","items-center","gap-2","relative"],[1,"font-semibold","text-green-900","mr-2"],[1,"relative"],["type","button",1,"bg-green-50","border","border-green-200","rounded","px-4","py-2","text-sm","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","stroke-width","2","viewBox","0 0 24 24",1,"w-4","h-4","ml-1"],["stroke-linecap","round","stroke-linejoin","round","d","M19 9l-7 7-7-7"],["class","absolute left-0 mt-2 w-56 bg-white border border-green-200 rounded shadow-lg z-10",4,"ngIf"],["class","fixed inset-0 z-0","style","background: transparent",3,"click",4,"ngIf"],[1,"bg-green-50","border","border-green-200","rounded","px-4","py-2","text-sm",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"overflow-x-auto","rounded-lg","shadow-lg","bg-white"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-green-900","text-white"],[1,"px-4","py-3","text-left","font-semibold"],[1,"bg-white","divide-y","divide-gray-100"],["class","hover:bg-green-50 transition",4,"ngFor","ngForOf"],[1,"absolute","left-0","mt-2","w-56","bg-white","border","border-green-200","rounded","shadow-lg","z-10"],[1,"px-3","py-2","border-b","border-green-100","flex","flex-col","gap-1"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"accent-green-600",3,"change","checked"],[1,"font-semibold"],[1,"max-h-48","overflow-y-auto","px-3","py-2","flex","flex-col","gap-1"],["class","flex items-center gap-2 cursor-pointer",4,"ngFor","ngForOf"],["type","checkbox",1,"accent-green-600",3,"ngModelChange","change","ngModel"],[1,"fixed","inset-0","z-0",2,"background","transparent",3,"click"],[3,"value"],[1,"hover:bg-green-50","transition"],[1,"px-4","py-1","font-medium","text-green-900"],[1,"mt-1","inline-block","px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[1,"px-4","py-1"],[1,"text-xs","text-gray-500"],[4,"ngIf","ngIfElse"],[1,"bg-blue-600","hover:bg-blue-700","transition","text-white","px-3","py-1","rounded","shadow",3,"click"],[1,"bg-gray-50","border","border-gray-200","rounded","px-2","py-1","text-sm","w-full",3,"change"]],template:function(e,n){e&1&&(i(0,"div",1)(1,"h2",2)(2,"span"),s(3,"\u{1F4E6}"),r(),s(4," Orders "),r(),i(5,"div",3)(6,"div",4)(7,"label",5),s(8,"Status:"),r(),i(9,"div",6)(10,"button",7),g("click",function(){return n.showStatusDropdown=!n.showStatusDropdown}),s(11),O(),i(12,"svg",8),D(13,"path",9),r()(),u(14,X,8,2,"div",10),r(),u(15,Y,1,0,"div",11),r(),k(),i(16,"div",4)(17,"label",5),s(18,"Customer:"),r(),i(19,"select",12),y("ngModelChange",function(d){return w(n.selectedCustomer,d)||(n.selectedCustomer=d),d}),g("change",function(){return n.onCustomerFilterChange()}),i(20,"option",13),s(21,"All"),r(),u(22,ee,2,2,"option",14),r()()(),i(23,"div",15)(24,"table",16)(25,"thead",17)(26,"tr")(27,"th",18),s(28,"Order #"),r(),i(29,"th",18),s(30,"Customer"),r(),i(31,"th",18),s(32,"Load #"),r(),i(33,"th",18),s(34,"Origin"),r(),i(35,"th",18),s(36,"Destination"),r(),i(37,"th",18),s(38,"Driver"),r(),i(39,"th",18),s(40,"Actions"),r()()(),i(41,"tbody",19),u(42,ne,31,20,"tr",20),r()()()()),e&2&&(l(11),f(" ",n.getSelectedStatusesLabel()," "),l(3),m("ngIf",n.showStatusDropdown),l(),m("ngIf",n.showStatusDropdown),l(4),C("ngModel",n.selectedCustomer),l(3),m("ngForOf",n.customerNames),l(20),m("ngForOf",n.filteredOrders))},dependencies:[N,A,V,q,H,Z,W,B,z,$],encapsulation:2})};export{K as OrdersComponent};
