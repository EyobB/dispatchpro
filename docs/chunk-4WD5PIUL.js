import{a as oe}from"./chunk-MSIQXZHU.js";import{a as de}from"./chunk-EFQSH5YV.js";import{a as re}from"./chunk-OV624ATH.js";import{a as le}from"./chunk-S57OZ2R5.js";import{b as ne}from"./chunk-UIIJYSZH.js";import{a as te}from"./chunk-3QMJAE3L.js";import{a as V,c as C}from"./chunk-7GTRUKFK.js";import{a as ie}from"./chunk-7FUB44TE.js";import{b as X,d as q,g as H,i as K,l as Q,m as Y,n as $,u as ee}from"./chunk-2PVWNWUN.js";import"./chunk-LIL63FBP.js";import{a as Z}from"./chunk-OXCJF6DH.js";import"./chunk-NBSK5KUW.js";import{a as J}from"./chunk-IMHYAPIP.js";import"./chunk-XPCCV2FB.js";import{c as W,e as B,f as z,j as G}from"./chunk-3TOGTSGL.js";import"./chunk-FSJQQIFH.js";import{l as R,m as L}from"./chunk-QAAQ2EEP.js";import{$ as u,Ab as S,Bb as f,Cb as E,Db as O,Eb as w,Fb as b,Gb as y,Ha as M,Jb as A,La as l,Qa as h,Qb as j,Va as N,_ as p,_a as g,a as F,gb as s,ib as U,jb as T,kb as n,lb as e,mb as I,pb as x,sb as v,tb as _,x as P,yb as k,zb as t}from"./chunk-QJGZKU5F.js";var se=d=>["/order-checkins-map",d];function ce(d,o){if(d&1&&(n(0,"option",40),t(1),e()),d&2){let i=o.$implicit;s("value",i.id),l(),f(" ",i.name," ")}}function me(d,o){if(d&1&&(n(0,"div",41)(1,"div"),t(2),e(),n(3,"div"),t(4),e()()),d&2){let i=_();l(2),S(i.selectedDriver==null?null:i.selectedDriver.phone),l(2),E("License: ",i.selectedDriver==null?null:i.selectedDriver.licenseState," - ",i.selectedDriver==null?null:i.selectedDriver.licenseNumber,"")}}function pe(d,o){if(d&1&&(n(0,"option",40),t(1),e()),d&2){let i=o.$implicit;s("value",i.id),l(),E(" ",i.plate," - ",i.type," ")}}function ue(d,o){if(d&1&&(n(0,"div",41)(1,"div"),t(2),e(),n(3,"div"),t(4),e()()),d&2){let i=_();l(2),S(i.selectedTruck==null?null:i.selectedTruck.type),l(2),f("DOT: ",i.selectedTruck==null?null:i.selectedTruck.dotNumber,"")}}function ve(d,o){if(d&1){let i=x();n(0,"li")(1,"a",44),v("click",function(){let a=p(i).$implicit,c=_(2);return u(c.viewDocument(a))}),t(2),e()()}if(d&2){let i=o.$implicit;l(2),E(" ",i.documentType," (",i.fileName,") ")}}function ge(d,o){if(d&1&&(n(0,"div")(1,"ul",42),g(2,ve,3,2,"li",43),e()()),d&2){let i=_();l(2),s("ngForOf",i.order.documents)}}function _e(d,o){if(d&1){let i=x();n(0,"div")(1,"a",45)(2,"span"),t(3,"\u{1F4C4}"),e(),t(4," View PoD Document "),e(),n(5,"button",46),v("click",function(){p(i);let a=_();return u(a.removePod())}),t(6," Remove "),e()()}if(d&2){let i=_();l(),s("href",i.podUrl,M)}}function fe(d,o){d&1&&(n(0,"span"),t(1,"Upload PoD"),e())}function he(d,o){d&1&&(n(0,"span"),t(1,"Uploading..."),e())}function De(d,o){if(d&1&&(n(0,"div",51),t(1),e()),d&2){let i=_(2);l(),f(" ",i.uploadError," ")}}function xe(d,o){if(d&1){let i=x();n(0,"div",47),t(1,"No PoD uploaded."),e(),n(2,"input",48,1),v("change",function(a){p(i);let c=_();return u(c.onFileSelected(a))}),e(),n(4,"button",49),v("click",function(){p(i);let a=k(3);return u(a.click())}),g(5,fe,2,0,"span",26)(6,he,2,0,"span",26),e(),g(7,De,2,1,"div",50)}if(d&2){let i=_();l(4),s("disabled",i.isUploading),l(),s("ngIf",!i.isUploading),l(),s("ngIf",i.isUploading),l(),s("ngIf",i.uploadError)}}function Se(d,o){if(d&1){let i=x();n(0,"div",52)(1,"div",53)(2,"span",15),t(3),e(),n(4,"input",54),y("ngModelChange",function(a){let c=p(i).$implicit;return b(c.amount,a)||(c.amount=a),u(a)}),e()()()}if(d&2){let i=o.$implicit;U("opacity-60",i.amount===0),l(3),S(i.description),l(),w("ngModel",i.amount)}}function we(d,o){d&1&&(n(0,"li",60)(1,"span",61),t(2,"\u2022"),e(),t(3," Driver must be selected "),e())}function be(d,o){d&1&&(n(0,"li",60)(1,"span",61),t(2,"\u2022"),e(),t(3," Truck must be selected "),e())}function ye(d,o){d&1&&(n(0,"li",60)(1,"span",61),t(2,"\u2022"),e(),t(3," Proof of Delivery (PoD) document must be uploaded "),e())}function Ee(d,o){d&1&&(n(0,"li",60)(1,"span",61),t(2,"\u2022"),e(),t(3," PoD # must be entered "),e())}function Ce(d,o){if(d&1&&(n(0,"div",55)(1,"div",56)(2,"p",57),t(3,"Cannot convert to invoice:"),e(),n(4,"ul",58),g(5,we,4,0,"li",59)(6,be,4,0,"li",59)(7,ye,4,0,"li",59)(8,Ee,4,0,"li",59),e()()()),d&2){let i=_();l(5),s("ngIf",!i.order.driverId),l(),s("ngIf",!i.order.truckId),l(),s("ngIf",!i.isPodUploaded),l(),s("ngIf",!i.order.podNumber)}}var ae=class d{constructor(o,i,r,a,c,m,D){this.router=o;this.route=i;this.ordersService=r;this.driversService=a;this.trucksService=c;this.settingsService=m;this.toastService=D}order=new ne;podUrl=null;availableDrivers=[];availableTrucks=[];selectedDriver=null;selectedTruck=null;costTypes=[];isUploading=!1;uploadError=null;showDocumentViewer=!1;currentDocument=new V;documentTypes=[C.RATE_CON];ngOnInit(){let o=this.route.snapshot.paramMap.get("id")||"";P({order:this.ordersService.getOrder(o),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks(),settings:this.settingsService.getSettings()}).subscribe(({order:i,drivers:r,trucks:a,settings:c})=>{this.order=i,this.availableDrivers=r,this.availableTrucks=a,this.onDriverSelect(),this.onTruckSelect(),this.costTypes=c.driverCosts,this.costTypes=c.driverCosts,this.costTypes.forEach(m=>{if(this.order.driverCosts=this.order.driverCosts||[],!this.order.driverCosts.some(D=>D.description===m)){let D=new oe;D.description=m,D.amount=0,this.order.driverCosts.push(D)}})})}updateOrder(){this.order.driverId=this.order.driverId||null,this.order.truckId=this.order.truckId||null,this.ordersService.updateOrder(this.order).subscribe(()=>{this.toastService.showSuccess("Order updated successfully")},o=>{console.error("Error updating order:",o)})}assignDriverTruck(){this.ordersService.assignDriver(this.order).subscribe(()=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},o=>{console.error("Error assigning driver and truck:",o)})}markDelivered(){this.order&&(this.order.status="Delivered")}get isPodUploaded(){return this.order.documents?.some(o=>o.documentType===C.POD)??!1}markInTransit(){this.order&&(this.order.status="In Transit")}deleteOrder(){this.order&&confirm("Are you sure you want to delete this order?")&&this.ordersService.deleteOrder(this.order.id).subscribe(()=>{this.toastService.showSuccess("Order deleted successfully"),this.router.navigate(["/dispatcher/orders"])},o=>{console.error("Error deleting order:",o),this.toastService.showError("Failed to delete order")})}onFileSelected(o){let i=o.target.files[0];if(!i)return;if(!["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(i.type)){this.uploadError="Please select a valid file (PDF, JPG, PNG, DOC, DOCX)";return}let a=5*1024*1024;if(i.size>a){this.uploadError="File size must be less than 5MB";return}this.uploadPodFile(i)}uploadPodFile(o){this.isUploading=!0,this.uploadError=null;let i=URL.createObjectURL(o);setTimeout(()=>{let r={id:"1",documentType:C.POD,url:i,fileType:o.type,fileName:o.name,expires:"2025-12-31"};this.order.documents||(this.order.documents=[]),this.order.documents=this.order.documents,this.order.documents.push(r),this.podUrl=i,this.isUploading=!1},1e3)}removePod(){confirm("Are you sure you want to remove the PoD document?")&&(this.order.documents&&(this.order.documents=this.order.documents.filter(o=>o.documentType!=="PoD")),this.podUrl=null)}addDocument(o){o.documentType&&o.url&&o.expires&&(this.order.documents=this.order.documents||[],this.order.documents.push(F({},o)))}createInvoice(){console.log(this.order),this.ordersService.updateOrder(this.order).subscribe(()=>{this.router.navigate(["/dispatcher/order-to-invoice",this.order.id])},o=>{console.error("Error updating order:",o)})}onDriverSelect(){this.selectedDriver=this.availableDrivers.find(o=>o.id===this.order.driverId)??null}onTruckSelect(){this.selectedTruck=this.availableTrucks.find(o=>o.id===this.order.truckId)??null}isValidForInvoice(){return!!(this.order.driverId&&this.order.truckId&&this.isPodUploaded&&this.order.podNumber)}viewDocument(o){this.currentDocument=o,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new V}onDownloadError(o){console.error("Download failed:",o),this.toastService.showError("Failed to download document")}static \u0275fac=function(i){return new(i||d)(h(B),h(W),h(ie),h(J),h(re),h(le),h(Z))};static \u0275cmp=N({type:d,selectors:[["app-order-detail"]],decls:124,vars:38,consts:[["noPod",""],["fileInput",""],[1,"max-w-3xl","mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"text-3xl","font-bold","mb-2","text-green-900","flex","items-center","gap-2"],[1,"mb-4","flex","gap-2","text-gray-600"],[1,"bg-gray-100","px-3","py-1","rounded"],[1,"font-medium"],[1,"flex-1"],[1,"bg-blue-100","px-3","py-1","rounded","hover:bg-blue-200","transition",3,"routerLink"],[1,"text-blue-600"],["routerLink","/dispatcher/orders",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"mb-4","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"font-semibold"],[1,"mb-4"],[1,"flex","flex-col","sm:flex-row","gap-8"],[1,"flex-1","bg-gray-50","rounded","p-4"],[1,"text-xs","text-gray-500"],[1,"mt-2"],[1,"w-full","p-2","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-2 p-2 mt-0 pt-0 bg-white rounded shadow-sm text-xs text-gray-900",4,"ngIf"],[3,"click","disabled"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"py-2","w-1/2"],[3,"documentAdded","orderId","documentTypes"],[1,"w-36","p-1","mb-4","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"mb-4","flex-row"],[1,"space-y-0","w-1/2"],["class","bg-gray-50 p-2 rounded transition-colors",3,"opacity-60",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],["class","w-full mb-4",4,"ngIf"],[1,"bg-red-600","hover:bg-red-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-green-600","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"px-6","py-2","rounded","shadow","font-semibold","transition",3,"click","disabled"],[3,"close","downloadError","document","isVisible"],[3,"value"],[1,"mt-2","p-2","mt-0","pt-0","bg-white","rounded","shadow-sm","text-xs","text-gray-900"],[1,"list-disc","pl-5","space-y-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],["target","_blank",1,"text-blue-700","hover:underline","flex","items-center","gap-1","font-medium",3,"href"],[1,"ml-4","bg-red-500","hover:bg-red-600","text-white","px-3","py-1","rounded","text-sm",3,"click"],[1,"text-gray-500","italic","mb-2"],["type","file","accept",".pdf,.jpg,.jpeg,.png,.doc,.docx",1,"hidden",3,"change"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded",3,"click","disabled"],["class","mt-2 text-red-600 text-sm",4,"ngIf"],[1,"mt-2","text-red-600","text-sm"],[1,"bg-gray-50","p-2","rounded","transition-colors"],[1,"flex","justify-between","items-center","mb-1"],["type","number","placeholder","0.00",1,"w-36","p-1","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-red-50","border","border-red-200","rounded","p-3"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","space-y-1"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500"]],template:function(i,r){if(i&1){let a=x();n(0,"div",2)(1,"h2",3)(2,"span"),t(3,"\u{1F4E6}"),e(),t(4," Order Details "),e(),n(5,"div",4)(6,"div",5)(7,"span",6),t(8,"Order #:"),e(),t(9),e(),n(10,"div",5)(11,"span",6),t(12,"Load #:"),e(),t(13),e(),I(14,"div",7),n(15,"a",8)(16,"span",6),t(17,"View Map"),e(),n(18,"span",9),t(19,"\u{1F4CD}"),e()(),n(20,"a",10)(21,"span",11),t(22,"\u2190"),e(),t(23," Go Back "),e()(),n(24,"div",12)(25,"h3",13)(26,"span"),t(27,"\u{1F464}"),e(),t(28," Customer Information "),e(),n(29,"div",14)(30,"div")(31,"span",15),t(32,"Name:"),e(),t(33),e(),n(34,"div")(35,"span",15),t(36,"Contact:"),e(),t(37),e()()(),n(38,"div",16)(39,"h3",13)(40,"span"),t(41,"\u{1F5FA}\uFE0F"),e(),t(42," Route "),e(),n(43,"div",17)(44,"div",18)(45,"span",15),t(46,"Origin:"),e(),n(47,"div",6),t(48),e(),n(49,"div",19),t(50),e()(),n(51,"div",18)(52,"span",15),t(53,"Destination:"),e(),n(54,"div",6),t(55),e(),n(56,"div",19),t(57),e()()()(),n(58,"div",16)(59,"h3",13)(60,"span"),t(61,"\u{1F4E6}"),e(),t(62," Load Details "),e(),n(63,"div")(64,"span",15),t(65,"Description:"),e(),t(66),e()(),n(67,"div",16)(68,"h3",13)(69,"span"),t(70,"\u{1F9D1}\u200D\u2708\uFE0F"),e(),t(71," Driver & Truck "),e(),n(72,"div",17)(73,"div",7)(74,"span",15),t(75,"Driver: "),e(),n(76,"div",20)(77,"select",21),y("ngModelChange",function(m){return p(a),b(r.order.driverId,m)||(r.order.driverId=m),u(m)}),v("change",function(){return p(a),u(r.onDriverSelect())}),n(78,"option",22),t(79,"Select a driver"),e(),g(80,ce,2,2,"option",23),e(),g(81,me,5,3,"div",24),e()(),n(82,"div",7)(83,"span",15),t(84,"Truck: "),e(),n(85,"div",20)(86,"select",21),y("ngModelChange",function(m){return p(a),b(r.order.truckId,m)||(r.order.truckId=m),u(m)}),v("change",function(){return p(a),u(r.onTruckSelect())}),n(87,"option",22),t(88,"Select a truck"),e(),g(89,pe,2,3,"option",23),e(),g(90,ue,5,2,"div",24),e()()(),n(91,"button",25),v("click",function(){return p(a),u(r.assignDriverTruck())}),t(92," Assign Driver & Truck "),e()(),n(93,"div",16)(94,"h3",13)(95,"span"),t(96,"\u{1F4C4}"),e(),t(97," Documents "),e(),g(98,ge,3,1,"div",26)(99,_e,7,1,"div",27)(100,xe,8,4,"ng-template",null,0,j),e(),n(102,"div",28)(103,"app-add-document",29),v("documentAdded",function(m){return p(a),u(r.addDocument(m))}),e()(),n(104,"span",15),t(105,"PoD #:"),e(),I(106,"br"),n(107,"input",30),y("ngModelChange",function(m){return p(a),b(r.order.podNumber,m)||(r.order.podNumber=m),u(m)}),e(),n(108,"div",31)(109,"h3",13)(110,"span"),t(111,"\u{1F4B2}"),e(),t(112," Driver Costs "),e(),n(113,"div",32),g(114,Se,5,4,"div",33),e()(),n(115,"div",34),g(116,Ce,9,4,"div",35),n(117,"button",36),v("click",function(){return p(a),u(r.deleteOrder())}),t(118," Delete Order "),e(),n(119,"button",37),v("click",function(){return p(a),u(r.updateOrder())}),t(120," Update Order "),e(),n(121,"button",38),v("click",function(){return p(a),u(r.createInvoice())}),t(122," Convert To Invoice "),e()()(),n(123,"app-document-viewer",39),v("close",function(){return p(a),u(r.closeDocumentViewer())})("downloadError",function(m){return p(a),u(r.onDownloadError(m))}),e()}if(i&2){let a=k(101);l(9),f(" ",r.order.orderNumber," "),l(4),f(" ",r.order.loadNumber," "),l(2),s("routerLink",A(36,se,r.order.id)),l(18),f(" ",r.order.brokerName,""),l(4),f(" ",r.order.brokerContact,""),l(11),S(r.order.originStreetAddress),l(2),O("",r.order.originCity,", ",r.order.originState," ",r.order.originZipcode," "),l(5),S(r.order.destinationStreetAddress),l(2),O("",r.order.destinationCity,", ",r.order.destinationState," ",r.order.destinationZipcode,""),l(9),f(" ",r.order.description," "),l(11),w("ngModel",r.order.driverId),l(3),s("ngForOf",r.availableDrivers),l(),s("ngIf",r.order.driverId),l(5),w("ngModel",r.order.truckId),l(3),s("ngForOf",r.availableTrucks),l(),s("ngIf",r.order.truckId),l(),T(!r.order.driverId||!r.order.truckId?"bg-gray-300 text-gray-500 cursor-not-allowed p-2 my-2 rounded":"bg-green-600 hover:bg-green-700 text-white p-2 my-2 rounded"),s("disabled",!r.order.driverId||!r.order.truckId),l(7),s("ngIf",r.order.documents&&r.order.documents.length>0),l(),s("ngIf",r.podUrl)("ngIfElse",a),l(4),s("orderId",r.order.id)("documentTypes",r.documentTypes),l(4),w("ngModel",r.order.podNumber),l(7),s("ngForOf",r.order.driverCosts),l(2),s("ngIf",!r.isValidForInvoice()),l(5),T(r.isValidForInvoice()?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),s("disabled",!r.isValidForInvoice()),l(2),s("document",r.currentDocument)("isVisible",r.showDocumentViewer)}},dependencies:[L,R,G,z,ee,Y,$,X,K,Q,q,H,de,te],encapsulation:2})};export{ae as OrderDetailComponent};
