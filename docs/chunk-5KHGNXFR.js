import{b as te}from"./chunk-DDEBU2FK.js";import{a as ie}from"./chunk-WZM2Q2QH.js";import{a as q}from"./chunk-JIP63XM4.js";import{a as ee}from"./chunk-EXVUTR7V.js";import"./chunk-7GTRUKFK.js";import{a as H,b as J,d as K,g as Q,l as X,m as Y,n as Z,u as $}from"./chunk-WJZQNLUY.js";import"./chunk-CQAPK5K2.js";import{a as G}from"./chunk-A3LUHI23.js";import"./chunk-IOPBYQJQ.js";import"./chunk-LFAOHVAW.js";import"./chunk-XPCCV2FB.js";import{c as U}from"./chunk-V26HN3KH.js";import"./chunk-5UMXG57Q.js";import{k as j,l as z,o as L,q as R}from"./chunk-O5HBUBIU.js";import{$ as p,Ab as v,Db as C,Eb as S,Fb as I,Hb as D,Ka as s,Nb as k,Pa as f,Pb as A,Qb as P,Rb as W,Ua as N,Za as g,_ as m,aa as T,fb as l,jb as t,kb as e,lb as E,mb as F,nb as B,ob as w,rb as b,sb as h,x as M,xb as O,yb as n,zb as _}from"./chunk-ITTAAY47.js";var x=class{street;city;state;zip;constructor(){this.street="",this.city="",this.state="",this.zip=""}};var y=class{id;invoiceNumber;loadNumber;podNumber;brokerName;brokerEmail;invoiceDate;dueDate;totalCost;status;orderId;terms;paymentInstructions;notes;lineItems;factoring;service;loadDetails;pickupDate;deliveryDate;origin;destination;documents;constructor(){this.id="",this.invoiceNumber="",this.loadNumber="",this.podNumber="",this.brokerName="",this.brokerEmail="",this.invoiceDate="",this.dueDate="",this.totalCost=0,this.status="",this.orderId="",this.terms="",this.paymentInstructions="",this.notes="",this.service="",this.loadDetails="",this.pickupDate="",this.deliveryDate="",this.origin=new x,this.destination=new x,this.lineItems=[],this.documents=[]}};var V=()=>({standalone:!0});function re(o,a){o&1&&(t(0,"div",33)(1,"div",34),E(2,"div",35),t(3,"p",36),n(4,"Loading invoice..."),e()()())}function oe(o,a){if(o&1){let r=w();t(0,"li")(1,"a",39),b("click",function(){let c=m(r).$implicit,u=h(2);return p(u.viewDocument(c))}),n(2),e()()}if(o&2){let r=a.$implicit;s(2),v(" ",r.documentType,"")}}function ae(o,a){if(o&1&&(F(0),t(1,"ul",37),g(2,oe,3,1,"li",38),e(),B()),o&2){let r=h();s(2),l("ngForOf",r.invoice.documents)}}function se(o,a){o&1&&(t(0,"div",40),n(1,"No documents available."),e())}function le(o,a){o&1&&(t(0,"span"),n(1,"\u{1F4BE} Update Invoice"),e())}function ce(o,a){o&1&&(t(0,"span"),n(1,"\u23F3 Updating..."),e())}function de(o,a){o&1&&(T(),t(0,"svg",43),E(1,"circle",44)(2,"path",45),e())}function me(o,a){o&1&&(t(0,"span"),n(1,"\u{1F4E4}"),e())}function pe(o,a){if(o&1){let r=w();t(0,"button",41),b("click",function(){m(r);let c=h();return p(c.sendToBroker())}),g(1,de,3,0,"svg",42)(2,me,2,0,"span",30),t(3,"span"),n(4),e()()}if(o&2){let r=h();l("disabled",r.sending||r.invoice.status==="Sent"),s(),l("ngIf",r.sending),s(),l("ngIf",!r.sending),s(2),v(" ",r.sending?"Sending...":r.invoice.status==="Sent"?"Already Sent":"Send to Broker"," ")}}var ne=class o{constructor(a,r,i,c){this.carrierService=a;this.invoiceService=r;this.route=i;this.toastService=c}loading=!1;carrier=null;invoice=new y;order=new te;sending=!1;showDocumentViewer=!1;currentDocument=null;saving=!1;ensureInvoiceDefaults(){this.invoice&&(this.invoice.status==null&&(this.invoice.status="New"),this.invoice.factoring==null&&(this.invoice.factoring=!1),this.invoice.notes==null&&(this.invoice.notes=""))}ngOnInit(){let a=this.route.snapshot.paramMap.get("id");if(!a)throw new Error("Invoice ID is required");this.loading=!0,M({carrier:this.carrierService.getCarrier(),invoice:this.invoiceService.getCarrierInvoice(a)}).subscribe(({carrier:r,invoice:i})=>{this.carrier=r,this.invoice=i,this.ensureInvoiceDefaults(),this.loading=!1},r=>{this.loading=!1,console.error("Error loading invoice details:",r),this.toastService.showError("Failed to load invoice details.")})}get subtotal(){return this.invoice.lineItems?.reduce((a,r)=>a+r.amount,0)}get grandTotal(){return this.subtotal}sendToBroker(){this.sending=!0,this.invoiceService.sendCarrierInvoiceToBroker(this.invoice.id).subscribe(()=>{this.toastService.showSuccess("Invoice sent to broker successfully"),this.invoice.status="Sent",this.sending=!1},a=>{console.error("Failed to send invoice to broker",a),this.toastService.showError("Failed to send invoice to broker"),this.sending=!1})}viewDocument(a){this.currentDocument=a,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=null}onDownloadError(a){console.error("Download failed:",a),this.toastService.showError("Failed to download document")}updateInvoice(){if(this.saving)return;this.saving=!0;let a={status:this.invoice.status,notes:this.invoice.notes,factoring:this.invoice.factoring};this.invoiceService.updateCarrierInvoiceStatus(this.invoice.id,a).subscribe(()=>{this.toastService.showSuccess("Invoice updated successfully"),this.saving=!1},r=>{console.error("Failed to save invoice",r),this.toastService.showError("Failed to update invoice"),this.saving=!1})}static \u0275fac=function(r){return new(r||o)(f(q),f(ie),f(U),f(G))};static \u0275cmp=N({type:o,selectors:[["app-invoice-detail"]],decls:81,vars:33,consts:[["noDocs",""],["class","fixed inset-0 z-50 grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"mx-auto","max-w-4xl","p-4","bg-white","rounded-2xl","shadow-2xl","border","border-green-100","print:shadow-none","print:border-0","print:p-0"],[1,"flex","items-center","justify-between","gap-4","mb-3"],[1,"text-xl","font-extrabold","text-green-900","tracking-tight","flex","items-center","gap-2"],[1,"hidden","sm:inline-flex","items-center","rounded-full","bg-green-50","text-green-800","px-3","py-1","text-xs","font-medium","border","border-green-100"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-1"],[1,"rounded-lg","border","border-green-100","bg-green-50/40","p-1"],[1,"text-[11px]","font-semibold","uppercase","tracking-wide","text-green-700"],[1,"mt-1","text-base","text-gray-900"],[1,"mt-1","text-xl","font-semibold","text-green-700"],[1,"mt-1","text-gray-900"],[1,"mt-5","border-t","border-green-200","pt-4"],[1,"font-semibold","text-base","text-green-900","mb-2.5","flex","items-center","gap-2"],[1,"mt-1","w-full","border","border-green-200","rounded","px-1.5","py-0.5","focus:outline-none","focus:ring-2","focus:ring-green-400",3,"ngModelChange","ngModel","ngModelOptions"],["value","New"],["value","Sent"],["value","Paid"],["value","Void"],[1,"rounded-lg","border","border-green-100","bg-green-50/40","p-1","flex","items-center"],[1,"inline-flex","items-center","gap-2"],["type","checkbox",1,"h-3","w-3","text-green-600","border-green-300","rounded",3,"ngModelChange","ngModel","ngModelOptions"],[1,"font-medium","text-gray-900"],[1,"rounded-lg","border","border-green-100","bg-green-50/40","p-1","sm:col-span-2","lg:col-span-3"],["rows","3","placeholder","Add notes...",1,"mt-1","w-full","border","border-green-200","rounded","px-2","py-0.5","focus:outline-none","focus:ring-2","focus:ring-green-400",3,"ngModelChange","ngModel","ngModelOptions"],[4,"ngIf","ngIfElse"],[1,"mt-5","flex","flex-col","sm:flex-row","items-stretch","sm:items-center","justify-between","gap-2","print:hidden"],[1,"sm:hidden","inline-flex","items-center","rounded-full","bg-green-50","text-green-800","px-3","py-1","text-xs","font-medium","border","border-green-100"],[1,"flex","gap-2"],[1,"bg-green-600","hover:bg-green-700","text-white","px-3","py-1","rounded","shadow","font-semibold","transition","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[4,"ngIf"],["class","bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-3 py-1 rounded shadow font-semibold transition flex items-center gap-2",3,"disabled","click",4,"ngIf"],[3,"close","downloadError","document","isVisible"],[1,"fixed","inset-0","z-50","grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"flex","items-center","justify-between","gap-3","rounded-lg","border","border-green-100","bg-white","px-2","py-1","text-blue-700","hover:bg-blue-50/40","hover:border-blue-200","transition","break-all",3,"click"],[1,"text-sm","text-gray-600","italic"],[1,"bg-blue-600","hover:bg-blue-700","disabled:bg-gray-400","disabled:cursor-not-allowed","text-white","px-3","py-1","rounded","shadow","font-semibold","transition","flex","items-center","gap-2",3,"click","disabled"],["class","animate-spin h-4 w-4 text-white","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(r,i){if(r&1){let c=w();g(0,re,5,0,"div",1),t(1,"div",2)(2,"div",3)(3,"h2",4)(4,"span"),n(5,"\u{1F9FE}"),e(),n(6," Carrier Invoice "),e(),t(7,"span",5),n(8),e()(),t(9,"dl",6)(10,"div",7)(11,"dt",8),n(12,"Invoice #"),e(),t(13,"dd",9),n(14),e()(),t(15,"div",7)(16,"dt",8),n(17,"Load #"),e(),t(18,"dd",9),n(19),e()(),t(20,"div",7)(21,"dt",8),n(22,"PoD #"),e(),t(23,"dd",9),n(24),e()(),t(25,"div",7)(26,"dt",8),n(27,"Total Cost"),e(),t(28,"dd",10),n(29),k(30,"currency"),e()(),t(31,"div",7)(32,"dt",8),n(33,"Invoice Date"),e(),t(34,"dd",11),n(35),k(36,"date"),e()()(),t(37,"div",12)(38,"h3",13)(39,"span"),n(40,"\u{1F6E0}\uFE0F"),e(),n(41," Invoice Settings "),e(),t(42,"div",6)(43,"div",7)(44,"label",8),n(45,"Status"),e(),t(46,"select",14),I("ngModelChange",function(d){return m(c),S(i.invoice.status,d)||(i.invoice.status=d),p(d)}),t(47,"option",15),n(48,"New"),e(),t(49,"option",16),n(50,"Sent"),e(),t(51,"option",17),n(52,"Paid"),e(),t(53,"option",18),n(54,"Void"),e()()(),t(55,"div",19)(56,"label",20)(57,"input",21),I("ngModelChange",function(d){return m(c),S(i.invoice.factoring,d)||(i.invoice.factoring=d),p(d)}),e(),t(58,"span",22),n(59,"Factoring"),e()()(),t(60,"div",23)(61,"label",8),n(62,"Remark"),e(),t(63,"textarea",24),I("ngModelChange",function(d){return m(c),S(i.invoice.notes,d)||(i.invoice.notes=d),p(d)}),e()()()(),t(64,"div",12)(65,"h3",13)(66,"span"),n(67,"\u{1F4CE}"),e(),n(68," Documents "),e(),g(69,ae,3,1,"ng-container",25)(70,se,2,0,"ng-template",null,0,W),e(),t(72,"div",26)(73,"span",27),n(74),e(),t(75,"div",28)(76,"button",29),b("click",function(){return m(c),p(i.updateInvoice())}),g(77,le,2,0,"span",30)(78,ce,2,0,"span",30),e(),g(79,pe,5,4,"button",31),e()()(),t(80,"app-document-viewer",32),b("close",function(){return m(c),p(i.closeDocumentViewer())})("downloadError",function(d){return m(c),p(i.onDownloadError(d))}),e()}if(r&2){let c=O(71);l("ngIf",i.loading),s(8),v(" Broker: ",i.invoice.brokerEmail||"\u2014"," "),s(6),_(i.invoice.invoiceNumber||"\u2014"),s(5),_(i.invoice.loadNumber||"\u2014"),s(5),_(i.invoice.podNumber||"\u2014"),s(5),v(" ",P(30,22,i.invoice.totalCost,"USD","symbol","1.2-2")," "),s(6),v(" ",A(36,27,i.invoice.invoiceDate,"mediumDate")," "),s(11),C("ngModel",i.invoice.status),l("ngModelOptions",D(30,V)),s(11),C("ngModel",i.invoice.factoring),l("ngModelOptions",D(31,V)),s(6),C("ngModel",i.invoice.notes),l("ngModelOptions",D(32,V)),s(6),l("ngIf",i.invoice.documents==null?null:i.invoice.documents.length)("ngIfElse",c),s(5),v(" Broker: ",i.invoice.brokerEmail||"\u2014"," "),s(2),l("disabled",i.saving||i.loading),s(),l("ngIf",!i.saving),s(),l("ngIf",i.saving),s(),l("ngIf",i.invoice.status=="New"||i.invoice.status=="Sent"),s(),l("document",i.currentDocument)("isVisible",i.showDocumentViewer)}},dependencies:[z,j,$,Y,Z,J,H,X,K,Q,L,R,ee],encapsulation:2})};export{ne as CarrierInvoiceDetailComponent};
