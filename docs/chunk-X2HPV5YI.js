import{a as J,b as K}from"./chunk-DDEBU2FK.js";import{a as A,b as G,c as W}from"./chunk-7GTRUKFK.js";import{a as q}from"./chunk-2EMIZEML.js";import{b as B,d as R,g as z,q as L,u as j}from"./chunk-WJZQNLUY.js";import{a as H}from"./chunk-CQAPK5K2.js";import"./chunk-IOPBYQJQ.js";import"./chunk-LFAOHVAW.js";import"./chunk-XPCCV2FB.js";import{c as O,e as N}from"./chunk-V26HN3KH.js";import"./chunk-5UMXG57Q.js";import{l as M,r as V}from"./chunk-O5HBUBIU.js";import{$ as m,Ab as I,Db as k,Eb as D,Fb as T,Ga as P,Ka as l,Pa as b,Ua as E,Za as h,_ as p,aa as v,ba as _,fb as s,gb as U,hb as C,jb as i,kb as n,lb as u,ob as w,rb as g,sb as c,x as S,xb as F,yb as a,zb as y}from"./chunk-ITTAAY47.js";function Q(o,r){if(o&1){let e=w();i(0,"div",21),g("click",function(){p(e),c();let d=F(16);return m(d.click())}),i(1,"div",22),v(),i(2,"svg",23),u(3,"path",24)(4,"polyline",25)(5,"line",26),n()(),_(),i(6,"h3",27),a(7,"Choose a pdf file"),n(),i(8,"p",28),a(9,"Maximum file size: 10MB"),n(),i(10,"button",29),a(11," Browse Files "),n()()}}function X(o,r){if(o&1&&(i(0,"div",42),u(1,"img",43),n()),o&2){let e=c(2);l(),s("src",e.previewUrl,P)("alt",e.selectedFile.name)}}function Z(o,r){if(o&1){let e=w();i(0,"div",30)(1,"div",31),h(2,X,2,2,"div",32),i(3,"div",33)(4,"div",34),a(5),n(),i(6,"div",35)(7,"h4",36),a(8),n(),i(9,"p",37),a(10),n()(),i(11,"button",38),g("click",function(){p(e);let d=c();return m(d.removePod())}),v(),i(12,"svg",39),u(13,"line",40)(14,"line",41),n()()()()()}if(o&2){let e=c();l(2),s("ngIf",e.previewUrl),l(3),y(e.getFileIcon(e.selectedFile)),l(3),y(e.selectedFile.name),l(2),y(e.formatFileSize(e.selectedFile.size))}}function $(o,r){if(o&1&&(i(0,"div",44)(1,"div",45),u(2,"div",46),n(),i(3,"p",47),a(4),n()()),o&2){let e=c();l(2),U("width",e.uploadProgress,"%"),l(2),I("Uploading... ",e.uploadProgress,"%")}}function ee(o,r){if(o&1&&(i(0,"div",48),v(),i(1,"svg",49),u(2,"circle",50)(3,"line",51)(4,"line",52),n(),_(),i(5,"span"),a(6),n()()),o&2){let e=c();l(6),y(e.uploadError)}}function te(o,r){o&1&&(i(0,"div",53),v(),i(1,"svg",49),u(2,"polyline",54),n(),_(),i(3,"span"),a(4,"POD uploaded successfully!"),n()())}function ie(o,r){o&1&&(i(0,"span"),a(1,"Upload POD"),n())}function re(o,r){o&1&&(i(0,"span"),a(1,"Uploading..."),n())}var Y=class o{constructor(r,e,t,d){this.documentsService=r;this.ordersService=e;this.route=t;this.router=d}selectedFile=null;previewUrl=null;isUploading=!1;uploadProgress=0;uploadError=null;uploadSuccess=!1;podNumber="";allowedTypes=["image/jpeg","image/jpg","image/png","image/webp","application/pdf"];maxFileSize=5*1024*1024;order=new K;ngOnInit(){let r=this.route.snapshot.paramMap.get("id");if(!r){this.uploadError="Order ID is required to upload POD",this.isUploading=!1;return}this.ordersService.getCurrentOrder(r).subscribe(e=>{if(!e){this.uploadError="Order not found",this.isUploading=!1;return}this.order.id=r,this.order=e,this.podNumber=e.podNumber||""})}onPodSelected(r){let e=r.target;if(this.uploadError=null,this.uploadSuccess=!1,e.files&&e.files.length>0){let t=e.files[0];if(!this.allowedTypes.includes(t.type)){this.uploadError="Please select a valid image file (JPEG, PNG, WebP) or PDF";return}if(t.size>this.maxFileSize){this.uploadError="File size must be less than 5MB";return}if(this.selectedFile=t,t.type.startsWith("image/")){let d=new FileReader;d.onload=f=>{this.previewUrl=f.target?.result},d.readAsDataURL(t)}else this.previewUrl=null}else this.selectedFile=null,this.previewUrl=null}uploadPod(){if(!this.selectedFile){this.uploadError="Please select a file first";return}this.isUploading=!0,this.uploadProgress=0,this.uploadError=null;let r=new A;r.documentType=W.POD,r.fileType=this.selectedFile.type,r.fileName=this.selectedFile.name,r.expires=new Date().toISOString().substring(0,10);let e=new G(r,this.selectedFile);e.orderId=this.order.id,S({doc:this.documentsService.uploadFile(e),order:this.ordersService.updatePod(this.order.id,J.PARTIALLY_DELIVERED,this.podNumber)}).subscribe({next:({doc:t,order:d})=>{this.isUploading=!1,this.uploadSuccess=!0,this.uploadProgress=100,this.resetForm()},error:t=>{console.error("Upload failed:",t),this.isUploading=!1,this.uploadError="Failed to upload POD. Please try again.",this.uploadProgress=0}})}removePod(){this.selectedFile=null,this.previewUrl=null,this.uploadError=null,this.uploadSuccess=!1}resetForm(){this.router.navigate(["/driver/current-orders"])}getFileIcon(r){return r.type.startsWith("image/")?"\u{1F5BC}\uFE0F":r.type==="application/pdf"?"\u{1F4C4}":"\u{1F4CE}"}formatFileSize(r){if(r===0)return"0 Bytes";let e=1024,t=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,d)).toFixed(2))+" "+t[d]}static \u0275fac=function(e){return new(e||o)(b(H),b(q),b(O),b(N))};static \u0275cmp=E({type:o,selectors:[["app-upload-pod"]],decls:28,vars:14,consts:[["fileInput",""],[1,"max-w-2xl","mx-auto","p-6","font-sans"],[1,"text-center","mb-4"],[1,"text-gray-900","text-2xl","font-semibold","mb-2"],[1,"text-gray-600","text-sm"],[1,"mb-4"],["for","pod-number",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","required","","autocomplete","off","placeholder","Enter POD #",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-gray-500","mt-1"],[1,"border-2","border-dashed","rounded-xl","bg-gray-50","transition-all","duration-300","overflow-hidden"],["type","file","id","pod-file","accept","image/*,.pdf",1,"hidden",3,"change"],["class","p-4 text-center cursor-pointer transition-colors duration-200 hover:bg-gray-100",3,"click",4,"ngIf"],["class","p-6",4,"ngIf"],["class","my-4",4,"ngIf"],["class","flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-lg text-sm my-4",4,"ngIf"],["class","flex items-center gap-2 p-3 bg-green-50 text-green-700 border border-green-200 rounded-lg text-sm my-4",4,"ngIf"],[1,"flex","gap-3","justify-center","mt-6","sm:flex-row","flex-col"],["type","button",1,"px-6","py-3","bg-green-600","text-white","rounded-lg","text-sm","font-medium","transition-all","duration-200","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","sm:w-auto","w-full",3,"click","disabled"],[4,"ngIf"],["type","button",1,"px-6","py-3","bg-gray-100","text-gray-700","border","border-gray-300","rounded-lg","text-sm","font-medium","transition-all","duration-200","hover:bg-gray-200","disabled:opacity-50","disabled:cursor-not-allowed","sm:w-auto","w-full",3,"click","disabled"],[1,"p-4","text-center","cursor-pointer","transition-colors","duration-200","hover:bg-gray-100",3,"click"],[1,"text-gray-400","mb-2"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-6","h-6","mx-auto"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","7,10 12,15 17,10"],["x1","12","y1","15","x2","12","y2","3"],[1,"text-gray-800","text-lg","font-medium","mb-2"],[1,"text-gray-500","text-sm","mb-4"],["type","button",1,"bg-blue-500","text-white","px-5","py-2.5","rounded-lg","text-sm","font-medium","hover:bg-blue-600","transition-colors","duration-200"],[1,"p-6"],[1,"flex","flex-col","gap-4"],["class","text-center",4,"ngIf"],[1,"flex","items-center","gap-3","p-4","bg-white","rounded-lg","shadow-sm"],[1,"text-3xl"],[1,"flex-1","min-w-0"],[1,"text-gray-800","text-base","font-medium","mb-1","break-words"],[1,"text-gray-500","text-sm"],["type","button","title","Remove file",1,"text-red-500","p-2","rounded","hover:bg-red-50","transition-colors","duration-200",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"text-center"],[1,"max-w-full","max-h-80","rounded-lg","shadow-md","mx-auto",3,"src","alt"],[1,"my-4"],[1,"w-full","h-2","bg-gray-200","rounded-full","overflow-hidden","mb-2"],[1,"h-full","bg-blue-500","rounded-full","transition-all","duration-300","ease-out"],[1,"text-center","text-gray-500","text-sm"],[1,"flex","items-center","gap-2","p-3","bg-red-50","text-red-700","border","border-red-200","rounded-lg","text-sm","my-4"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4","flex-shrink-0"],["cx","12","cy","12","r","10"],["x1","15","y1","9","x2","9","y2","15"],["x1","9","y1","9","x2","15","y2","15"],[1,"flex","items-center","gap-2","p-3","bg-green-50","text-green-700","border","border-green-200","rounded-lg","text-sm","my-4"],["points","20,6 9,17 4,12"]],template:function(e,t){if(e&1){let d=w();i(0,"div",1)(1,"div",2)(2,"h2",3),a(3,"Upload Proof of Delivery"),n(),i(4,"p",4),a(5,"Upload a PDF document as proof of delivery"),n()(),i(6,"div",5)(7,"label",6),a(8," POD Number "),i(9,"span",7),a(10,"*"),n()(),i(11,"input",8),T("ngModelChange",function(x){return p(d),D(t.podNumber,x)||(t.podNumber=x),m(x)}),n(),i(12,"p",9),a(13,"Required before uploading."),n()(),i(14,"div",10)(15,"input",11,0),g("change",function(x){return p(d),m(t.onPodSelected(x))}),n(),h(17,Q,12,0,"div",12)(18,Z,15,4,"div",13),n(),h(19,$,5,3,"div",14)(20,ee,7,1,"div",15)(21,te,5,0,"div",16),i(22,"div",17)(23,"button",18),g("click",function(){return p(d),m(t.uploadPod())}),h(24,ie,2,0,"span",19)(25,re,2,0,"span",19),n(),i(26,"button",20),g("click",function(){return p(d),m(t.resetForm())}),a(27," Back "),n()()()}e&2&&(l(11),k("ngModel",t.podNumber),l(3),C("border-blue-500",t.selectedFile)("bg-blue-50",t.selectedFile),l(3),s("ngIf",!t.selectedFile),l(),s("ngIf",t.selectedFile),l(),s("ngIf",t.isUploading),l(),s("ngIf",t.uploadError),l(),s("ngIf",t.uploadSuccess),l(2),s("disabled",!t.selectedFile||t.isUploading||!t.podNumber),l(),s("ngIf",!t.isUploading),l(),s("ngIf",t.isUploading),l(),s("disabled",t.isUploading))},dependencies:[V,M,j,B,R,L,z],encapsulation:2})};export{Y as UploadPodComponent};
