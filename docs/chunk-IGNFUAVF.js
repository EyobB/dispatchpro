import{a as W}from"./chunk-AJM4KZRL.js";import{a as z}from"./chunk-YK2LZHPZ.js";import{b as L}from"./chunk-DDEBU2FK.js";import{a as G}from"./chunk-DQ3FC3IJ.js";import{a as $}from"./chunk-NOERRO3T.js";import{b as F,d as R,g as V,i as A,u as P}from"./chunk-ZE6XRCVF.js";import{a as B}from"./chunk-74GXZ5HC.js";import"./chunk-BCYCRGTW.js";import"./chunk-Z2SYLYEN.js";import"./chunk-XPCCV2FB.js";import{c as k,e as j,j as M}from"./chunk-3IYQXLZN.js";import"./chunk-Z3DWEABJ.js";import{l as O,m as D,q as N}from"./chunk-RIFGPENF.js";import{$ as g,Ab as _,Bb as d,Eb as E,Fb as w,Gb as y,La as a,Ob as p,Qa as l,Qb as v,Va as S,_ as h,_a as f,gb as b,kb as r,lb as e,mb as I,pb as T,sb as m,tb as C,x,zb as t}from"./chunk-OP2CD5JB.js";function q(c,n){if(c&1){let i=T();r(0,"div",25)(1,"span"),t(2),e(),r(3,"div",26)(4,"span",27),t(5,"$"),e(),r(6,"input",28),y("ngModelChange",function(s){let u=h(i).$implicit;return w(u.amount,s)||(u.amount=s),g(s)}),m("change",function(){h(i);let s=C();return g(s.recalculateTotals())}),e()()()}if(c&2){let i=n.$implicit;a(2),_(i.description),a(4),E("ngModel",i.amount)}}function H(c,n){c&1&&(r(0,"div",29)(1,"div",30),I(2,"div",31),r(3,"p",32),t(4,"Loading drivers..."),e()()())}var J=class c{constructor(n,i,o,s,u,K){this.route=n;this.router=i;this.ordersService=o;this.settingsService=s;this.invoiceService=u;this.toastService=K}loading=!1;order=new L;invoice=new z;paymentTerms="";paymentInstructions="";invoiceNotes="";orderTotal=0;driverTotal=0;dispatcherTotal=0;dispatcherCode="";ngOnInit(){this.loading=!0;let n=this.route.snapshot.paramMap.get("id");n&&x({order:this.ordersService.getOrder(n),settings:this.settingsService.getSettings()}).subscribe(({order:i,settings:o})=>{this.order=i,this.dispatcherCode=o.dispatcherCode,this.paymentTerms=o.paymentTerms,this.paymentInstructions=o.paymentInstructions,this.invoiceNotes=o.invoiceNotes,this.initializeInvoice(),this.loading=!1},i=>{this.loading=!1,this.toastService.showError("Failed to load order details."),console.error("Error loading order details:",i)})}initializeInvoice(){this.driverTotal=this.order.driverCosts?.reduce((n,i)=>n+i.amount,0)||0,this.dispatcherTotal=this.order.dispatcherCosts?.reduce((n,i)=>n+i.amount,0)||0,this.orderTotal=this.order.rate+this.driverTotal+this.dispatcherTotal,this.invoice.brokerName=this.order.brokerName,this.invoice.dueDate=new Date().toISOString().split("T")[0],this.invoice.totalCost=this.orderTotal,this.invoice.podNumber=this.order.podNumber||"",this.invoice.loadNumber=this.order.loadNumber||"",this.invoice.status="Draft",this.invoice.invoiceNumber="",this.invoice.invoiceDate=new Date().toISOString().split("T")[0]}generateInvoice(){this.invoice.orderId=this.order.id,this.invoice.totalCost=this.orderTotal,this.invoice.terms=this.paymentTerms,this.invoice.paymentInstructions=this.paymentInstructions,this.invoice.notes=this.invoiceNotes,this.invoiceService.createInvoice(this.invoice).subscribe(n=>{this.order.invoiceId=n.id,this.ordersService.updateOrder(this.order).subscribe(()=>{this.router.navigate(["/dispatcher/carrier-invoices/",n.id,this.order.id])},i=>{this.toastService.showError("Failed to update order with invoice ID."),console.error("Error updating order:",i)})},n=>{this.toastService.showError("Failed to create invoice. Please try again."),console.error("Error creating invoice:",n)})}goBack(){this.router.navigate(["/dispatcher/orders",this.order.id])}recalculateTotals(){this.driverTotal=this.order.driverCosts?.reduce((n,i)=>n+(i.amount||0),0)||0,this.dispatcherTotal=this.order.dispatcherCosts?.reduce((n,i)=>n+(i.amount||0),0)||0,this.orderTotal=this.order.rate+this.driverTotal+this.dispatcherTotal,this.invoice.totalCost=this.orderTotal}static \u0275fac=function(i){return new(i||c)(l(k),l(j),l($),l(W),l(G),l(B))};static \u0275cmp=S({type:c,selectors:[["app-order-to-invoice"]],decls:71,vars:18,consts:[[1,"mx-auto","max-w-3xl","p-6","bg-white","rounded-xl","shadow-lg"],[1,"mb-4"],[1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium",3,"click"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],[1,"mb-6","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"font-semibold"],[1,"mb-6"],[1,"mb-4","bg-blue-50","rounded","p-4"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-bold","text-blue-900"],[1,"flex","justify-end","gap-6"],[1,"bg-gray-50","rounded","p-4","w-1/2"],[1,"font-semibold","mb-2","flex","items-center","gap-2"],[1,"space-y-2"],["class","flex justify-between items-center space-x-4",4,"ngFor","ngForOf"],[1,"border-t","pt-2","mt-4","flex","justify-between","font-semibold"],[1,"mt-4","bg-green-100","p-4","rounded"],[1,"flex","justify-between","items-center","text-lg","font-bold","text-green-900"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],[1,"bg-green-600","hover:bg-green-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-gray-600","hover:bg-gray-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],["class","grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"flex","justify-between","items-center","space-x-4"],[1,"flex","items-center"],[1,"mr-1"],["type","number","placeholder","0.00",1,"w-24","p-1","border","rounded","focus:border-green-500","focus:outline-none","text-right",3,"ngModelChange","change","ngModel"],[1,"grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),m("click",function(){return o.goBack()}),r(3,"span",3),t(4,"\u2190"),e(),t(5," Back to Order "),e()(),r(6,"h2",4)(7,"span"),t(8,"\u{1F4C4}"),e(),t(9," Generate Invoice "),e(),r(10,"div",5)(11,"h3",6)(12,"span"),t(13,"\u{1F4E6}"),e(),t(14," Order Information "),e(),r(15,"div",7)(16,"div")(17,"span",8),t(18,"Load #:"),e(),t(19),e(),r(20,"div")(21,"span",8),t(22,"PoD #:"),e(),t(23),e(),r(24,"div")(25,"span",8),t(26,"Customer:"),e(),t(27),e(),r(28,"div")(29,"span",8),t(30,"Contact:"),e(),t(31),e()()(),r(32,"div",9)(33,"h3",6)(34,"span"),t(35,"\u{1F4B2}"),e(),t(36," Cost Summary "),e(),r(37,"div",10)(38,"div",11)(39,"span",8),t(40,"Rate Amount"),e(),r(41,"span",12),t(42),p(43,"number"),e()()(),r(44,"div",13)(45,"div",14)(46,"h4",15)(47,"span"),t(48,"\u{1F69B}"),e(),t(49," Driver Costs "),e(),r(50,"div",16),f(51,q,7,2,"div",17),r(52,"div",18)(53,"span"),t(54,"Driver Total"),e(),r(55,"span"),t(56),p(57,"number"),e()()()()(),r(58,"div",19)(59,"div",20)(60,"span"),t(61,"Order Total"),e(),r(62,"span"),t(63),p(64,"number"),e()()()(),r(65,"div",21)(66,"button",22),m("click",function(){return o.generateInvoice()}),t(67," Generate Invoice "),e(),r(68,"button",23),m("click",function(){return o.goBack()}),t(69," Cancel "),e()()(),f(70,H,5,0,"div",24)),i&2&&(a(19),d(" ",o.order.loadNumber,""),a(4),d(" ",o.order.podNumber,""),a(4),d(" ",o.order.brokerName,""),a(4),d(" ",o.order.brokerContact,""),a(11),d("$ ",v(43,9,o.order.rate,"1.2-2"),""),a(9),b("ngForOf",o.order.driverCosts),a(5),d("$ ",v(57,12,o.driverTotal,"1.2-2"),""),a(7),d("$ ",v(64,15,o.orderTotal,"1.2-2"),""),a(7),b("ngIf",o.loading))},dependencies:[D,O,M,P,F,A,R,V,N],encapsulation:2})};export{J as OrderToInvoiceComponent};
