import{a as q}from"./chunk-6R43N26K.js";import{d as W,g as V,l as j,m as L,n as R,u as G}from"./chunk-ZE6XRCVF.js";import{a as k}from"./chunk-74GXZ5HC.js";import"./chunk-XPCCV2FB.js";import{e as B}from"./chunk-3IYQXLZN.js";import"./chunk-Z3DWEABJ.js";import{k as T,l as N,m as A,o as F,p as P,r as O}from"./chunk-RIFGPENF.js";import{$ as y,Bb as s,Cb as w,Eb as f,Fb as h,Gb as S,La as a,Nb as M,Ob as p,Pb as v,Qa as g,Qb as I,Va as D,_ as b,_a as u,gb as m,kb as t,lb as i,mb as _,pb as C,sb as x,tb as E,zb as n}from"./chunk-OP2CD5JB.js";var H=(l,o,e,r,c)=>({"bg-green-300 text-green-900":l,"bg-green-100 text-green-800":o,"bg-yellow-100 text-yellow-800":e,"bg-red-100 text-red-800":r,"bg-blue-100 text-blue-800":c});function J(l,o){if(l&1&&(t(0,"option",21),n(1),i()),l&2){let e=o.$implicit;m("value",e.id),a(),s(" ",e.name," ")}}function K(l,o){if(l&1){let e=C();t(0,"tr",22)(1,"td",23),n(2),i(),t(3,"td",24),n(4),i(),t(5,"td",24),n(6),p(7,"date"),p(8,"date"),i(),t(9,"td",25),n(10),i(),t(11,"td",26),n(12),p(13,"currency"),i(),t(14,"td",26),n(15),p(16,"currency"),i(),t(17,"td",27),n(18),p(19,"currency"),i(),t(20,"td",24)(21,"span",28),n(22),p(23,"titlecase"),i()(),t(24,"td",25)(25,"button",29),x("click",function(){let c=b(e).$implicit,d=E();return y(d.viewInvoice(c))}),n(26," View "),i()()()}if(l&2){let e=o.$implicit;a(2),s(" ",e.invoiceNumber," "),a(2),s(" ",e.driverName," "),a(2),w(" ",I(7,10,e.periodStartDate,"MMM dd")," - ",I(8,13,e.periodEndDate,"MMM dd, yyyy")," "),a(4),s(" ",e.ordersCount," "),a(2),s(" ",v(13,16,e.ordersTotal)," "),a(3),s(" ",v(16,18,e.deductionsTotal)," "),a(3),s(" ",v(19,20,e.netTotal)," "),a(3),m("ngClass",M(24,H,e.status==="Completed",e.status==="Paid",e.status==="Approved",e.status==="Cancelled",e.status==="Draft")),a(),s(" ",v(23,22,e.status)," ")}}function Q(l,o){l&1&&(t(0,"div",30)(1,"div",31),_(2,"div",32),t(3,"p",33),n(4,"Loading driver invoices..."),i()()())}var z=class l{constructor(o,e,r){this.invoiceService=o;this.router=e;this.toastService=r}loading=!1;invoices=[];filteredInvoices=[];drivers=[];selectedDriver="";selectedStatus="";ngOnInit(){this.loadInvoices()}loadInvoices(){this.loading=!0,this.invoiceService.getDriverInvoices().subscribe({next:o=>{this.invoices=o.sort((e,r)=>new Date(r.issueDate).getTime()-new Date(e.issueDate).getTime()),this.filteredInvoices=this.invoices,this.drivers=Array.from(o.reduce((e,r)=>(e.has(r.driverId)||e.set(r.driverId,{id:r.driverId,name:r.driverName}),e),new Map).values()),this.loading=!1},error:o=>{console.error("Error loading driver invoices",o),this.loading=!1,this.toastService.showError("Failed to load driver invoices. Try reloading the app.",5e3)}})}filterInvoices(){this.filteredInvoices=this.invoices.filter(o=>{let e=!0,r=!0;return this.selectedDriver&&(e=o.driverId===this.selectedDriver),this.selectedStatus&&(r=o.status===this.selectedStatus),e&&r})}getStatusClass(o){switch(o){case"Approved":return"bg-yellow-100 text-yellow-800";case"Paid":return"bg-green-100 text-green-800";case"Cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}viewInvoice(o){this.router.navigate(["/dispatcher/driver-invoices",o.id])}static \u0275fac=function(e){return new(e||l)(g(q),g(B),g(k))};static \u0275cmp=D({type:l,selectors:[["app-driver-invoices"]],decls:52,vars:5,consts:[[1,"p-6","pt-0"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],[1,"mb-4","flex","items-center","gap-4","relative"],[1,"flex","items-center","gap-2","relative"],[1,"font-semibold","text-green-900","mr-2"],[1,"bg-green-50","border","border-green-200","rounded","px-4","py-2","text-sm",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","Draft"],["value","Approved"],["value","Invoiced"],["value","Paid"],[1,"overflow-x-auto","rounded-lg","shadow-lg","bg-white"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-green-900","text-white"],[1,"px-4","py-3","text-left","font-semibold"],[1,"px-4","py-3","text-center","font-semibold"],[1,"px-4","py-3","text-right","font-semibold"],[1,"bg-white","divide-y","divide-gray-100"],["class","hover:bg-green-50 transition",4,"ngFor","ngForOf"],["class","grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[3,"value"],[1,"hover:bg-green-50","transition"],[1,"px-4","py-1","font-medium","text-green-900"],[1,"px-4","py-1"],[1,"px-4","py-1","text-center"],[1,"px-4","py-1","text-right"],[1,"px-4","py-1","text-right","font-semibold"],[1,"inline-block","px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[1,"bg-blue-600","hover:bg-blue-700","transition","text-white","px-3","py-1","rounded","shadow",3,"click"],[1,"grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"h2",1)(2,"span"),n(3,"\u{1F4C4}"),i(),n(4," Driver Invoices "),i(),t(5,"div",2)(6,"div",3)(7,"label",4),n(8,"Driver:"),i(),t(9,"select",5),S("ngModelChange",function(d){return h(r.selectedDriver,d)||(r.selectedDriver=d),d}),x("change",function(){return r.filterInvoices()}),t(10,"option",6),n(11,"All Drivers"),i(),u(12,J,2,2,"option",7),i()(),t(13,"div",3)(14,"label",4),n(15,"Status:"),i(),t(16,"select",5),S("ngModelChange",function(d){return h(r.selectedStatus,d)||(r.selectedStatus=d),d}),x("change",function(){return r.filterInvoices()}),t(17,"option",6),n(18,"All Statuses"),i(),t(19,"option",8),n(20,"Draft"),i(),t(21,"option",9),n(22,"Approved"),i(),t(23,"option",10),n(24,"Completed"),i(),t(25,"option",11),n(26,"Paid"),i()()()(),t(27,"div",12)(28,"table",13)(29,"thead",14)(30,"tr")(31,"th",15),n(32,"Invoice #"),i(),t(33,"th",15),n(34,"Driver"),i(),t(35,"th",15),n(36,"Period"),i(),t(37,"th",16),n(38,"Trips"),i(),t(39,"th",17),n(40,"Gross Amount"),i(),t(41,"th",17),n(42,"Deductions"),i(),t(43,"th",17),n(44,"Net Amount"),i(),t(45,"th",15),n(46,"Status"),i(),t(47,"th",16),n(48,"Actions"),i()()(),t(49,"tbody",18),u(50,K,27,30,"tr",19),i()()(),u(51,Q,5,0,"div",20),i()),e&2&&(a(9),f("ngModel",r.selectedDriver),a(3),m("ngForOf",r.drivers),a(4),f("ngModel",r.selectedStatus),a(34),m("ngForOf",r.filteredInvoices),a(),m("ngIf",r.loading))},dependencies:[N,A,G,L,R,j,W,V,T,P,O,F],encapsulation:2})};export{z as DriverInvoicesComponent};
