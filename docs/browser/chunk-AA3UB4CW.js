import{a as K}from"./chunk-OD4Z4RIU.js";import{a as J}from"./chunk-DDEBU2FK.js";import{a as G}from"./chunk-2EMIZEML.js";import{a as W,d as z,g as $,l as B,m as H,n as Z,u as q}from"./chunk-WJZQNLUY.js";import{a as P}from"./chunk-A3LUHI23.js";import"./chunk-IOPBYQJQ.js";import{a as R}from"./chunk-LFAOHVAW.js";import"./chunk-XPCCV2FB.js";import{c as L,e as j}from"./chunk-V26HN3KH.js";import"./chunk-5UMXG57Q.js";import{j as V,k as A,l as N}from"./chunk-O5HBUBIU.js";import{$ as h,Ab as S,Cb as C,Db as w,Eb as y,Fb as E,Ka as l,Lb as M,Pa as _,Rb as F,Ua as T,Za as u,_ as v,aa as k,ba as I,fb as m,jb as i,kb as r,lb as b,ob as f,rb as g,sb as c,x as O,xb as D,yb as s,zb as p}from"./chunk-ITTAAY47.js";var U=(o,t,e,n)=>({"bg-green-300 text-green-900":o,"bg-green-100 text-green-800":t,"bg-yellow-100 text-yellow-800":e,"bg-red-100 text-red-800":n});function X(o,t){o&1&&(i(0,"div",22)(1,"div",23),b(2,"div",24),i(3,"p",25),s(4,"Loading orders..."),r()()())}function Y(o,t){if(o&1){let e=f();i(0,"label",28)(1,"input",33),E("ngModelChange",function(a){let d=v(e).$implicit,x=c(2);return y(x.selectedStatusesMap[d],a)||(x.selectedStatusesMap[d]=a),h(a)}),g("change",function(){v(e);let a=c(2);return h(a.onStatusFilterChange())}),r(),s(2),r()}if(o&2){let e=t.$implicit,n=c(2);l(),w("ngModel",n.selectedStatusesMap[e]),l(),S(" ",e," ")}}function ee(o,t){if(o&1){let e=f();i(0,"div",26)(1,"div",27)(2,"label",28)(3,"input",29),g("change",function(a){v(e);let d=c();return h(d.toggleSelectAllStatuses(a))}),r(),i(4,"span",30),s(5,"Select/Deselect All"),r()()(),i(6,"div",31),u(7,Y,3,2,"label",32),r()()}if(o&2){let e=c();l(3),m("checked",e.allStatusesSelected()),l(4),m("ngForOf",e.orderStatuses)}}function te(o,t){if(o&1){let e=f();i(0,"div",34),g("click",function(){v(e);let a=c();return h(a.showStatusDropdown=!1)}),r()}}function re(o,t){if(o&1&&(i(0,"option",35),s(1),r()),o&2){let e=t.$implicit;m("value",e),l(),p(e)}}function ie(o,t){if(o&1&&(i(0,"div")(1,"div"),s(2),r(),i(3,"div",40),s(4),r()()),o&2){let e,n,a=c().$implicit,d=c();l(2),p((e=d.getDriver(a))==null?null:e.name),l(2),p((n=d.getDriver(a))==null?null:n.phone)}}function ne(o,t){if(o&1&&(i(0,"option",35),s(1),r()),o&2){let e=t.$implicit;m("value",e.id),l(),S(" ",e.name," ")}}function se(o,t){if(o&1){let e=f();i(0,"select",43),g("change",function(a){v(e);let d=c().$implicit,x=c();return h(x.assignDriver(d,a))}),i(1,"option",14),s(2,"Select Driver..."),r(),u(3,ne,2,2,"option",15),r()}if(o&2){let e=c(2);l(3),m("ngForOf",e.drivers)}}function oe(o,t){if(o&1){let e=f();i(0,"tr",36)(1,"td",37)(2,"div"),s(3),r(),i(4,"span",38),s(5),r()(),i(6,"td",39)(7,"div",30),s(8),r(),i(9,"div",40),s(10),r()(),i(11,"td",39)(12,"div",30),s(13),r()(),i(14,"td",39)(15,"div"),s(16),r(),i(17,"div",40),s(18),r()(),i(19,"td",39)(20,"div"),s(21),r(),i(22,"div",40),s(23),r()(),i(24,"td",39),u(25,ie,5,2,"div",41)(26,se,4,1,"ng-template",null,0,F),r(),i(28,"td",39)(29,"button",42),g("click",function(){let a=v(e).$implicit,d=c();return h(d.viewOrder(a.id))}),s(30," View "),r()()()}if(o&2){let e=t.$implicit,n=D(27),a=c();l(3),p(e.orderNumber),l(),m("ngClass",M(16,U,e.status==="Completed",e.status==="Delivered",e.status==="In Transit",e.status==="Cancelled")),l(),S(" ",e.status," "),l(3),p(e.brokerName),l(2),p(e.brokerContact),l(3),p(e.loadNumber),l(3),p(e.originStreetAddress),l(2),C("",e.originCity,", ",e.originState," ",e.originZipcode,""),l(3),p(e.destinationStreetAddress),l(2),C("",e.destinationCity,", ",e.destinationState," ",e.destinationZipcode,""),l(2),m("ngIf",a.getDriver(e))("ngIfElse",n)}}var Q=class o{constructor(t,e,n,a,d,x){this.router=t;this.route=e;this.toastService=n;this.ordersService=a;this.driversService=d;this.trucksService=x}loading=!1;orderStatuses=J.ALL;selectedStatusesMap={};orders=[];filteredOrders=[];showStatusDropdown=!1;customerNames=[];selectedCustomer="";drivers=[];trucks=[];ngOnInit(){this.loadOrders(),this.applyStatusFilters(),this.onStatusFilterChange()}loadOrders(){this.loading=!0,O({orders:this.ordersService.getOrders(),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks()}).subscribe(({orders:t,drivers:e,trucks:n})=>{this.orders=t.sort((a,d)=>new Date(d.pickupDateAndTime).getTime()-new Date(a.pickupDateAndTime).getTime()),this.filteredOrders=this.orders,this.drivers=e,this.trucks=n,this.loading=!1},t=>{console.error("Error loading orders:",t),this.toastService.showError("Failed to load orders. Try reloading the app.",5e3),this.loading=!1}),this.ordersService.getOrders().subscribe(t=>{this.orders=t,this.customerNames=Array.from(new Set(t.map(e=>e.brokerName))).sort(),this.filteredOrders=t},t=>{console.error("Error loading orders:",t)})}getDriver(t){return this.drivers.find(e=>e.id===t.driverId)||null}getTruck(t){return this.trucks.find(e=>e.id===t.truckId)||null}applyStatusFilters(){let t=this.route.snapshot.queryParamMap.get("status")||"";t?(this.orderStatuses.forEach(e=>{this.selectedStatusesMap[e]=!1}),this.selectedStatusesMap[t]=!0):(this.orderStatuses.forEach(e=>{this.selectedStatusesMap[e]=!0}),this.selectedStatusesMap.Cancelled=!1),this.applyFilters()}onStatusFilterChange(){this.applyFilters()}onCustomerFilterChange(){this.applyFilters()}applyFilters(){let t=this.orderStatuses.filter(e=>this.selectedStatusesMap[e]);this.filteredOrders=this.orders.filter(e=>{let n=t.includes(e.status),a=!this.selectedCustomer||e.brokerName===this.selectedCustomer;return n&&a})}viewOrder(t){this.router.navigate(["/dispatcher/orders/",t])}getSelectedStatusesLabel(){let t=this.orderStatuses.filter(e=>this.selectedStatusesMap[e]);return t.length===0?"None selected":t.length===this.orderStatuses.length?"All selected":t.join(", ")}allStatusesSelected(){return this.orderStatuses.every(t=>this.selectedStatusesMap[t])}toggleSelectAllStatuses(t){let e=t.target.checked;this.orderStatuses.forEach(n=>this.selectedStatusesMap[n]=e),this.onStatusFilterChange()}assignDriver(t,e){let n=e.target.value,a=this.trucks[0].id;if(!n||!a){this.toastService.showError("Please select a valid driver");return}t.driverId=n,t.truckId=a,this.ordersService.assignDriver(t).subscribe({next:d=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},error:d=>{this.toastService.showError("Error assigning driver and truck:"+d)}})}static \u0275fac=function(e){return new(e||o)(_(j),_(L),_(P),_(G),_(R),_(K))};static \u0275cmp=T({type:o,selectors:[["app-orders"]],decls:44,vars:7,consts:[["noDriverAssigned",""],[1,"p-6","pt-0"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],["class","grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"mb-4","flex","items-center","gap-4","relative"],[1,"flex","items-center","gap-2","relative"],[1,"font-semibold","text-green-900","mr-2"],[1,"relative"],["type","button",1,"bg-green-50","border","border-green-200","rounded","px-4","py-2","text-sm","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","stroke-width","2","viewBox","0 0 24 24",1,"w-4","h-4","ml-1"],["stroke-linecap","round","stroke-linejoin","round","d","M19 9l-7 7-7-7"],["class","absolute left-0 mt-2 w-56 bg-white border border-green-200 rounded shadow-lg z-10",4,"ngIf"],["class","fixed inset-0 z-0","style","background: transparent",3,"click",4,"ngIf"],[1,"bg-green-50","border","border-green-200","rounded","px-4","py-2","text-sm",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"overflow-x-auto","rounded-lg","shadow-lg","bg-white"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-green-900","text-white"],[1,"px-4","py-3","text-left","font-semibold"],[1,"bg-white","divide-y","divide-gray-100"],["class","hover:bg-green-50 transition",4,"ngFor","ngForOf"],[1,"grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"],[1,"absolute","left-0","mt-2","w-56","bg-white","border","border-green-200","rounded","shadow-lg","z-10"],[1,"px-3","py-2","border-b","border-green-100","flex","flex-col","gap-1"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"accent-green-600",3,"change","checked"],[1,"font-semibold"],[1,"max-h-48","overflow-y-auto","px-3","py-2","flex","flex-col","gap-1"],["class","flex items-center gap-2 cursor-pointer",4,"ngFor","ngForOf"],["type","checkbox",1,"accent-green-600",3,"ngModelChange","change","ngModel"],[1,"fixed","inset-0","z-0",2,"background","transparent",3,"click"],[3,"value"],[1,"hover:bg-green-50","transition"],[1,"px-4","py-1","font-medium","text-green-900"],[1,"mt-1","inline-block","px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[1,"px-4","py-1"],[1,"text-xs","text-gray-500"],[4,"ngIf","ngIfElse"],[1,"bg-blue-600","hover:bg-blue-700","transition","text-white","px-3","py-1","rounded","shadow",3,"click"],[1,"bg-gray-50","border","border-gray-200","rounded","px-2","py-1","text-sm","w-full",3,"change"]],template:function(e,n){e&1&&(i(0,"div",1)(1,"h2",2)(2,"span"),s(3,"\u{1F4E6}"),r(),s(4," Orders "),r(),u(5,X,5,0,"div",3),i(6,"div",4)(7,"div",5)(8,"label",6),s(9,"Status:"),r(),i(10,"div",7)(11,"button",8),g("click",function(){return n.showStatusDropdown=!n.showStatusDropdown}),s(12),k(),i(13,"svg",9),b(14,"path",10),r()(),u(15,ee,8,2,"div",11),r(),u(16,te,1,0,"div",12),r(),I(),i(17,"div",5)(18,"label",6),s(19,"Customer:"),r(),i(20,"select",13),E("ngModelChange",function(d){return y(n.selectedCustomer,d)||(n.selectedCustomer=d),d}),g("change",function(){return n.onCustomerFilterChange()}),i(21,"option",14),s(22,"All"),r(),u(23,re,2,2,"option",15),r()()(),i(24,"div",16)(25,"table",17)(26,"thead",18)(27,"tr")(28,"th",19),s(29,"Order #"),r(),i(30,"th",19),s(31,"Customer"),r(),i(32,"th",19),s(33,"Load #"),r(),i(34,"th",19),s(35,"Origin"),r(),i(36,"th",19),s(37,"Destination"),r(),i(38,"th",19),s(39,"Driver"),r(),i(40,"th",19),s(41,"Actions"),r()()(),i(42,"tbody",20),u(43,oe,31,21,"tr",21),r()()()()),e&2&&(l(5),m("ngIf",n.loading),l(7),S(" ",n.getSelectedStatusesLabel()," "),l(3),m("ngIf",n.showStatusDropdown),l(),m("ngIf",n.showStatusDropdown),l(4),w("ngModel",n.selectedCustomer),l(3),m("ngForOf",n.customerNames),l(20),m("ngForOf",n.filteredOrders))},dependencies:[A,N,V,q,H,Z,W,B,z,$],encapsulation:2})};export{Q as OrdersComponent};
