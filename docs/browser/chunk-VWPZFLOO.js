import{b as h}from"./chunk-IEI5TKEC.js";import{a as K}from"./chunk-KNI3T4OS.js";import{a as J}from"./chunk-C72DZDNH.js";import{b as R,d as P,g as B,i as W,l as $,m as L,n as q,p as z,u as H}from"./chunk-VDT5TDP2.js";import{a as A}from"./chunk-A3LUHI23.js";import{a as j}from"./chunk-25LA7BX7.js";import"./chunk-ZTGCRYCC.js";import"./chunk-XPCCV2FB.js";import{c as k,e as N,f as F}from"./chunk-KM6ROI6B.js";import"./chunk-2DXK6GBI.js";import{l as O,m as M,p as V,q as G}from"./chunk-TKJYB7RJ.js";import{$ as x,Ab as l,Bb as S,Db as I,Eb as w,Fb as y,Ka as d,Nb as c,Pa as u,Pb as p,Ua as D,Za as _,_ as g,fb as b,ib as E,jb as t,kb as e,ob as T,rb as v,sb as f,yb as i,zb as C}from"./chunk-ITTAAY47.js";function U(s,o){if(s&1&&(t(0,"div",23)(1,"div",24)(2,"div"),i(3),e(),t(4,"div",25),i(5),c(6,"number"),e()(),t(7,"div",24)(8,"div"),i(9),e(),t(10,"div"),i(11),c(12,"date"),e()(),t(13,"div",26)(14,"div",27),i(15),e(),t(16,"div",27),i(17),e()()()),s&2){let n=o.$implicit;d(3),l("Load#: ",n.loadNumber,""),d(2),l("$",p(6,8,n.orderValue,"1.2-2"),""),d(4),l("Order#: ",n.orderNumber,""),d(2),C(p(12,11,n.pickupDateAndTime,"MM/dd/yyyy")),d(4),S("From: ",n.originCity,", ",n.originState," "),d(2),S("To: ",n.destinationCity,", ",n.destinationState," ")}}function X(s,o){if(s&1){let n=T();t(0,"tr")(1,"td",36)(2,"select",37),y("ngModelChange",function(a){let m=g(n).$implicit;return w(m.description,a)||(m.description=a),x(a)}),v("change",function(){g(n);let a=f(2);return x(a.onDeductionChange())}),t(3,"option",38),i(4,"Select reason"),e(),t(5,"option",39),i(6,"Fuel"),e(),t(7,"option",40),i(8,"Maintenance"),e(),t(9,"option",41),i(10,"Tolls"),e(),t(11,"option",42),i(12,"Permits"),e(),t(13,"option",43),i(14,"Insurance"),e(),t(15,"option",44),i(16,"Other"),e()()(),t(17,"td",36)(18,"input",45),y("ngModelChange",function(a){let m=g(n).$implicit;return w(m.amount,a)||(m.amount=a),x(a)}),v("change",function(){g(n);let a=f(2);return x(a.onDeductionChange())}),e()(),t(19,"td",36)(20,"button",46),v("click",function(){let a=g(n).index,m=f(2);return x(m.removeDeduction(a))}),i(21," Remove "),e()()()}if(s&2){let n=o.$implicit,r=f(2);E(r.isDeductionValid(n)?"bg-white":"bg-red-600 text-white"),d(2),I("ngModel",n.description),d(16),I("ngModel",n.amount)}}function Y(s,o){if(s&1&&(t(0,"div",28)(1,"div",29)(2,"table",30)(3,"thead")(4,"tr",31)(5,"th",32),i(6," Reason"),e(),t(7,"th",32),i(8," Amount"),e(),t(9,"th",32),i(10," Action"),e()()(),t(11,"tbody"),_(12,X,22,4,"tr",33),e()()(),t(13,"div",34)(14,"span",35),i(15),c(16,"number"),e()()()),s&2){let n=f();d(12),b("ngForOf",n.deductions),d(3),l("Total Deductions: $",p(16,2,n.getDeductionsTotal(),"1.2-2"),"")}}function Z(s,o){s&1&&(t(0,"div",47)(1,"p",48),i(2,"No deductions added yet."),e(),t(3,"p",49),i(4,'Click "Add Deduction" to get started.'),e()())}var Q=class s{constructor(o,n,r,a,m,ee){this.route=o;this.ordersService=n;this.driverInvoiceService=r;this.sessionService=a;this.toastService=m;this.router=ee}orders=[];deductions=[];newDeduction=new h;ngOnInit(){let o=this.route.snapshot.paramMap.get("ids");if(o){let n=o.split(",").map(r=>r.trim());this.ordersService.getDriverOrders().subscribe(r=>{this.orders=r.filter(a=>n.includes(a.id))})}}getOrdersTotal(){return this.orders.reduce((o,n)=>o+(n.orderValue||0),0)}getDeductionsTotal(){return this.deductions.reduce((o,n)=>o+n.amount,0)}getInvoiceTotal(){return this.getOrdersTotal()-this.getDeductionsTotal()}getPeriodStartDate(){if(this.orders.length===0)return"";let o=this.orders.map(r=>new Date(r.dropOffDateAndTime));return new Date(Math.min(...o.map(r=>r.getTime()))).toISOString()}getPeriodEndDate(){if(this.orders.length===0)return"";let o=this.orders.map(r=>new Date(r.dropOffDateAndTime));return new Date(Math.max(...o.map(r=>r.getTime()))).toISOString()}addNewDeductionRow(){this.deductions.push(new h)}onDeductionChange(){}removeDeduction(o){o>-1&&this.deductions.splice(o,1)}isDeductionValid(o){return o.description.trim()!==""&&o.amount>0}generateInvoice(){let o=this.sessionService.getCurrentDriverId(),n={id:"",invoiceNumber:"",driverName:"",totalTrips:this.orders.length,status:"Draft",driverId:o,orders:this.orders,periodStartDate:this.getPeriodStartDate(),periodEndDate:this.getPeriodEndDate(),deductions:this.deductions,ordersTotal:this.getOrdersTotal(),deductionsTotal:this.getDeductionsTotal(),netTotal:this.getInvoiceTotal()};this.driverInvoiceService.generateInvoice(n).subscribe(r=>{this.toastService.showSuccess("Invoice generated successfully"),this.router.navigate(["/driver/invoices"])},r=>{this.toastService.showError("Error generating invoice:"+r)})}resetForm(){this.deductions=[],this.resetDeductionForm()}resetDeductionForm(){this.newDeduction=new h}static \u0275fac=function(n){return new(n||s)(u(k),u(J),u(K),u(j),u(A),u(N))};static \u0275cmp=D({type:s,selectors:[["app-generate-invoice"]],decls:54,vars:20,consts:[[1,"max-w-md","mx-auto","pt-0"],[1,"mb-4","flex","flex-row","justify-between","items-center"],[1,"text-2xl","font-bold","text-green-900","flex","items-center","gap-2"],["routerLink","/driver/completed-orders",1,"text-green-800","cursor-pointer","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"mb-2"],[1,"text-lg","sm:text-xl","font-semibold","mb-3","sm:mb-4"],[1,"space-y-1","text-gray-600","text-sm"],["class","bg-white border border-gray-300 rounded-lg p-2 shadow-sm",4,"ngFor","ngForOf"],[1,"text-right","p-3"],[1,"text-base","font-semibold"],[1,"flex","justify-between","items-center","mb-1"],[1,"text-lg","font-semibold"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","text-sm","sm:text-base",3,"click"],["class","mb-4",4,"ngIf"],["class","text-center py-2 text-gray-500",4,"ngIf"],[1,"bg-blue-50","px-4","rounded-lg","mb-4"],[1,"space-y-2"],[1,"flex","justify-between","text-sm","sm:text-base"],[1,"flex","justify-between","pt-3","sm:pt-4","border-t-2","border-gray-800","text-base","sm:text-lg","font-bold"],[1,"flex","flex-col","sm:flex-row","gap-3","sm:gap-4","sm:justify-center"],[1,"w-full","sm:w-auto","px-6","py-3","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","font-medium","text-sm","sm:text-base",3,"click"],[1,"w-full","sm:w-auto","px-6","py-3","bg-gray-600","text-white","rounded-lg","hover:bg-gray-700","font-medium","text-sm","sm:text-base",3,"click"],[1,"bg-white","border","border-gray-300","rounded-lg","p-2","shadow-sm"],[1,"flex","justify-between","items-start","mb-1"],[1,"text-green-600"],[1,"flex","flex-row","justify-between","text-sm"],[1,"mb-1"],[1,"mb-4"],[1,"overflow-x-auto"],[1,"w-full","border-collapse","border","border-gray-300"],[1,"bg-gray-300"],[1,"border","border-gray-500","px-2","sm:px-4","py-2","text-left","font-semibold","text-sm"],[3,"class",4,"ngFor","ngForOf"],[1,"text-right","mt-3","sm:mt-4","p-3","sm:p-4","bg-gray-50","rounded"],[1,"text-base","sm:text-lg","font-semibold"],[1,"border","border-gray-300","px-2","sm:px-4","py-2"],[1,"w-full","px-1","py-1","border-0","bg-transparent","focus:outline-none","focus:ring-2","focus:ring-blue-500","rounded","text-xs","text-gray-600",3,"ngModelChange","change","ngModel"],["value",""],["value","fuel"],["value","maintenance"],["value","tolls"],["value","permits"],["value","insurance"],["value","other"],["type","number","step","0.01","min","0",1,"w-full","px-1","sm:px-2","py-1","border-0","bg-transparent","focus:outline-none","focus:ring-2","focus:ring-blue-500","rounded","text-xs","sm:text-base",3,"ngModelChange","change","ngModel"],[1,"px-2","sm:px-3","py-1","bg-red-600","text-white","text-xs","sm:text-sm","rounded","hover:bg-red-700",3,"click"],[1,"text-center","py-2","text-gray-500"],[1,"text-sm","sm:text-base"],[1,"text-xs","sm:text-sm"]],template:function(n,r){n&1&&(t(0,"div",0)(1,"div",1)(2,"h2",2)(3,"span"),i(4,"\u2705"),e(),i(5," Generate Invoice "),e(),t(6,"a",3)(7,"span",4),i(8,"\u2190"),e(),i(9," Go Back "),e()(),t(10,"div",5)(11,"h3",6),i(12),e(),t(13,"div",7),_(14,U,18,14,"div",8),e(),t(15,"div",9)(16,"span",10),i(17),c(18,"number"),e()()(),t(19,"div",5)(20,"div",11)(21,"h3",12),i(22,"Deductions"),e(),t(23,"button",13),v("click",function(){return r.addNewDeductionRow()}),i(24," + Add Deduction "),e()(),_(25,Y,17,5,"div",14)(26,Z,5,0,"div",15),e(),t(27,"div",16)(28,"h3",6),i(29,"Invoice Summary"),e(),t(30,"div",17)(31,"div",18)(32,"span"),i(33,"Orders Total:"),e(),t(34,"span"),i(35),c(36,"number"),e()(),t(37,"div",18)(38,"span"),i(39,"Total Deductions:"),e(),t(40,"span"),i(41),c(42,"number"),e()(),t(43,"div",19)(44,"span"),i(45,"Net Total:"),e(),t(46,"span"),i(47),c(48,"number"),e()()()(),t(49,"div",20)(50,"button",21),v("click",function(){return r.generateInvoice()}),i(51," Generate Invoice "),e(),t(52,"button",22),v("click",function(){return r.resetForm()}),i(53," Reset "),e()()()),n&2&&(d(12),l("Orders (",r.orders.length,")"),d(2),b("ngForOf",r.orders),d(3),l("Orders Total: $",p(18,8,r.getOrdersTotal(),"1.2-2"),""),d(8),b("ngIf",r.deductions.length>0),d(),b("ngIf",r.deductions.length===0),d(9),l("$",p(36,11,r.getOrdersTotal(),"1.2-2"),""),d(6),l("-$",p(42,14,r.getDeductionsTotal(),"1.2-2"),""),d(6),l("$",p(48,17,r.getInvoiceTotal(),"1.2-2"),""))},dependencies:[O,M,V,G,H,L,q,R,W,$,P,z,B,F],encapsulation:2})};export{Q as GenerateInvoiceComponent};
