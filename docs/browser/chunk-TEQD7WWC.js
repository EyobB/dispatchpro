import{a as re}from"./chunk-MSIQXZHU.js";import{a as ie}from"./chunk-2NTEIUDO.js";import{a as ee}from"./chunk-OV624ATH.js";import{a as ne}from"./chunk-S57OZ2R5.js";import{b as te}from"./chunk-UIIJYSZH.js";import{a as Y}from"./chunk-3QMJAE3L.js";import{a as k,c as O}from"./chunk-7GTRUKFK.js";import{a as $}from"./chunk-7FUB44TE.js";import{b as G,d as J,g as q,i as z,l as H,m as K,n as Q,u as X}from"./chunk-2PVWNWUN.js";import"./chunk-LIL63FBP.js";import{a as Z}from"./chunk-OXCJF6DH.js";import"./chunk-NBSK5KUW.js";import{a as B}from"./chunk-IMHYAPIP.js";import"./chunk-XPCCV2FB.js";import{c as L,e as R,f as j,j as U}from"./chunk-3TOGTSGL.js";import"./chunk-FSJQQIFH.js";import{l as P,m as W}from"./chunk-QAAQ2EEP.js";import{$ as E,Ab as _,Bb as v,Cb as x,Db as I,Eb as h,Fb as D,Gb as S,Jb as A,La as d,Qa as p,Va as V,_ as y,_a as m,a as M,gb as c,ib as N,jb as w,kb as i,lb as e,mb as C,pb as T,sb as u,tb as f,x as F,zb as t}from"./chunk-QJGZKU5F.js";var de=l=>["/order-checkins-map",l];function le(l,n){if(l&1&&(i(0,"option",37),t(1),e()),l&2){let o=n.$implicit;c("value",o.id),d(),v(" ",o.name," ")}}function ae(l,n){if(l&1&&(i(0,"div",38)(1,"div"),t(2),e(),i(3,"div"),t(4),e()()),l&2){let o=f();d(2),_(o.selectedDriver==null?null:o.selectedDriver.phone),d(2),x("License: ",o.selectedDriver==null?null:o.selectedDriver.licenseState," - ",o.selectedDriver==null?null:o.selectedDriver.licenseNumber,"")}}function se(l,n){if(l&1&&(i(0,"option",37),t(1),e()),l&2){let o=n.$implicit;c("value",o.id),d(),x(" ",o.plate," - ",o.type," ")}}function ce(l,n){if(l&1&&(i(0,"div",38)(1,"div"),t(2),e(),i(3,"div"),t(4),e()()),l&2){let o=f();d(2),_(o.selectedTruck==null?null:o.selectedTruck.type),d(2),v("DOT: ",o.selectedTruck==null?null:o.selectedTruck.dotNumber,"")}}function me(l,n){if(l&1){let o=T();i(0,"li")(1,"a",41),u("click",function(){let s=y(o).$implicit,a=f(2);return E(a.viewDocument(s))}),t(2),e()()}if(l&2){let o=n.$implicit;d(2),x(" ",o.documentType," (",o.fileName,") ")}}function ue(l,n){if(l&1&&(i(0,"div")(1,"ul",39),m(2,me,3,2,"li",40),e()()),l&2){let o=f();d(2),c("ngForOf",o.order.documents)}}function pe(l,n){if(l&1){let o=T();i(0,"div",42)(1,"div",43)(2,"span",13),t(3),e(),i(4,"input",44),S("ngModelChange",function(s){let a=y(o).$implicit;return D(a.amount,s)||(a.amount=s),E(s)}),e()()()}if(l&2){let o=n.$implicit;N("opacity-60",o.amount===0),d(3),_(o.description),d(),h("ngModel",o.amount)}}function ve(l,n){l&1&&(i(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," Driver must be selected "),e())}function ge(l,n){l&1&&(i(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," Truck must be selected "),e())}function fe(l,n){l&1&&(i(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," Proof of Delivery (PoD) document must be uploaded "),e())}function _e(l,n){l&1&&(i(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," PoD # must be entered "),e())}function he(l,n){if(l&1&&(i(0,"div",45)(1,"div",46)(2,"p",47),t(3,"Cannot convert to invoice:"),e(),i(4,"ul",48),m(5,ve,4,0,"li",49)(6,ge,4,0,"li",49)(7,fe,4,0,"li",49)(8,_e,4,0,"li",49),e()()()),l&2){let o=f();d(5),c("ngIf",!o.order.driverId),d(),c("ngIf",!o.order.truckId),d(),c("ngIf",!o.isPodUploaded),d(),c("ngIf",!o.order.podNumber)}}var oe=class l{constructor(n,o,r,s,a,b,g){this.router=n;this.route=o;this.ordersService=r;this.driversService=s;this.trucksService=a;this.settingsService=b;this.toastService=g}order=new te;podUrl=null;availableDrivers=[];availableTrucks=[];selectedDriver=null;selectedTruck=null;costTypes=[];isUploading=!1;uploadError=null;showDocumentViewer=!1;currentDocument=new k;documentTypes=[O.RATE_CON];ngOnInit(){let n=this.route.snapshot.paramMap.get("id")||"";F({order:this.ordersService.getOrder(n),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks(),settings:this.settingsService.getSettings()}).subscribe(({order:o,drivers:r,trucks:s,settings:a})=>{this.order=o,this.availableDrivers=r,this.availableTrucks=s,this.onDriverSelect(),this.onTruckSelect(),this.costTypes=a.driverCosts,this.costTypes=a.driverCosts,this.costTypes.forEach(b=>{if(this.order.driverCosts=this.order.driverCosts||[],!this.order.driverCosts.some(g=>g.description===b)){let g=new re;g.description=b,g.amount=0,this.order.driverCosts.push(g)}})})}updateOrder(){this.order.driverId=this.order.driverId||null,this.order.truckId=this.order.truckId||null,this.ordersService.updateOrder(this.order).subscribe(()=>{this.toastService.showSuccess("Order updated successfully")},n=>{console.error("Error updating order:",n)})}assignDriverTruck(){this.ordersService.assignDriver(this.order).subscribe(()=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},n=>{console.error("Error assigning driver and truck:",n)})}markDelivered(){this.order&&(this.order.status="Delivered")}get isPodUploaded(){return this.order.documents?.some(n=>n.documentType===O.POD)??!1}markInTransit(){this.order&&(this.order.status="In Transit")}deleteOrder(){this.order&&confirm("Are you sure you want to delete this order?")&&this.ordersService.deleteOrder(this.order.id).subscribe(()=>{this.toastService.showSuccess("Order deleted successfully"),this.router.navigate(["/dispatcher/orders"])},n=>{console.error("Error deleting order:",n),this.toastService.showError("Failed to delete order")})}removePod(){confirm("Are you sure you want to remove the PoD document?")&&(this.order.documents&&(this.order.documents=this.order.documents.filter(n=>n.documentType!=="PoD")),this.podUrl=null)}addDocument(n){n.documentType&&n.url&&n.expires&&(this.order.documents=this.order.documents||[],this.order.documents.push(M({},n)))}createInvoice(){console.log(this.order),this.ordersService.updateOrder(this.order).subscribe(()=>{this.router.navigate(["/dispatcher/order-to-invoice",this.order.id])},n=>{console.error("Error updating order:",n)})}onDriverSelect(){this.selectedDriver=this.availableDrivers.find(n=>n.id===this.order.driverId)??null}onTruckSelect(){this.selectedTruck=this.availableTrucks.find(n=>n.id===this.order.truckId)??null}isValidForInvoice(){return!!(this.order.driverId&&this.order.truckId&&this.isPodUploaded&&this.order.podNumber)}viewDocument(n){this.currentDocument=n,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new k}onDownloadError(n){console.error("Download failed:",n),this.toastService.showError("Failed to download document")}static \u0275fac=function(o){return new(o||l)(p(R),p(L),p($),p(B),p(ee),p(ne),p(Z))};static \u0275cmp=V({type:l,selectors:[["app-order-detail"]],decls:121,vars:36,consts:[[1,"max-w-3xl","mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"text-3xl","font-bold","mb-2","text-green-900","flex","items-center","gap-2"],[1,"mb-4","flex","gap-2","text-gray-600"],[1,"bg-gray-100","px-3","py-1","rounded"],[1,"font-medium"],[1,"flex-1"],[1,"bg-blue-100","px-3","py-1","rounded","hover:bg-blue-200","transition",3,"routerLink"],[1,"text-blue-600"],["routerLink","/dispatcher/orders",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"mb-4","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"font-semibold"],[1,"mb-4"],[1,"flex","flex-col","sm:flex-row","gap-8"],[1,"flex-1","bg-gray-50","rounded","p-4"],[1,"text-xs","text-gray-500"],[1,"mt-2"],[1,"w-full","p-2","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-2 p-2 mt-0 pt-0 bg-white rounded shadow-sm text-xs text-gray-900",4,"ngIf"],[3,"click","disabled"],[4,"ngIf"],[1,"py-2","w-1/2"],[3,"documentAdded","orderId","documentTypes"],[1,"w-36","p-1","mb-4","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"mb-4","flex-row"],[1,"space-y-0","w-1/2"],["class","bg-gray-50 p-2 rounded transition-colors",3,"opacity-60",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],["class","w-full mb-4",4,"ngIf"],[1,"bg-red-600","hover:bg-red-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-green-600","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"px-6","py-2","rounded","shadow","font-semibold","transition",3,"click","disabled"],[3,"close","downloadError","document","isVisible"],[3,"value"],[1,"mt-2","p-2","mt-0","pt-0","bg-white","rounded","shadow-sm","text-xs","text-gray-900"],[1,"list-disc","pl-5","space-y-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],[1,"bg-gray-50","p-2","rounded","transition-colors"],[1,"flex","justify-between","items-center","mb-1"],["type","number","placeholder","0.00",1,"w-36","p-1","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-red-50","border","border-red-200","rounded","p-3"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","space-y-1"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500"]],template:function(o,r){o&1&&(i(0,"div",0)(1,"h2",1)(2,"span"),t(3,"\u{1F4E6}"),e(),t(4," Order Details "),e(),i(5,"div",2)(6,"div",3)(7,"span",4),t(8,"Order #:"),e(),t(9),e(),i(10,"div",3)(11,"span",4),t(12,"Load #:"),e(),t(13),e(),C(14,"div",5),i(15,"a",6)(16,"span",4),t(17,"View Map"),e(),i(18,"span",7),t(19,"\u{1F4CD}"),e()(),i(20,"a",8)(21,"span",9),t(22,"\u2190"),e(),t(23," Go Back "),e()(),i(24,"div",10)(25,"h3",11)(26,"span"),t(27,"\u{1F464}"),e(),t(28," Customer Information "),e(),i(29,"div",12)(30,"div")(31,"span",13),t(32,"Name:"),e(),t(33),e(),i(34,"div")(35,"span",13),t(36,"Contact:"),e(),t(37),e()()(),i(38,"div",14)(39,"h3",11)(40,"span"),t(41,"\u{1F5FA}\uFE0F"),e(),t(42," Route "),e(),i(43,"div",15)(44,"div",16)(45,"span",13),t(46,"Origin:"),e(),i(47,"div",4),t(48),e(),i(49,"div",17),t(50),e()(),i(51,"div",16)(52,"span",13),t(53,"Destination:"),e(),i(54,"div",4),t(55),e(),i(56,"div",17),t(57),e()()()(),i(58,"div",14)(59,"h3",11)(60,"span"),t(61,"\u{1F4E6}"),e(),t(62," Load Details "),e(),i(63,"div")(64,"span",13),t(65,"Description:"),e(),t(66),e()(),i(67,"div",14)(68,"h3",11)(69,"span"),t(70,"\u{1F9D1}\u200D\u2708\uFE0F"),e(),t(71," Driver & Truck "),e(),i(72,"div",15)(73,"div",5)(74,"span",13),t(75,"Driver: "),e(),i(76,"div",18)(77,"select",19),S("ngModelChange",function(a){return D(r.order.driverId,a)||(r.order.driverId=a),a}),u("change",function(){return r.onDriverSelect()}),i(78,"option",20),t(79,"Select a driver"),e(),m(80,le,2,2,"option",21),e(),m(81,ae,5,3,"div",22),e()(),i(82,"div",5)(83,"span",13),t(84,"Truck: "),e(),i(85,"div",18)(86,"select",19),S("ngModelChange",function(a){return D(r.order.truckId,a)||(r.order.truckId=a),a}),u("change",function(){return r.onTruckSelect()}),i(87,"option",20),t(88,"Select a truck"),e(),m(89,se,2,3,"option",21),e(),m(90,ce,5,2,"div",22),e()()(),i(91,"button",23),u("click",function(){return r.assignDriverTruck()}),t(92," Assign Driver & Truck "),e()(),i(93,"div",14)(94,"h3",11)(95,"span"),t(96,"\u{1F4C4}"),e(),t(97," Documents "),e(),m(98,ue,3,1,"div",24),e(),i(99,"div",25)(100,"app-add-document",26),u("documentAdded",function(a){return r.addDocument(a)}),e()(),i(101,"span",13),t(102,"PoD #:"),e(),C(103,"br"),i(104,"input",27),S("ngModelChange",function(a){return D(r.order.podNumber,a)||(r.order.podNumber=a),a}),e(),i(105,"div",28)(106,"h3",11)(107,"span"),t(108,"\u{1F4B2}"),e(),t(109," Driver Costs "),e(),i(110,"div",29),m(111,pe,5,4,"div",30),e()(),i(112,"div",31),m(113,he,9,4,"div",32),i(114,"button",33),u("click",function(){return r.deleteOrder()}),t(115," Delete Order "),e(),i(116,"button",34),u("click",function(){return r.updateOrder()}),t(117," Update Order "),e(),i(118,"button",35),u("click",function(){return r.createInvoice()}),t(119," Convert To Invoice "),e()()(),i(120,"app-document-viewer",36),u("close",function(){return r.closeDocumentViewer()})("downloadError",function(a){return r.onDownloadError(a)}),e()),o&2&&(d(9),v(" ",r.order.orderNumber," "),d(4),v(" ",r.order.loadNumber," "),d(2),c("routerLink",A(34,de,r.order.id)),d(18),v(" ",r.order.brokerName,""),d(4),v(" ",r.order.brokerContact,""),d(11),_(r.order.originStreetAddress),d(2),I("",r.order.originCity,", ",r.order.originState," ",r.order.originZipcode," "),d(5),_(r.order.destinationStreetAddress),d(2),I("",r.order.destinationCity,", ",r.order.destinationState," ",r.order.destinationZipcode,""),d(9),v(" ",r.order.description," "),d(11),h("ngModel",r.order.driverId),d(3),c("ngForOf",r.availableDrivers),d(),c("ngIf",r.order.driverId),d(5),h("ngModel",r.order.truckId),d(3),c("ngForOf",r.availableTrucks),d(),c("ngIf",r.order.truckId),d(),w(!r.order.driverId||!r.order.truckId?"bg-gray-300 text-gray-500 cursor-not-allowed p-2 my-2 rounded":"bg-green-600 hover:bg-green-700 text-white p-2 my-2 rounded"),c("disabled",!r.order.driverId||!r.order.truckId),d(7),c("ngIf",r.order.documents&&r.order.documents.length>0),d(2),c("orderId",r.order.id)("documentTypes",r.documentTypes),d(4),h("ngModel",r.order.podNumber),d(7),c("ngForOf",r.order.driverCosts),d(2),c("ngIf",!r.isValidForInvoice()),d(5),w(r.isValidForInvoice()?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),c("disabled",!r.isValidForInvoice()),d(2),c("document",r.currentDocument)("isVisible",r.showDocumentViewer))},dependencies:[W,P,U,j,X,K,Q,G,z,H,J,q,ie,Y],encapsulation:2})};export{oe as OrderDetailComponent};
