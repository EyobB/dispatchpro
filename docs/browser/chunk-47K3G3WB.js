import{a as $}from"./chunk-UIIJYSZH.js";import{a as V}from"./chunk-7FUB44TE.js";import{u as A}from"./chunk-2PVWNWUN.js";import{a as k}from"./chunk-OXCJF6DH.js";import"./chunk-NBSK5KUW.js";import"./chunk-IMHYAPIP.js";import"./chunk-XPCCV2FB.js";import{e as T}from"./chunk-3TOGTSGL.js";import"./chunk-FSJQQIFH.js";import{l as E,m as w,p as D,q as I}from"./chunk-QAAQ2EEP.js";import{$ as f,Ab as _,Bb as p,Db as h,La as o,Nb as x,Pb as g,Qa as O,Va as S,_ as u,_a as c,gb as s,kb as r,lb as i,mb as y,pb as C,sb as b,tb as a,zb as n}from"./chunk-QJGZKU5F.js";function j(d,e){d&1&&(r(0,"div",15)(1,"div",16),y(2,"div",17),r(3,"p",18),n(4,"Loading invoices\u2026"),i()()())}function F(d,e){if(d&1){let t=C();r(0,"button",21),b("click",function(){u(t);let m=a(2);return f(m.generateInvoice())}),n(1," \u{1F4C4} Generate Invoice For All "),i()}}function B(d,e){if(d&1&&(r(0,"div",19),c(1,F,2,0,"button",20),i()),d&2){let t=a();o(),s("ngIf",t.filteredOrders.length>0)}}function N(d,e){d&1&&(r(0,"div",22)(1,"div",23),n(2,"\u{1F4E6}"),i(),r(3,"div",24),n(4,"No completed orders yet."),i(),r(5,"div",25),n(6,"Your completed deliveries will appear here."),i()())}function H(d,e){d&1&&(r(0,"div",26),n(1," No orders match your search criteria. "),i())}function P(d,e){if(d&1&&(r(0,"div",39),n(1),x(2,"number"),i()),d&2){let t=a().$implicit;o(),p(" $",g(2,1,t.orderValue,"1.2-2")," ")}}function R(d,e){if(d&1){let t=C();r(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"span",24),n(5,"Pickup:"),i(),r(6,"span",31),n(7),x(8,"date"),i()(),r(9,"div",32)(10,"div")(11,"div"),n(12),i(),r(13,"div"),n(14),i()(),r(15,"button",33),b("click",function(){let m=u(t).$implicit,v=a();return f(v.copyOriginAddress(m))}),n(16," \u{1F4CB} "),i()()(),r(17,"div",29)(18,"div",30)(19,"span",24),n(20,"Dropoff:"),i(),r(21,"span",31),n(22),x(23,"date"),i()(),r(24,"div",32)(25,"div")(26,"div"),n(27),i(),r(28,"div"),n(29),i()(),r(30,"button",33),b("click",function(){let m=u(t).$implicit,v=a();return f(v.copyDestinationAddress(m))}),n(31," \u{1F4CB} "),i()()(),r(32,"div",34)(33,"div")(34,"span",24),n(35,"Order #:"),i(),n(36),i(),r(37,"div",35)(38,"span",31),n(39),x(40,"date"),i()(),c(41,P,3,4,"div",36),i()(),r(42,"div",37)(43,"button",38),b("click",function(){let m=u(t).$implicit,v=a();return f(v.viewOrder(m))}),n(44," View Details "),i()()()}if(d&2){let t=e.$implicit,l=a();o(7),p(" ",g(8,13,t.pickupDateAndTime,"EEE, MMM dd HH:mm")," "),o(5),_(t.originStreetAddress),o(2),h("",t.originCity,", ",t.originState," ",t.originZipcode,""),o(8),p(" ",g(23,16,t.dropOffDateAndTime,"EEE, MMM dd HH:mm")," "),o(5),_(t.destinationStreetAddress),o(2),h("",t.destinationCity,", ",t.destinationState," ",t.destinationZipcode,""),o(7),p(" ",t.orderNumber," "),o(3),p(" ",g(40,19,l.getCompletedDate(t),"MMM dd, yyyy")," "),o(2),s("ngIf",t.orderValue)}}var M=class d{constructor(e,t,l){this.router=e;this.ordersService=t;this.toastService=l}loading=!1;orders=[];completedOrders=[];selectedOrders=[];filteredOrders=[];ngOnInit(){this.loadOrders()}loadOrders(){this.loading=!0,this.ordersService.getDriverOrders().subscribe(e=>{this.orders=e,this.filterCompletedOrders(),this.loading=!1},e=>{console.error("Error loading completed orders:",e),this.toastService.showError("Failed to load completed orders. Try reloading the app.",5e3),this.loading=!1})}filterCompletedOrders(){this.completedOrders=this.orders.filter(e=>e.status===$.DELIVERED),this.filteredOrders=[...this.completedOrders]}viewOrder(e){this.ordersService.setCurrentOrder(e),this.router.navigate(["/driver/order-detail",e.id])}selectAllOrders(){this.selectedOrders.length===this.filteredOrders.length?this.selectedOrders=[]:this.selectedOrders=[...this.filteredOrders]}generateInvoice(){this.selectAllOrders();let e=this.selectedOrders.map(t=>t.id).join(",");this.router.navigate(["/driver/generate-invoice/",e])}calculateTotalEarnings(){return this.selectedOrders.reduce((e,t)=>e+(t.orderValue||0),0)}copyOriginAddress(e){let t=`${e.originStreetAddress}, ${e.originCity}, ${e.originState} ${e.originZipcode}`;navigator.clipboard.writeText(t),this.toastService.showSuccess("Origin address copied to clipboard",2e3)}copyDestinationAddress(e){let t=`${e.destinationStreetAddress}, ${e.destinationCity}, ${e.destinationState} ${e.destinationZipcode}`;navigator.clipboard.writeText(t),this.toastService.showSuccess("Destination address copied to clipboard",2e3)}getCompletedDate(e){return e.completedDate?new Date(e.completedDate):new Date(e.dropOffDateAndTime)}getTotalCompletedOrders(){return this.completedOrders.length}getTotalEarningsAllOrders(){return this.completedOrders.reduce((e,t)=>e+(t.orderValue||0),0)}static \u0275fac=function(t){return new(t||d)(O(T),O(V),O(k))};static \u0275cmp=S({type:d,selectors:[["app-completed-orders"]],decls:23,vars:10,consts:[["class","fixed inset-0 z-50 grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"max-w-md","mx-auto","pt-0"],[1,"text-2xl","font-bold","text-green-900","mb-4","flex","items-center","gap-2"],[1,"mb-4","grid","grid-cols-2","gap-4"],[1,"bg-green-50","border","border-green-200","rounded-lg","p-3"],[1,"text-2xl","font-bold","text-green-900"],[1,"text-sm","text-green-700"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-3"],[1,"text-2xl","font-bold","text-blue-900"],[1,"text-sm","text-blue-700"],["class","mb-4 flex flex-row justify-end items-center",4,"ngIf"],[1,"mb-6"],["class","text-gray-500 text-center py-8 bg-gray-50 rounded-lg",4,"ngIf"],["class","text-gray-500 text-center py-4 bg-gray-50 rounded-lg",4,"ngIf"],["class","mb-3 rounded-xl shadow border border-green-200 bg-green-50 p-2 flex flex-col gap-2",4,"ngFor","ngForOf"],[1,"fixed","inset-0","z-50","grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"],[1,"mb-4","flex","flex-row","justify-end","items-center"],["class","bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-semibold transition",3,"click",4,"ngIf"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded","text-sm","font-semibold","transition",3,"click"],[1,"text-gray-500","text-center","py-8","bg-gray-50","rounded-lg"],[1,"text-4xl","mb-2"],[1,"font-semibold"],[1,"text-sm"],[1,"text-gray-500","text-center","py-4","bg-gray-50","rounded-lg"],[1,"mb-3","rounded-xl","shadow","border","border-green-200","bg-green-50","p-2","flex","flex-col","gap-2"],[1,"text-sm","text-gray-700"],[1,"mb-2"],[1,"flex","flex-row","justify-between","gap-2"],[1,"text-xs","text-gray-500"],[1,"ml-2","flex","flex-row","items-center","gap-2"],[1,"text-blue-600","hover:text-blue-800","p-1",3,"click"],[1,"flex","justify-between","items-center","text-xs","text-gray-600","pt-2","border-t","border-green-200"],[1,"flex","items-center","gap-2"],["class","font-semibold text-green-700",4,"ngIf"],[1,"flex","flex-row","justify-end","mt-2","gap-1"],[1,"bg-green-600","hover:bg-green-700","text-white","px-3","py-2","rounded","text-xs","font-semibold","transition",3,"click"],[1,"font-semibold","text-green-700"]],template:function(t,l){t&1&&(c(0,j,5,0,"div",0),r(1,"div",1)(2,"h2",2)(3,"span"),n(4,"\u2705"),i(),n(5," Completed Orders "),i(),r(6,"div",3)(7,"div",4)(8,"div",5),n(9),i(),r(10,"div",6),n(11,"Total Orders"),i()(),r(12,"div",7)(13,"div",8),n(14),x(15,"number"),i(),r(16,"div",9),n(17,"Total Earnings"),i()()(),c(18,B,2,1,"div",10),r(19,"div",11),c(20,N,7,0,"div",12)(21,H,2,0,"div",13)(22,R,45,22,"div",14),i()()),t&2&&(s("ngIf",l.loading),o(9),_(l.getTotalCompletedOrders()),o(5),p("$",g(15,7,l.getTotalEarningsAllOrders(),"1.2-2"),""),o(4),s("ngIf",l.filteredOrders.length>0),o(2),s("ngIf",l.filteredOrders.length===0&&l.completedOrders.length===0),o(),s("ngIf",l.filteredOrders.length===0&&l.completedOrders.length>0),o(),s("ngForOf",l.filteredOrders))},dependencies:[E,w,D,I,A],encapsulation:2})};export{M as CompletedOrdersComponent};
