import{a as z}from"./chunk-FT3E63IU.js";import{a as X}from"./chunk-QMLNVYDR.js";import{a as J}from"./chunk-VXI25XYZ.js";import{a as G}from"./chunk-6BX5BP67.js";import"./chunk-CFVKQP3S.js";import{b as U,d as R,g as P,l as j,m as B,n as K,u as H}from"./chunk-SVMRWARE.js";import{a as Y}from"./chunk-DC5KZ2EN.js";import{a as L}from"./chunk-DA7YCHM5.js";import"./chunk-3TXZS4HG.js";import{a as O}from"./chunk-5R44ZK2D.js";import"./chunk-XPCCV2FB.js";import{c as W,e as k,f as F}from"./chunk-KA6K7UZ3.js";import"./chunk-GDLZFIOX.js";import{l as N,m as A}from"./chunk-GEVPNXBN.js";import{Ab as T,Bb as h,Cb as f,Db as D,Ja as d,Nb as C,Oa as _,Ta as I,Y as p,Ya as v,Z as u,a as E,eb as m,ib as s,jb as o,nb as x,qb as g,rb as c,v as M,vb as S,wb as l,xb as V,zb as y}from"./chunk-YSP72ENP.js";var w=class{id;name;phone;email;userId;licenseState;licenseNumber;expirationDate;truck;documents;warnings=[];constructor(){this.id="",this.name="",this.phone="",this.email="",this.userId="",this.licenseState="",this.licenseNumber="",this.expirationDate="",this.truck=null,this.documents=[],this.warnings=[]}};function q(n,t){if(n&1&&(s(0,"option",21),l(1),o()),n&2){let e=t.$implicit;m("ngValue",e),d(),T(" ",e.email," (",e.firstName," ",e.lastName,") ")}}function Q(n,t){if(n&1&&(s(0,"option",22),l(1),o()),n&2){let e=t.$implicit;m("value",e.code),d(),y("",e.name," (",e.code,")")}}function $(n,t){if(n&1&&(s(0,"li"),l(1),o()),n&2){let e=t.$implicit;d(),V(e)}}function ee(n,t){if(n&1&&(s(0,"div",23)(1,"strong"),l(2,"Warnings:"),o(),s(3,"ul",24),v(4,$,2,1,"li",25),o()()),n&2){let e=c(2);d(4),m("ngForOf",e.driver.warnings)}}function te(n,t){n&1&&(s(0,"span",32),l(1,"\u26A0\uFE0F"),o())}function ie(n,t){if(n&1){let e=x();s(0,"li")(1,"a",29),g("click",function(){let i=p(e).$implicit,r=c(4);return u(r.viewDocument(i))}),l(2),o(),v(3,te,2,0,"span",30),s(4,"button",31),g("click",function(){let i=p(e).index,r=c(4);return u(r.deleteDocument(i))}),l(5," Delete "),o()()}if(n&2){let e=t.$implicit,a=c(4);d(2),y(" ",e.documentType," (",e.expires?"Exp: "+e.expires:"No Expiry",")"),d(),m("ngIf",a.expiryWarning(e))}}function re(n,t){if(n&1&&(s(0,"ul",24),v(1,ie,6,3,"li",25),o()),n&2){let e=c(3);d(),m("ngForOf",e.driver.documents)}}function ne(n,t){n&1&&(s(0,"span",33),l(1,"No documents available."),o())}function oe(n,t){if(n&1){let e=x();s(0,"div")(1,"label",10),l(2,"Driver Documents: "),o(),v(3,re,2,1,"ul",26)(4,ne,2,0,"ng-template",null,1,C),s(6,"div",27)(7,"app-add-document",28),g("documentAdded",function(i){p(e);let r=c(2);return u(r.addDocument(i))}),o()()()}if(n&2){let e=S(5),a=c(2);d(3),m("ngIf",a.driver.documents==null?null:a.driver.documents.length)("ngIfElse",e),d(4),m("documentTypes",a.documentTypes)("driverId",a.driver.id)}}function ae(n,t){if(n&1){let e=x();s(0,"div")(1,"div",9)(2,"div")(3,"label",10),l(4,"Email:"),o(),s(5,"div",11)(6,"select",12),D("ngModelChange",function(i){p(e);let r=c();return f(r.selectedUser,i)||(r.selectedUser=i),u(i)}),g("ngModelChange",function(i){p(e);let r=c();return u(r.onEmailChange(i))}),v(7,q,2,4,"option",13),o()()(),s(8,"div",3)(9,"label",10),l(10,"Name:"),o(),s(11,"input",14),D("ngModelChange",function(i){p(e);let r=c();return f(r.driver.name,i)||(r.driver.name=i),u(i)}),o()(),s(12,"div",3)(13,"label",10),l(14,"Phone:"),o(),s(15,"input",14),D("ngModelChange",function(i){p(e);let r=c();return f(r.driver.phone,i)||(r.driver.phone=i),u(i)}),o()(),s(16,"div",3)(17,"label",10),l(18,"License:"),o(),s(19,"div",11)(20,"select",12),D("ngModelChange",function(i){p(e);let r=c();return f(r.driver.licenseState,i)||(r.driver.licenseState=i),u(i)}),v(21,Q,2,3,"option",15),o(),s(22,"input",16),D("ngModelChange",function(i){p(e);let r=c();return f(r.driver.licenseNumber,i)||(r.driver.licenseNumber=i),u(i)}),o()()()(),s(23,"div",17)(24,"button",18),g("click",function(){p(e);let i=c();return u(i.saveDriverDetails())}),l(25," Save "),o()(),v(26,ee,5,1,"div",19)(27,oe,8,4,"div",20),o()}if(n&2){let e=c();d(6),h("ngModel",e.selectedUser),d(),m("ngForOf",e.users),d(4),h("ngModel",e.driver.name),d(4),h("ngModel",e.driver.phone),d(5),h("ngModel",e.driver.licenseState),d(),m("ngForOf",e.states),d(),h("ngModel",e.driver.licenseNumber),d(4),m("ngIf",e.driver.warnings&&e.driver.warnings.length>0),d(),m("ngIf",!e.newDriver)}}function se(n,t){n&1&&(s(0,"div",34),l(1,"Loading driver details..."),o())}var Z=class n{constructor(t,e,a,i,r,b,de){this.route=t;this.router=e;this.driverService=a;this.settingsService=i;this.usersService=r;this.documentsService=b;this.toastService=de}driver=new w;pageLoaded=!1;documentTypes=[];states=[{code:"AL",name:"Alabama"},{code:"AK",name:"Alaska"},{code:"AZ",name:"Arizona"},{code:"AR",name:"Arkansas"},{code:"CA",name:"California"},{code:"CO",name:"Colorado"},{code:"CT",name:"Connecticut"},{code:"DE",name:"Delaware"},{code:"FL",name:"Florida"},{code:"GA",name:"Georgia"},{code:"HI",name:"Hawaii"},{code:"ID",name:"Idaho"},{code:"IL",name:"Illinois"},{code:"IN",name:"Indiana"},{code:"IA",name:"Iowa"},{code:"KS",name:"Kansas"},{code:"KY",name:"Kentucky"},{code:"LA",name:"Louisiana"},{code:"ME",name:"Maine"},{code:"MD",name:"Maryland"},{code:"MA",name:"Massachusetts"},{code:"MI",name:"Michigan"},{code:"MN",name:"Minnesota"},{code:"MS",name:"Mississippi"},{code:"MO",name:"Missouri"},{code:"MT",name:"Montana"},{code:"NE",name:"Nebraska"},{code:"NV",name:"Nevada"},{code:"NH",name:"New Hampshire"},{code:"NJ",name:"New Jersey"},{code:"NM",name:"New Mexico"},{code:"NY",name:"New York"},{code:"NC",name:"North Carolina"},{code:"ND",name:"North Dakota"},{code:"OH",name:"Ohio"},{code:"OK",name:"Oklahoma"},{code:"OR",name:"Oregon"},{code:"PA",name:"Pennsylvania"},{code:"RI",name:"Rhode Island"},{code:"SC",name:"South Carolina"},{code:"SD",name:"South Dakota"},{code:"TN",name:"Tennessee"},{code:"TX",name:"Texas"},{code:"UT",name:"Utah"},{code:"VT",name:"Vermont"},{code:"VA",name:"Virginia"},{code:"WA",name:"Washington"},{code:"WV",name:"West Virginia"},{code:"WI",name:"Wisconsin"},{code:"WY",name:"Wyoming"}];users=[];selectedUser=null;newDriver=!1;showDocumentViewer=!1;currentDocument=null;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");this.pageLoaded=!1,M({users:this.usersService.getUsers(),drivers:this.driverService.getDrivers()}).subscribe({next:({users:e,drivers:a})=>{t&&t!=="new"?this.driverService.getDriver(t).subscribe(i=>{this.users=e.filter(r=>r.email===i.email),this.driver=i,this.selectedUser=this.users.find(r=>r.email===i.email)||null}):t==="new"&&(this.newDriver=!0,this.users=e.filter(i=>!a.some(r=>r.email===i.email)),this.driver=new w,this.driver.documents=[]),this.pageLoaded=!0},error:e=>{this.pageLoaded=!0,console.error("Error loading data:",e),this.toastService.showError("Failed to load data")}}),this.loadDocumentTypes()}loadDocumentTypes(){this.settingsService.getSettings().subscribe(t=>{this.documentTypes=t.driverDocuments})}addDocument(t){t.documentType&&t.url&&(this.driver.documents=this.driver.documents||[],this.driver.documents.push(E({},t)))}expiryWarning(t){if(!t.expires)return!1;let e=this.driver.documents.filter(r=>r.documentType===t.documentType),a=new Date,i=new Date;return i.setMonth(a.getMonth()+1),e.every(r=>new Date(r.expires)<i)}deleteDocument(t){if(this.driver.documents&&this.driver.documents[t]){let e=this.driver.documents[t];this.documentsService.deleteDocument(e.id).subscribe({next:()=>{this.toastService.showSuccess("Document deleted successfully"),this.driver.documents.splice(t,1)},error:a=>{console.error("Error deleting document:",a),this.toastService.showError("Failed to delete document")}})}}saveDriverDetails(){this.driver.id?this.driverService.updateDriver(this.driver).subscribe({next:t=>{this.toastService.showSuccess("Driver updated successfully"),this.router.navigate(["/dispatcher/drivers"])},error:t=>{console.error("Error updating driver:",t),this.toastService.showError("Failed to update driver")}}):this.driverService.createDriver(this.driver).subscribe({next:t=>{this.toastService.showSuccess("Driver created successfully"),this.router.navigate(["/dispatcher/drivers"])},error:t=>{console.error("Error creating driver:",t),this.toastService.showError("Failed to create driver")}})}onEmailChange(t){t?(this.driver.userId=t.id,this.driver.email=t.email,this.driver.name=`${t.firstName} ${t.lastName}`,this.driver.phone=t.phoneNumber||""):(this.driver.userId="",this.driver.email="",this.driver.name="",this.driver.phone="")}viewDocument(t){this.currentDocument=t,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=null}onDownloadError(t){console.error("Download failed:",t),this.toastService.showError("Failed to download document")}static \u0275fac=function(e){return new(e||n)(_(W),_(k),_(O),_(J),_(X),_(Y),_(L))};static \u0275cmp=I({type:n,selectors:[["app-driver-detail"]],decls:14,vars:4,consts:[["loading",""],["noDocs",""],[1,"mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"mb-4"],["routerLink","/dispatcher/drivers",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"text-2xl","font-bold","mb-4","text-green-900","flex","items-center","gap-2"],[4,"ngIf","ngIfElse"],[3,"close","downloadError","document","isVisible"],[1,"grid","grid-cols-2","gap-4"],[1,"font-semibold"],[1,"flex","gap-4"],[1,"border","rounded","p-2","w-full",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","disabled","disabled",1,"border","rounded","p-2","w-full","bg-gray-100",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text",1,"border","rounded","p-2","w-full",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-green-500","text-white","px-4","py-2","rounded","hover:bg-green-600",3,"click"],["class","bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-2 rounded mb-4",4,"ngIf"],[4,"ngIf"],[3,"ngValue"],[3,"value"],[1,"bg-yellow-100","border","border-yellow-400","text-yellow-700","px-4","py-2","rounded","mb-4"],[1,"list-disc","pl-5"],[4,"ngFor","ngForOf"],["class","list-disc pl-5",4,"ngIf","ngIfElse"],[1,"py-2","w-1/2"],[3,"documentAdded","documentTypes","driverId"],["href","javascript:void(0)",1,"text-blue-500","underline","cursor-pointer",3,"click"],["class","ml-2 text-yellow-500 align-middle",4,"ngIf"],[1,"ml-4","text-red-500","hover:text-red-700",3,"click"],[1,"ml-2","text-yellow-500","align-middle"],[1,"italic","text-gray-500"],[1,"text-gray-500"]],template:function(e,a){if(e&1){let i=x();s(0,"div",2)(1,"div",3)(2,"a",4)(3,"span",5),l(4,"\u2190"),o(),l(5," Go Back "),o()(),s(6,"h2",6)(7,"span"),l(8,"\u{1F69A}"),o(),l(9," Driver Details "),o(),v(10,ae,28,9,"div",7)(11,se,2,0,"ng-template",null,0,C),s(13,"app-document-viewer",8),g("close",function(){return p(i),u(a.closeDocumentViewer())})("downloadError",function(b){return p(i),u(a.onDownloadError(b))}),o()()}if(e&2){let i=S(12);d(10),m("ngIf",a.pageLoaded)("ngIfElse",i),d(3),m("document",a.currentDocument)("isVisible",a.showDocumentViewer)}},dependencies:[H,B,K,U,j,R,P,N,A,F,z,G],encapsulation:2})};export{Z as DriverDetailComponent};
