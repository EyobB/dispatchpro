import{a as u}from"./chunk-ZTGCRYCC.js";import{a as f}from"./chunk-XPCCV2FB.js";import{b as d}from"./chunk-2DXK6GBI.js";import{L as p,O as m,T as s,n as a,r as c,z as g}from"./chunk-ITTAAY47.js";var v=class n{constructor(t,e){this.http=t;this.driversService=e}logout(){localStorage.removeItem("loggedInUser")}isTokenValid(){let t=this.getLoggedInUser();if(!t||!t.token)return!1;let e=t.token.split(".");if(e.length!==3)return!1;let o=JSON.parse(atob(e[1]));return(o.exp?o.exp*1e3:0)>Date.now()}getLoggedInUser(){let t=localStorage.getItem("loggedInUser");if(!t)return null;let e=JSON.parse(t);if(e&&e.token){let o=this.extractRolesFromToken(e.token);o&&(e.roles=o)}return e}getCurrentDriverId(){return localStorage.getItem("driverId")??null}extractRolesFromToken(t){try{let e=t.split(".")[1],o=JSON.parse(atob(e)),r=o.roles||o.role||o["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]||o["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role"];return typeof r=="string"?[r]:Array.isArray(r)?r:null}catch(e){return console.error("Error decoding token:",e),null}}login(t,e){let o={email:t,password:e};return this.http.post(`${f.apiUrl}/Auth/login`,o).pipe(c(r=>{if(r){localStorage.setItem("loggedInUser",JSON.stringify(r));let i=this.extractRolesFromToken(r.token);return i&&(r.roles=i,i.includes("Driver")&&this.driversService.getDriverByEmail(r?.email).pipe(p(l=>{l?localStorage.setItem("driverId",l.id):localStorage.removeItem("driverId")})).subscribe()),r}return null}),g(r=>(console.error("Login failed:",r),a(null))))}isLoggedIn(){return this.getLoggedInUser()!==null}isMobileScreen(){return window.innerWidth<768}static \u0275fac=function(e){return new(e||n)(s(d),s(u))};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};export{v as a};
