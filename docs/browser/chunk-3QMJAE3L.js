import{a as E}from"./chunk-7GTRUKFK.js";import{a as U}from"./chunk-LIL63FBP.js";import{b as S}from"./chunk-3TOGTSGL.js";import{m as V}from"./chunk-QAAQ2EEP.js";import{$ as p,Ab as D,Bb as I,Ia as v,La as o,Qa as w,Va as h,Z as x,_ as u,_a as s,gb as r,ha as _,kb as i,lb as l,mb as b,nb as y,ob as C,pb as g,sb as f,tb as d,zb as c}from"./chunk-QJGZKU5F.js";function O(t,n){t&1&&(i(0,"div",14),b(1,"div",15),i(2,"p",16),c(3,"Loading document..."),l()())}function j(t,n){if(t&1&&(i(0,"div",17)(1,"p"),c(2),l()()),t&2){let e=d(2);o(2),I("Error loading document: ",e.documentError,"")}}function T(t,n){if(t&1&&b(0,"iframe",20),t&2){let e=d(3);r("src",e.documentUrl,v)}}function R(t,n){t&1&&(i(0,"div",21)(1,"p",22),c(2,"Inline PDF preview isn't supported on this device/browser. You can open the document in a new tab."),l()())}function L(t,n){if(t&1&&(y(0),s(1,T,1,1,"iframe",18)(2,R,3,0,"div",19),C()),t&2){let e=d(2);o(),r("ngIf",e.supportsInlinePdf()),o(),r("ngIf",!e.supportsInlinePdf())}}function P(t,n){if(t&1){let e=g();i(0,"button",23),f("click",function(){u(e);let a=d(2);return p(a.openExternally())}),c(1,"Open Document"),l()}}function z(t,n){t&1&&(i(0,"span"),c(1,"Downloading..."),l())}function F(t,n){t&1&&(i(0,"span"),c(1,"Download"),l())}function M(t,n){if(t&1){let e=g();i(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3",4),c(4),l(),i(5,"button",5),f("click",function(){u(e);let a=d();return p(a.onClose())}),c(6,"\xD7"),l()(),i(7,"div",6),s(8,O,4,0,"div",7)(9,j,3,1,"div",8)(10,L,3,2,"ng-container",9),l(),i(11,"div",10),s(12,P,2,0,"button",11),i(13,"button",12),f("click",function(){u(e);let a=d();return p(a.onDownload())}),s(14,z,2,0,"span",9)(15,F,2,0,"span",9),l(),i(16,"button",13),f("click",function(){u(e);let a=d();return p(a.onClose())}),c(17," Close "),l()()()()}if(t&2){let e=d();o(4),D(e.document.documentType),o(4),r("ngIf",e.documentLoading),o(),r("ngIf",!e.documentLoading&&e.documentError),o(),r("ngIf",!e.documentLoading&&!e.documentError&&e.documentUrl),o(2),r("ngIf",!e.supportsInlinePdf()),o(),r("disabled",e.downloading),o(),r("ngIf",e.downloading),o(),r("ngIf",!e.downloading)}}var k=class t{constructor(n,e){this.sanitizer=n;this.documentsService=e}document=new E;isVisible=!1;close=new _;downloadComplete=new _;downloadError=new _;documentUrl=null;objectUrlRaw=null;documentLoading=!1;documentError=null;downloading=!1;isMobile=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);isIOS=/iP(ad|hone|od)/i.test(navigator.userAgent);ngOnInit(){}ngOnChanges(n){(n.document||n.isVisible)&&this.document&&this.document.url&&this.isVisible&&this.loadDocument()}loadDocument(){this.documentLoading=!0,this.documentError=null,this.documentsService.getDocumentBlob(this.document.url).subscribe({next:n=>{this.revokeObjectUrl();let e=window.URL.createObjectURL(n);this.objectUrlRaw=e,this.documentUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e),this.documentLoading=!1},error:n=>{this.documentError="Failed to load document",this.documentLoading=!1,console.error("Error loading document:",n)}})}onClose(){this.revokeObjectUrl(),this.close.emit()}onDownload(){this.document.url&&(this.downloading=!0,this.documentsService.downloadDocument(this.document.url).subscribe({next:()=>{this.downloading=!1,this.downloadComplete.emit()},error:n=>{this.downloading=!1,this.downloadError.emit("Failed to download document"),console.error("Error downloading document:",n)}}))}ngOnDestroy(){this.revokeObjectUrl()}openExternally(){this.objectUrlRaw&&window.open(this.objectUrlRaw,"_blank")}supportsInlinePdf(){return!(this.isIOS||this.isMobile)}revokeObjectUrl(){if(this.objectUrlRaw){try{window.URL.revokeObjectURL(this.objectUrlRaw)}catch{}this.objectUrlRaw=null}}static \u0275fac=function(e){return new(e||t)(w(S),w(U))};static \u0275cmp=h({type:t,selectors:[["app-document-viewer"]],inputs:{document:"document",isVisible:"isVisible"},outputs:{close:"close",downloadComplete:"downloadComplete",downloadError:"downloadError"},features:[x],decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-600 flex items-center justify-center z-50",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-600","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-lg","p-6","max-w-6xl","max-h-[90vh]","w-full","mx-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-bold"],[1,"text-gray-500","hover:text-gray-700","text-2xl",3,"click"],[1,"overflow-auto","max-h-[70vh]"],["class","text-center py-8",4,"ngIf"],["class","text-center py-8 text-red-500",4,"ngIf"],[4,"ngIf"],[1,"mt-4","flex","gap-2"],["class","bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",3,"click",4,"ngIf"],[1,"bg-blue-500","text-white","px-4","py-2","rounded","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"bg-gray-500","text-white","px-4","py-2","rounded","hover:bg-gray-600",3,"click"],[1,"text-center","py-8"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-500"],[1,"mt-2"],[1,"text-center","py-8","text-red-500"],["class","w-full h-96 border rounded","frameborder","0",3,"src",4,"ngIf"],["class","p-4 bg-yellow-50 border border-yellow-200 rounded",4,"ngIf"],["frameborder","0",1,"w-full","h-96","border","rounded",3,"src"],[1,"p-4","bg-yellow-50","border","border-yellow-200","rounded"],[1,"text-sm","text-yellow-800","mb-2"],[1,"bg-blue-500","text-white","px-4","py-2","rounded","hover:bg-blue-600",3,"click"]],template:function(e,m){e&1&&s(0,M,18,8,"div",0),e&2&&r("ngIf",m.isVisible)},dependencies:[V],encapsulation:2})};export{k as a};
