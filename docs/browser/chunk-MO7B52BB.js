import{a as V}from"./chunk-CFVKQP3S.js";import{a as S}from"./chunk-K66A4NIS.js";import{b as E}from"./chunk-3TOGTSGL.js";import{m as C}from"./chunk-QAAQ2EEP.js";import{$ as u,Ab as y,Bb as D,Ia as _,La as r,Qa as x,Va as b,Z as v,_ as m,_a as f,gb as c,ha as p,kb as i,lb as o,mb as g,pb as h,sb as w,tb as l,zb as d}from"./chunk-QJGZKU5F.js";function k(n,t){n&1&&(i(0,"div",14),g(1,"div",15),i(2,"p",16),d(3,"Loading document..."),o()())}function U(n,t){if(n&1&&(i(0,"div",17)(1,"p"),d(2),o()()),n&2){let e=l(2);r(2),D("Error loading document: ",e.documentError,"")}}function T(n,t){if(n&1&&g(0,"iframe",18),n&2){let e=l(2);c("src",e.documentUrl,_)}}function L(n,t){n&1&&(i(0,"span"),d(1,"Downloading..."),o())}function O(n,t){n&1&&(i(0,"span"),d(1,"Download"),o())}function z(n,t){if(n&1){let e=h();i(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3",4),d(4),o(),i(5,"button",5),w("click",function(){m(e);let a=l();return u(a.onClose())}),d(6,"\xD7"),o()(),i(7,"div",6),f(8,k,4,0,"div",7)(9,U,3,1,"div",8)(10,T,1,1,"iframe",9),o(),i(11,"div",10)(12,"button",11),w("click",function(){m(e);let a=l();return u(a.onDownload())}),f(13,L,2,0,"span",12)(14,O,2,0,"span",12),o(),i(15,"button",13),w("click",function(){m(e);let a=l();return u(a.onClose())}),d(16," Close "),o()()()()}if(n&2){let e=l();r(4),y(e.document.documentType),r(4),c("ngIf",e.documentLoading),r(),c("ngIf",!e.documentLoading&&e.documentError),r(),c("ngIf",!e.documentLoading&&!e.documentError&&e.documentUrl),r(2),c("disabled",e.downloading),r(),c("ngIf",e.downloading),r(),c("ngIf",!e.downloading)}}var I=class n{constructor(t,e){this.sanitizer=t;this.documentsService=e}document=new V;isVisible=!1;close=new p;downloadComplete=new p;downloadError=new p;documentUrl=null;documentLoading=!1;documentError=null;downloading=!1;ngOnInit(){}ngOnChanges(){this.document&&this.document.url&&this.isVisible&&this.loadDocument()}loadDocument(){this.documentLoading=!0,this.documentError=null,this.documentsService.getDocumentBlob(this.document.url).subscribe({next:t=>{let e=window.URL.createObjectURL(t);this.documentUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e),this.documentLoading=!1},error:t=>{this.documentError="Failed to load document",this.documentLoading=!1,console.error("Error loading document:",t)}})}onClose(){this.close.emit()}onDownload(){this.document.url&&(this.downloading=!0,this.documentsService.downloadDocument(this.document.url).subscribe({next:()=>{this.downloading=!1,this.downloadComplete.emit()},error:t=>{this.downloading=!1,this.downloadError.emit("Failed to download document"),console.error("Error downloading document:",t)}}))}ngOnDestroy(){if(this.documentUrl){let t=this.documentUrl.changingThisBreaksApplicationSecurity;t&&t.startsWith("blob:")&&window.URL.revokeObjectURL(t)}}static \u0275fac=function(e){return new(e||n)(x(E),x(S))};static \u0275cmp=b({type:n,selectors:[["app-document-viewer"]],inputs:{document:"document",isVisible:"isVisible"},outputs:{close:"close",downloadComplete:"downloadComplete",downloadError:"downloadError"},features:[v],decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-600 flex items-center justify-center z-50",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-600","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-lg","p-6","max-w-6xl","max-h-[90vh]","w-full","mx-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-bold"],[1,"text-gray-500","hover:text-gray-700","text-2xl",3,"click"],[1,"overflow-auto","max-h-[70vh]"],["class","text-center py-8",4,"ngIf"],["class","text-center py-8 text-red-500",4,"ngIf"],["class","w-full h-96 border rounded","frameborder","0",3,"src",4,"ngIf"],[1,"mt-4","flex","gap-2"],[1,"bg-blue-500","text-white","px-4","py-2","rounded","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[4,"ngIf"],[1,"bg-gray-500","text-white","px-4","py-2","rounded","hover:bg-gray-600",3,"click"],[1,"text-center","py-8"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-500"],[1,"mt-2"],[1,"text-center","py-8","text-red-500"],["frameborder","0",1,"w-full","h-96","border","rounded",3,"src"]],template:function(e,s){e&1&&f(0,z,17,7,"div",0),e&2&&c("ngIf",s.isVisible)},dependencies:[C],encapsulation:2})};export{I as a};
