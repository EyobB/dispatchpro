import{a as ne}from"./chunk-MSIQXZHU.js";import{a as ie}from"./chunk-BI46WA4O.js";import{b as re}from"./chunk-FAZMLUFE.js";import{a as oe}from"./chunk-VXI25XYZ.js";import{a as ee}from"./chunk-6BX5BP67.js";import{a as O,c as $}from"./chunk-CFVKQP3S.js";import{a as te}from"./chunk-NTYF7ZMB.js";import{b as J,d as Z,g as H,i as X,l as q,m as K,n as Q,u as Y}from"./chunk-SVMRWARE.js";import"./chunk-DC5KZ2EN.js";import{a as G}from"./chunk-DA7YCHM5.js";import"./chunk-3TXZS4HG.js";import{a as z}from"./chunk-5R44ZK2D.js";import"./chunk-XPCCV2FB.js";import{c as R,e as A,f as W,j as B}from"./chunk-KA6K7UZ3.js";import"./chunk-GDLZFIOX.js";import{l as j,m as L}from"./chunk-GEVPNXBN.js";import{Ab as k,Bb as b,Cb as w,Db as E,Fa as F,Gb as N,Ja as l,Nb as U,Oa as x,Ta as M,Y as p,Ya as v,Z as u,eb as s,gb as P,hb as C,ib as r,jb as e,kb as I,nb as D,qb as g,rb as f,v as V,vb as T,wb as t,xb as S,yb as _,zb as y}from"./chunk-YSP72ENP.js";var le=o=>["/order-checkins-map",o];function ae(o,d){if(o&1&&(r(0,"option",39),t(1),e()),o&2){let i=d.$implicit;s("value",i.id),l(),_(" ",i.name," ")}}function se(o,d){if(o&1&&(r(0,"div",40)(1,"div"),t(2),e(),r(3,"div"),t(4),e()()),o&2){let i=f();l(2),S(i.selectedDriver==null?null:i.selectedDriver.phone),l(2),y("License: ",i.selectedDriver==null?null:i.selectedDriver.licenseState," - ",i.selectedDriver==null?null:i.selectedDriver.licenseNumber,"")}}function ce(o,d){if(o&1&&(r(0,"option",39),t(1),e()),o&2){let i=d.$implicit;s("value",i.id),l(),y(" ",i.plate," - ",i.type," ")}}function me(o,d){if(o&1&&(r(0,"div",40)(1,"div"),t(2),e(),r(3,"div"),t(4),e()()),o&2){let i=f();l(2),S(i.selectedTruck==null?null:i.selectedTruck.type),l(2),_("DOT: ",i.selectedTruck==null?null:i.selectedTruck.dotNumber,"")}}function pe(o,d){if(o&1){let i=D();r(0,"li")(1,"a",43),g("click",function(){let a=p(i).$implicit,c=f(2);return u(c.viewDocument(a))}),t(2),e()()}if(o&2){let i=d.$implicit;l(2),y(" ",i.documentType," (",i.fileName,") ")}}function ue(o,d){if(o&1&&(r(0,"div")(1,"ul",41),v(2,pe,3,2,"li",42),e()()),o&2){let i=f();l(2),s("ngForOf",i.order.documents)}}function ve(o,d){if(o&1){let i=D();r(0,"div")(1,"a",44)(2,"span"),t(3,"\u{1F4C4}"),e(),t(4," View PoD Document "),e(),r(5,"button",45),g("click",function(){p(i);let a=f();return u(a.removePod())}),t(6," Remove "),e()()}if(o&2){let i=f();l(),s("href",i.podUrl,F)}}function ge(o,d){o&1&&(r(0,"span"),t(1,"Upload PoD"),e())}function fe(o,d){o&1&&(r(0,"span"),t(1,"Uploading..."),e())}function _e(o,d){if(o&1&&(r(0,"div",50),t(1),e()),o&2){let i=f(2);l(),_(" ",i.uploadError," ")}}function xe(o,d){if(o&1){let i=D();r(0,"div",46),t(1,"No PoD uploaded."),e(),r(2,"input",47,1),g("change",function(a){p(i);let c=f();return u(c.onFileSelected(a))}),e(),r(4,"button",48),g("click",function(){p(i);let a=T(3);return u(a.click())}),v(5,ge,2,0,"span",27)(6,fe,2,0,"span",27),e(),v(7,_e,2,1,"div",49)}if(o&2){let i=f();l(4),s("disabled",i.isUploading),l(),s("ngIf",!i.isUploading),l(),s("ngIf",i.isUploading),l(),s("ngIf",i.uploadError)}}function he(o,d){if(o&1){let i=D();r(0,"div",51)(1,"div",52)(2,"span",16),t(3),e(),r(4,"input",53),E("ngModelChange",function(a){let c=p(i).$implicit;return w(c.amount,a)||(c.amount=a),u(a)}),e()()()}if(o&2){let i=d.$implicit;P("opacity-60",i.amount===0),l(3),S(i.description),l(),b("ngModel",i.amount)}}function De(o,d){o&1&&(r(0,"li",59)(1,"span",60),t(2,"\u2022"),e(),t(3," Driver must be selected "),e())}function Se(o,d){o&1&&(r(0,"li",59)(1,"span",60),t(2,"\u2022"),e(),t(3," Truck must be selected "),e())}function be(o,d){o&1&&(r(0,"li",59)(1,"span",60),t(2,"\u2022"),e(),t(3," Proof of Delivery (PoD) document must be uploaded "),e())}function we(o,d){o&1&&(r(0,"li",59)(1,"span",60),t(2,"\u2022"),e(),t(3," PoD # must be entered "),e())}function Ee(o,d){if(o&1&&(r(0,"div",54)(1,"div",55)(2,"p",56),t(3,"Cannot convert to invoice:"),e(),r(4,"ul",57),v(5,De,4,0,"li",58)(6,Se,4,0,"li",58)(7,be,4,0,"li",58)(8,we,4,0,"li",58),e()()()),o&2){let i=f();l(5),s("ngIf",!i.order.driverId),l(),s("ngIf",!i.order.truckId),l(),s("ngIf",!i.podUrl),l(),s("ngIf",!i.order.podNumber)}}var de=class o{constructor(d,i,n,a,c,m,h){this.router=d;this.route=i;this.ordersService=n;this.driversService=a;this.trucksService=c;this.settingsService=m;this.toastService=h}order=new re;podUrl=null;availableDrivers=[];availableTrucks=[];selectedDriver=null;selectedTruck=null;costTypes=[];isUploading=!1;uploadError=null;showDocumentViewer=!1;currentDocument=new O;ngOnInit(){let d=this.route.snapshot.paramMap.get("id")||"";V({order:this.ordersService.getOrder(d),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks(),settings:this.settingsService.getSettings()}).subscribe(({order:i,drivers:n,trucks:a,settings:c})=>{this.order=i,this.availableDrivers=n,this.availableTrucks=a,this.onDriverSelect(),this.onTruckSelect(),this.costTypes=c.driverCosts,this.costTypes=c.driverCosts,this.costTypes.forEach(m=>{if(this.order.driverCosts=this.order.driverCosts||[],!this.order.driverCosts.some(h=>h.description===m)){let h=new ne;h.description=m,h.amount=0,this.order.driverCosts.push(h)}})})}updateOrder(){this.order.driverId=this.order.driverId||null,this.order.truckId=this.order.truckId||null,this.ordersService.updateOrder(this.order).subscribe(()=>{this.toastService.showSuccess("Order updated successfully")},d=>{console.error("Error updating order:",d)})}assignDriverTruck(){this.ordersService.assignDriver(this.order).subscribe(()=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},d=>{console.error("Error assigning driver and truck:",d)})}markDelivered(){this.order&&(this.order.status="Delivered")}markInTransit(){this.order&&(this.order.status="In Transit")}deleteOrder(){this.order&&confirm("Are you sure you want to delete this order?")&&this.ordersService.deleteOrder(this.order.id).subscribe(()=>{this.toastService.showSuccess("Order deleted successfully"),this.router.navigate(["/dispatcher/orders"])},d=>{console.error("Error deleting order:",d),this.toastService.showError("Failed to delete order")})}onFileSelected(d){let i=d.target.files[0];if(!i)return;if(!["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(i.type)){this.uploadError="Please select a valid file (PDF, JPG, PNG, DOC, DOCX)";return}let a=5*1024*1024;if(i.size>a){this.uploadError="File size must be less than 5MB";return}this.uploadPodFile(i)}uploadPodFile(d){this.isUploading=!0,this.uploadError=null;let i=URL.createObjectURL(d);setTimeout(()=>{let n={id:"1",documentType:$.POD,url:i,fileType:d.type,fileName:d.name,expires:"2025-12-31"};this.order.documents||(this.order.documents=[]),this.order.documents=this.order.documents,this.order.documents.push(n),this.podUrl=i,this.isUploading=!1},1e3)}removePod(){confirm("Are you sure you want to remove the PoD document?")&&(this.order.documents&&(this.order.documents=this.order.documents.filter(d=>d.documentType!=="PoD")),this.podUrl=null)}createInvoice(){this.router.navigate(["/dispatcher/order-to-invoice",this.order.id])}onDriverSelect(){this.selectedDriver=this.availableDrivers.find(d=>d.id===this.order.driverId)??null}onTruckSelect(){this.selectedTruck=this.availableTrucks.find(d=>d.id===this.order.truckId)??null}isValidForInvoice(){return!!(this.order.driverId&&this.order.truckId&&this.podUrl&&this.order.podNumber)}viewDocument(d){this.currentDocument=d,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new O}onDownloadError(d){console.error("Download failed:",d),this.toastService.showError("Failed to download document")}static \u0275fac=function(i){return new(i||o)(x(A),x(R),x(te),x(z),x(ie),x(oe),x(G))};static \u0275cmp=M({type:o,selectors:[["app-order-detail"]],decls:123,vars:36,consts:[["noPod",""],["fileInput",""],[1,"max-w-3xl","mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"mb-4"],["routerLink","/dispatcher/orders",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-2","text-green-900","flex","items-center","gap-2"],[1,"mb-6","flex","gap-4","text-gray-600"],[1,"bg-gray-100","px-3","py-1","rounded"],[1,"font-medium"],[1,"flex-1"],[1,"bg-blue-100","px-3","py-1","rounded","hover:bg-blue-200","transition",3,"routerLink"],[1,"text-blue-600"],[1,"mb-6","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"font-semibold"],[1,"mb-6"],[1,"flex","flex-col","sm:flex-row","gap-8"],[1,"flex-1","bg-gray-50","rounded","p-4"],[1,"text-xs","text-gray-500"],[1,"mt-2"],[1,"w-full","p-2","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-2 p-2 mt-0 pt-0 bg-white rounded shadow-sm text-xs text-gray-900",4,"ngIf"],[3,"click","disabled"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"w-36","p-1","mb-4","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"mb-6","flex-row"],[1,"space-y-0","w-1/2"],["class","bg-gray-50 p-2 rounded transition-colors",3,"opacity-60",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],["class","w-full mb-4",4,"ngIf"],[1,"bg-red-600","hover:bg-red-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-green-600","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"px-6","py-2","rounded","shadow","font-semibold","transition",3,"click","disabled"],[3,"close","downloadError","document","isVisible"],[3,"value"],[1,"mt-2","p-2","mt-0","pt-0","bg-white","rounded","shadow-sm","text-xs","text-gray-900"],[1,"list-disc","pl-5","space-y-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],["target","_blank",1,"text-blue-700","hover:underline","flex","items-center","gap-1","font-medium",3,"href"],[1,"ml-4","bg-red-500","hover:bg-red-600","text-white","px-3","py-1","rounded","text-sm",3,"click"],[1,"text-gray-500","italic","mb-2"],["type","file","accept",".pdf,.jpg,.jpeg,.png,.doc,.docx",1,"hidden",3,"change"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded",3,"click","disabled"],["class","mt-2 text-red-600 text-sm",4,"ngIf"],[1,"mt-2","text-red-600","text-sm"],[1,"bg-gray-50","p-2","rounded","transition-colors"],[1,"flex","justify-between","items-center","mb-1"],["type","number","placeholder","0.00",1,"w-36","p-1","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-red-50","border","border-red-200","rounded","p-3"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","space-y-1"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500"]],template:function(i,n){if(i&1){let a=D();r(0,"div",2)(1,"div",3)(2,"a",4)(3,"span",5),t(4,"\u2190"),e(),t(5," Go Back "),e()(),r(6,"h2",6)(7,"span"),t(8,"\u{1F4E6}"),e(),t(9," Order Details "),e(),r(10,"div",7)(11,"div",8)(12,"span",9),t(13,"Order #:"),e(),t(14),e(),r(15,"div",8)(16,"span",9),t(17,"Load #:"),e(),t(18),e(),I(19,"div",10),r(20,"a",11)(21,"span",9),t(22,"View Map"),e(),r(23,"span",12),t(24,"\u{1F4CD}"),e()()(),r(25,"div",13)(26,"h3",14)(27,"span"),t(28,"\u{1F464}"),e(),t(29," Customer Information "),e(),r(30,"div",15)(31,"div")(32,"span",16),t(33,"Name:"),e(),t(34),e(),r(35,"div")(36,"span",16),t(37,"Contact:"),e(),t(38),e()()(),r(39,"div",17)(40,"h3",14)(41,"span"),t(42,"\u{1F5FA}\uFE0F"),e(),t(43," Route "),e(),r(44,"div",18)(45,"div",19)(46,"span",16),t(47,"Origin:"),e(),r(48,"div",9),t(49),e(),r(50,"div",20),t(51),e()(),r(52,"div",19)(53,"span",16),t(54,"Destination:"),e(),r(55,"div",9),t(56),e(),r(57,"div",20),t(58),e()()()(),r(59,"div",17)(60,"h3",14)(61,"span"),t(62,"\u{1F4E6}"),e(),t(63," Load Details "),e(),r(64,"div")(65,"span",16),t(66,"Description:"),e(),t(67),e()(),r(68,"div",17)(69,"h3",14)(70,"span"),t(71,"\u{1F9D1}\u200D\u2708\uFE0F"),e(),t(72," Driver & Truck "),e(),r(73,"div",18)(74,"div",10)(75,"span",16),t(76,"Driver: "),e(),r(77,"div",21)(78,"select",22),E("ngModelChange",function(m){return p(a),w(n.order.driverId,m)||(n.order.driverId=m),u(m)}),g("change",function(){return p(a),u(n.onDriverSelect())}),r(79,"option",23),t(80,"Select a driver"),e(),v(81,ae,2,2,"option",24),e(),v(82,se,5,3,"div",25),e()(),r(83,"div",10)(84,"span",16),t(85,"Truck: "),e(),r(86,"div",21)(87,"select",22),E("ngModelChange",function(m){return p(a),w(n.order.truckId,m)||(n.order.truckId=m),u(m)}),g("change",function(){return p(a),u(n.onTruckSelect())}),r(88,"option",23),t(89,"Select a truck"),e(),v(90,ce,2,3,"option",24),e(),v(91,me,5,2,"div",25),e()()(),r(92,"button",26),g("click",function(){return p(a),u(n.assignDriverTruck())}),t(93," Assign Driver & Truck "),e()(),r(94,"div",17)(95,"h3",14)(96,"span"),t(97,"\u{1F4C4}"),e(),t(98," Documents "),e(),v(99,ue,3,1,"div",27)(100,ve,7,1,"div",28)(101,xe,8,4,"ng-template",null,0,U),e(),r(103,"span",16),t(104,"PoD #:"),e(),I(105,"br"),r(106,"input",29),E("ngModelChange",function(m){return p(a),w(n.order.podNumber,m)||(n.order.podNumber=m),u(m)}),e(),r(107,"div",30)(108,"h3",14)(109,"span"),t(110,"\u{1F4B2}"),e(),t(111," Driver Costs "),e(),r(112,"div",31),v(113,he,5,4,"div",32),e()(),r(114,"div",33),v(115,Ee,9,4,"div",34),r(116,"button",35),g("click",function(){return p(a),u(n.deleteOrder())}),t(117," Delete Order "),e(),r(118,"button",36),g("click",function(){return p(a),u(n.updateOrder())}),t(119," Update Order "),e(),r(120,"button",37),g("click",function(){return p(a),u(n.createInvoice())}),t(121," Convert To Invoice "),e()()(),r(122,"app-document-viewer",38),g("close",function(){return p(a),u(n.closeDocumentViewer())})("downloadError",function(m){return p(a),u(n.onDownloadError(m))}),e()}if(i&2){let a=T(102);l(14),_(" ",n.order.orderNumber," "),l(4),_(" ",n.order.loadNumber," "),l(2),s("routerLink",N(34,le,n.order.id)),l(14),_(" ",n.order.brokerName,""),l(4),_(" ",n.order.brokerContact,""),l(11),S(n.order.originStreetAddress),l(2),k("",n.order.originCity,", ",n.order.originState," ",n.order.originZipcode," "),l(5),S(n.order.destinationStreetAddress),l(2),k("",n.order.destinationCity,", ",n.order.destinationState," ",n.order.destinationZipcode,""),l(9),_(" ",n.order.description," "),l(11),b("ngModel",n.order.driverId),l(3),s("ngForOf",n.availableDrivers),l(),s("ngIf",n.order.driverId),l(5),b("ngModel",n.order.truckId),l(3),s("ngForOf",n.availableTrucks),l(),s("ngIf",n.order.truckId),l(),C(!n.order.driverId||!n.order.truckId?"bg-gray-300 text-gray-500 cursor-not-allowed p-2 my-2 rounded":"bg-green-600 hover:bg-green-700 text-white p-2 my-2 rounded"),s("disabled",!n.order.driverId||!n.order.truckId),l(7),s("ngIf",n.order.documents&&n.order.documents.length>0),l(),s("ngIf",n.podUrl)("ngIfElse",a),l(6),b("ngModel",n.order.podNumber),l(7),s("ngForOf",n.order.driverCosts),l(2),s("ngIf",!n.isValidForInvoice()),l(5),C(n.isValidForInvoice()?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),s("disabled",!n.isValidForInvoice()),l(2),s("document",n.currentDocument)("isVisible",n.showDocumentViewer)}},dependencies:[L,j,B,W,Y,K,Q,J,X,q,Z,H,ee],encapsulation:2})};export{de as OrderDetailComponent};
