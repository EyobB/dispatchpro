import{a as L,b as N}from"./chunk-DDEBU2FK.js";import{a as O,b as V,c as B}from"./chunk-7GTRUKFK.js";import{a as z}from"./chunk-C72DZDNH.js";import{u as M}from"./chunk-VDT5TDP2.js";import{a as R}from"./chunk-7LAHPUI6.js";import"./chunk-25LA7BX7.js";import"./chunk-ZTGCRYCC.js";import"./chunk-XPCCV2FB.js";import{c as D,e as T}from"./chunk-KM6ROI6B.js";import"./chunk-2DXK6GBI.js";import{m as C,s as k}from"./chunk-TKJYB7RJ.js";import{$ as u,Ab as I,Ga as P,Ka as l,Pa as x,Ua as E,Za as v,_ as c,aa as g,ba as y,fb as s,gb as U,hb as F,jb as t,kb as n,lb as p,ob as _,rb as f,sb as m,x as S,xb as w,yb as a,zb as b}from"./chunk-ITTAAY47.js";function A(o,i){if(o&1){let e=_();t(0,"div",22),f("click",function(){c(e),m();let d=w(17);return u(d.click())}),t(1,"div",23),g(),t(2,"svg",24),p(3,"path",25)(4,"polyline",26)(5,"line",27),n()(),y(),t(6,"h3",28),a(7,"Choose a pdf file"),n(),t(8,"p",29),a(9,"Maximum file size: 10MB"),n(),t(10,"button",30),a(11," Browse Files "),n()()}}function H(o,i){if(o&1&&(t(0,"div",43),p(1,"img",44),n()),o&2){let e=m(2);l(),s("src",e.previewUrl,P)("alt",e.selectedFile.name)}}function q(o,i){if(o&1){let e=_();t(0,"div",31)(1,"div",32),v(2,H,2,2,"div",33),t(3,"div",34)(4,"div",35),a(5),n(),t(6,"div",36)(7,"h4",37),a(8),n(),t(9,"p",38),a(10),n()(),t(11,"button",39),f("click",function(){c(e);let d=m();return u(d.removePod())}),g(),t(12,"svg",40),p(13,"line",41)(14,"line",42),n()()()()()}if(o&2){let e=m();l(2),s("ngIf",e.previewUrl),l(3),b(e.getFileIcon(e.selectedFile)),l(3),b(e.selectedFile.name),l(2),b(e.formatFileSize(e.selectedFile.size))}}function W(o,i){if(o&1&&(t(0,"div",45)(1,"div",46),p(2,"div",47),n(),t(3,"p",48),a(4),n()()),o&2){let e=m();l(2),U("width",e.uploadProgress,"%"),l(2),I("Uploading... ",e.uploadProgress,"%")}}function J(o,i){if(o&1&&(t(0,"div",49),g(),t(1,"svg",50),p(2,"circle",51)(3,"line",52)(4,"line",53),n(),y(),t(5,"span"),a(6),n()()),o&2){let e=m();l(6),b(e.uploadError)}}function K(o,i){o&1&&(t(0,"div",54),g(),t(1,"svg",50),p(2,"polyline",55),n(),y(),t(3,"span"),a(4,"POD uploaded successfully!"),n()())}function Y(o,i){o&1&&(t(0,"span"),a(1,"Upload POD"),n())}function Q(o,i){o&1&&(t(0,"span"),a(1,"Uploading..."),n())}var j=class o{constructor(i,e,r,d){this.documentsService=i;this.ordersService=e;this.route=r;this.router=d}selectedFile=null;previewUrl=null;isUploading=!1;uploadProgress=0;uploadError=null;uploadSuccess=!1;allowedTypes=["image/jpeg","image/jpg","image/png","image/webp","application/pdf"];maxFileSize=5*1024*1024;order=new N;ngOnInit(){let i=this.route.snapshot.paramMap.get("id");if(!i){this.uploadError="Order ID is required to upload POD",this.isUploading=!1;return}this.ordersService.getCurrentOrder(i).subscribe(e=>{if(!e){this.uploadError="Order not found",this.isUploading=!1;return}this.order.id=i,this.order=e})}onPodSelected(i){let e=i.target;if(this.uploadError=null,this.uploadSuccess=!1,e.files&&e.files.length>0){let r=e.files[0];if(!this.allowedTypes.includes(r.type)){this.uploadError="Please select a valid image file (JPEG, PNG, WebP) or PDF";return}if(r.size>this.maxFileSize){this.uploadError="File size must be less than 5MB";return}if(this.selectedFile=r,r.type.startsWith("image/")){let d=new FileReader;d.onload=h=>{this.previewUrl=h.target?.result},d.readAsDataURL(r)}else this.previewUrl=null}else this.selectedFile=null,this.previewUrl=null}uploadPod(){if(!this.selectedFile){this.uploadError="Please select a file first";return}this.isUploading=!0,this.uploadProgress=0,this.uploadError=null;let i=new O;i.documentType=B.POD,i.fileType=this.selectedFile.type,i.fileName=this.selectedFile.name,i.expires=new Date().toISOString().substring(0,10);let e=new V(i,this.selectedFile);e.orderId=this.order.id,S({doc:this.documentsService.uploadFile(e),order:this.ordersService.updateOrderStatus(this.order.id,L.PARTIALLY_DELIVERED)}).subscribe({next:({doc:r,order:d})=>{this.isUploading=!1,this.uploadSuccess=!0,this.uploadProgress=100,this.resetForm()},error:r=>{console.error("Upload failed:",r),this.isUploading=!1,this.uploadError="Failed to upload POD. Please try again.",this.uploadProgress=0}})}removePod(){this.selectedFile=null,this.previewUrl=null,this.uploadError=null,this.uploadSuccess=!1}resetForm(){this.router.navigate(["/driver/current-orders"])}getFileIcon(i){return i.type.startsWith("image/")?"\u{1F5BC}\uFE0F":i.type==="application/pdf"?"\u{1F4C4}":"\u{1F4CE}"}formatFileSize(i){if(i===0)return"0 Bytes";let e=1024,r=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(i)/Math.log(e));return parseFloat((i/Math.pow(e,d)).toFixed(2))+" "+r[d]}static \u0275fac=function(e){return new(e||o)(x(R),x(z),x(D),x(T))};static \u0275cmp=E({type:o,selectors:[["app-upload-pod"]],decls:29,vars:13,consts:[["podNumberInput",""],["fileInput",""],[1,"max-w-2xl","mx-auto","p-6","font-sans"],[1,"text-center","mb-4"],[1,"text-gray-900","text-2xl","font-semibold","mb-2"],[1,"text-gray-600","text-sm"],[1,"mb-4"],["for","pod-number",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["id","pod-number","type","text","required","","autocomplete","off","placeholder","Enter POD #",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],[1,"text-xs","text-gray-500","mt-1"],[1,"border-2","border-dashed","rounded-xl","bg-gray-50","transition-all","duration-300","overflow-hidden"],["type","file","id","pod-file","accept","image/*,.pdf",1,"hidden",3,"change"],["class","p-4 text-center cursor-pointer transition-colors duration-200 hover:bg-gray-100",3,"click",4,"ngIf"],["class","p-6",4,"ngIf"],["class","my-4",4,"ngIf"],["class","flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-lg text-sm my-4",4,"ngIf"],["class","flex items-center gap-2 p-3 bg-green-50 text-green-700 border border-green-200 rounded-lg text-sm my-4",4,"ngIf"],[1,"flex","gap-3","justify-center","mt-6","sm:flex-row","flex-col"],["type","button",1,"px-6","py-3","bg-green-600","text-white","rounded-lg","text-sm","font-medium","transition-all","duration-200","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","sm:w-auto","w-full",3,"click","disabled"],[4,"ngIf"],["type","button",1,"px-6","py-3","bg-gray-100","text-gray-700","border","border-gray-300","rounded-lg","text-sm","font-medium","transition-all","duration-200","hover:bg-gray-200","disabled:opacity-50","disabled:cursor-not-allowed","sm:w-auto","w-full",3,"click","disabled"],[1,"p-4","text-center","cursor-pointer","transition-colors","duration-200","hover:bg-gray-100",3,"click"],[1,"text-gray-400","mb-2"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-6","h-6","mx-auto"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","7,10 12,15 17,10"],["x1","12","y1","15","x2","12","y2","3"],[1,"text-gray-800","text-lg","font-medium","mb-2"],[1,"text-gray-500","text-sm","mb-4"],["type","button",1,"bg-blue-500","text-white","px-5","py-2.5","rounded-lg","text-sm","font-medium","hover:bg-blue-600","transition-colors","duration-200"],[1,"p-6"],[1,"flex","flex-col","gap-4"],["class","text-center",4,"ngIf"],[1,"flex","items-center","gap-3","p-4","bg-white","rounded-lg","shadow-sm"],[1,"text-3xl"],[1,"flex-1","min-w-0"],[1,"text-gray-800","text-base","font-medium","mb-1","break-words"],[1,"text-gray-500","text-sm"],["type","button","title","Remove file",1,"text-red-500","p-2","rounded","hover:bg-red-50","transition-colors","duration-200",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"text-center"],[1,"max-w-full","max-h-80","rounded-lg","shadow-md","mx-auto",3,"src","alt"],[1,"my-4"],[1,"w-full","h-2","bg-gray-200","rounded-full","overflow-hidden","mb-2"],[1,"h-full","bg-blue-500","rounded-full","transition-all","duration-300","ease-out"],[1,"text-center","text-gray-500","text-sm"],[1,"flex","items-center","gap-2","p-3","bg-red-50","text-red-700","border","border-red-200","rounded-lg","text-sm","my-4"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-4","h-4","flex-shrink-0"],["cx","12","cy","12","r","10"],["x1","15","y1","9","x2","9","y2","15"],["x1","9","y1","9","x2","15","y2","15"],[1,"flex","items-center","gap-2","p-3","bg-green-50","text-green-700","border","border-green-200","rounded-lg","text-sm","my-4"],["points","20,6 9,17 4,12"]],template:function(e,r){if(e&1){let d=_();t(0,"div",2)(1,"div",3)(2,"h2",4),a(3,"Upload Proof of Delivery"),n(),t(4,"p",5),a(5,"Upload a PDF document as proof of delivery"),n()(),t(6,"div",6)(7,"label",7),a(8," POD Number "),t(9,"span",8),a(10,"*"),n()(),p(11,"input",9,0),t(13,"p",10),a(14,"Required before uploading."),n()(),t(15,"div",11)(16,"input",12,1),f("change",function(G){return c(d),u(r.onPodSelected(G))}),n(),v(18,A,12,0,"div",13)(19,q,15,4,"div",14),n(),v(20,W,5,3,"div",15)(21,J,7,1,"div",16)(22,K,5,0,"div",17),t(23,"div",18)(24,"button",19),f("click",function(){return c(d),u(r.uploadPod())}),v(25,Y,2,0,"span",20)(26,Q,2,0,"span",20),n(),t(27,"button",21),f("click",function(){return c(d),u(r.resetForm())}),a(28," Back "),n()()()}if(e&2){let d=w(12);l(15),F("border-blue-500",r.selectedFile)("bg-blue-50",r.selectedFile),l(3),s("ngIf",!r.selectedFile),l(),s("ngIf",r.selectedFile),l(),s("ngIf",r.isUploading),l(),s("ngIf",r.uploadError),l(),s("ngIf",r.uploadSuccess),l(2),s("disabled",!r.selectedFile||r.isUploading||!d.value),l(),s("ngIf",!r.isUploading),l(),s("ngIf",r.isUploading),l(),s("disabled",r.isUploading)}},dependencies:[k,C,M],encapsulation:2})};export{j as UploadPodComponent};
