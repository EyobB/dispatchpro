import{a as ie}from"./chunk-MSIQXZHU.js";import{a as re}from"./chunk-PM57GPI3.js";import{a as ne}from"./chunk-4CWGDVG7.js";import{a as te}from"./chunk-6QKKABF2.js";import{b as ee}from"./chunk-DDEBU2FK.js";import{a as oe}from"./chunk-NQCQ3VFV.js";import{a as Y}from"./chunk-SMTY5PGD.js";import{a as k,c as O}from"./chunk-7GTRUKFK.js";import{a as $}from"./chunk-65LLF5LD.js";import{b as G,d as J,g as q,i as z,l as H,m as K,n as Q,u as X}from"./chunk-VDT5TDP2.js";import"./chunk-7LAHPUI6.js";import{a as Z}from"./chunk-A3LUHI23.js";import"./chunk-25LA7BX7.js";import{a as B}from"./chunk-ZTGCRYCC.js";import"./chunk-XPCCV2FB.js";import{c as L,e as j,f as R,j as U}from"./chunk-KM6ROI6B.js";import"./chunk-2DXK6GBI.js";import{l as P,m as W}from"./chunk-TKJYB7RJ.js";import{$ as y,Ab as v,Bb as x,Cb as T,Db as h,Eb as D,Fb as S,Ib as A,Ka as d,Pa as p,Ua as V,Za as m,_ as E,a as M,fb as c,hb as N,ib as w,jb as r,kb as e,lb as C,ob as I,rb as u,sb as f,x as F,yb as t,zb as _}from"./chunk-ITTAAY47.js";var le=l=>["/order-checkins-map",l];function ae(l,n){if(l&1&&(r(0,"option",37),t(1),e()),l&2){let o=n.$implicit;c("value",o.id),d(),v(" ",o.name," ")}}function se(l,n){if(l&1&&(r(0,"div",38)(1,"div"),t(2),e(),r(3,"div"),t(4),e()()),l&2){let o=f();d(2),_(o.selectedDriver==null?null:o.selectedDriver.phone),d(2),x("License: ",o.selectedDriver==null?null:o.selectedDriver.licenseState," - ",o.selectedDriver==null?null:o.selectedDriver.licenseNumber,"")}}function ce(l,n){if(l&1&&(r(0,"option",37),t(1),e()),l&2){let o=n.$implicit;c("value",o.id),d(),x(" ",o.plate," - ",o.type," ")}}function me(l,n){if(l&1&&(r(0,"div",38)(1,"div"),t(2),e(),r(3,"div"),t(4),e()()),l&2){let o=f();d(2),_(o.selectedTruck==null?null:o.selectedTruck.type),d(2),v("DOT: ",o.selectedTruck==null?null:o.selectedTruck.dotNumber,"")}}function ue(l,n){if(l&1){let o=I();r(0,"li")(1,"a",41),u("click",function(){let s=E(o).$implicit,a=f(2);return y(a.viewDocument(s))}),t(2),e()()}if(l&2){let o=n.$implicit;d(2),x(" ",o.documentType," (",o.fileName,") ")}}function pe(l,n){if(l&1&&(r(0,"div")(1,"ul",39),m(2,ue,3,2,"li",40),e()()),l&2){let o=f();d(2),c("ngForOf",o.order.documents)}}function ve(l,n){if(l&1){let o=I();r(0,"div",42)(1,"div",43)(2,"span",13),t(3),e(),r(4,"input",44),S("ngModelChange",function(s){let a=E(o).$implicit;return D(a.amount,s)||(a.amount=s),y(s)}),e()()()}if(l&2){let o=n.$implicit;N("opacity-60",o.amount===0),d(3),_(o.description),d(),h("ngModel",o.amount)}}function ge(l,n){l&1&&(r(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," Driver must be selected "),e())}function fe(l,n){l&1&&(r(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," Truck must be selected "),e())}function _e(l,n){l&1&&(r(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," Proof of Delivery (PoD) document must be uploaded "),e())}function he(l,n){l&1&&(r(0,"li",50)(1,"span",51),t(2,"\u2022"),e(),t(3," PoD # must be entered "),e())}function De(l,n){if(l&1&&(r(0,"div",45)(1,"div",46)(2,"p",47),t(3,"Cannot convert to invoice:"),e(),r(4,"ul",48),m(5,ge,4,0,"li",49)(6,fe,4,0,"li",49)(7,_e,4,0,"li",49)(8,he,4,0,"li",49),e()()()),l&2){let o=f();d(5),c("ngIf",!o.order.driverId),d(),c("ngIf",!o.order.truckId),d(),c("ngIf",!o.isPodUploaded),d(),c("ngIf",!o.order.podNumber)}}var de=class l{constructor(n,o,i,s,a,b,g,Se){this.router=n;this.route=o;this.ordersService=i;this.driversService=s;this.trucksService=a;this.settingsService=b;this.invoiceService=g;this.toastService=Se}order=new ee;podUrl=null;availableDrivers=[];availableTrucks=[];selectedDriver=null;selectedTruck=null;costTypes=[];isUploading=!1;uploadError=null;showDocumentViewer=!1;currentDocument=new k;documentTypes=[O.RATE_CON];ngOnInit(){let n=this.route.snapshot.paramMap.get("id")||"";F({order:this.ordersService.getOrder(n),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks(),settings:this.settingsService.getSettings()}).subscribe(({order:o,drivers:i,trucks:s,settings:a})=>{this.order=o,this.availableDrivers=i,this.availableTrucks=s,this.onDriverSelect(),this.onTruckSelect(),this.costTypes=a.driverCosts,this.costTypes=a.driverCosts,this.costTypes.forEach(b=>{if(this.order.driverCosts=this.order.driverCosts||[],!this.order.driverCosts.some(g=>g.description===b)){let g=new ie;g.description=b,g.amount=0,this.order.driverCosts.push(g)}})})}updateOrder(){this.order.driverId=this.order.driverId||null,this.order.truckId=this.order.truckId||null,this.ordersService.updateOrder(this.order).subscribe(()=>{this.toastService.showSuccess("Order updated successfully")},n=>{console.error("Error updating order:",n)})}assignDriverTruck(){this.ordersService.assignDriver(this.order).subscribe(()=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},n=>{console.error("Error assigning driver and truck:",n)})}markDelivered(){this.order&&(this.order.status="Delivered")}get isPodUploaded(){return this.order.documents?.some(n=>n.documentType===O.POD)??!1}markInTransit(){this.order&&(this.order.status="In Transit")}deleteOrder(){this.order&&confirm("Are you sure you want to delete this order?")&&this.ordersService.deleteOrder(this.order.id).subscribe(()=>{this.toastService.showSuccess("Order deleted successfully"),this.router.navigate(["/dispatcher/orders"])},n=>{console.error("Error deleting order:",n),this.toastService.showError("Failed to delete order")})}removePod(){confirm("Are you sure you want to remove the PoD document?")&&(this.order.documents&&(this.order.documents=this.order.documents.filter(n=>n.documentType!=="PoD")),this.podUrl=null)}addDocument(n){n.documentType&&n.url&&n.expires&&(this.order.documents=this.order.documents||[],this.order.documents.push(M({},n)))}createInvoice(){this.ordersService.updateOrder(this.order).subscribe(()=>{this.invoiceService.createInvoice(this.order.id).subscribe(n=>{this.router.navigate(["/dispatcher/carrier-invoices",n.id])},n=>{console.error("Error creating invoice:",n),this.toastService.showError("Failed to create invoice")})},n=>{console.error("Error updating order:",n)})}onDriverSelect(){this.selectedDriver=this.availableDrivers.find(n=>n.id===this.order.driverId)??null}onTruckSelect(){this.selectedTruck=this.availableTrucks.find(n=>n.id===this.order.truckId)??null}isValidForInvoice(){return!!(this.order.driverId&&this.order.truckId&&this.isPodUploaded&&this.order.podNumber)}viewDocument(n){this.currentDocument=n,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new k}onDownloadError(n){console.error("Download failed:",n),this.toastService.showError("Failed to download document")}static \u0275fac=function(o){return new(o||l)(p(j),p(L),p($),p(B),p(te),p(ne),p(oe),p(Z))};static \u0275cmp=V({type:l,selectors:[["app-order-detail"]],decls:121,vars:36,consts:[[1,"max-w-3xl","mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"text-3xl","font-bold","mb-2","text-green-900","flex","items-center","gap-2"],[1,"mb-4","flex","gap-2","text-gray-600"],[1,"bg-gray-100","px-3","py-1","rounded"],[1,"font-medium"],[1,"flex-1"],[1,"bg-blue-100","px-3","py-1","rounded","hover:bg-blue-200","transition",3,"routerLink"],[1,"text-blue-600"],["routerLink","/dispatcher/orders",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"mb-4","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"font-semibold"],[1,"mb-4"],[1,"flex","flex-col","sm:flex-row","gap-8"],[1,"flex-1","bg-gray-50","rounded","p-4"],[1,"text-xs","text-gray-500"],[1,"mt-2"],[1,"w-full","p-2","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-2 p-2 mt-0 pt-0 bg-white rounded shadow-sm text-xs text-gray-900",4,"ngIf"],[3,"click","disabled"],[4,"ngIf"],[1,"py-2","w-1/2"],[3,"documentAdded","orderId","documentTypes"],[1,"w-36","p-1","mb-4","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"mb-4","flex-row"],[1,"space-y-0","w-1/2"],["class","bg-gray-50 p-2 rounded transition-colors",3,"opacity-60",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],["class","w-full mb-4",4,"ngIf"],[1,"bg-red-600","hover:bg-red-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-green-600","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"px-6","py-2","rounded","shadow","font-semibold","transition",3,"click","disabled"],[3,"close","downloadError","document","isVisible"],[3,"value"],[1,"mt-2","p-2","mt-0","pt-0","bg-white","rounded","shadow-sm","text-xs","text-gray-900"],[1,"list-disc","pl-5","space-y-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],[1,"bg-gray-50","p-2","rounded","transition-colors"],[1,"flex","justify-between","items-center","mb-1"],["type","number","placeholder","0.00",1,"w-36","p-1","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-red-50","border","border-red-200","rounded","p-3"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","space-y-1"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500"]],template:function(o,i){o&1&&(r(0,"div",0)(1,"h2",1)(2,"span"),t(3,"\u{1F4E6}"),e(),t(4," Order Details "),e(),r(5,"div",2)(6,"div",3)(7,"span",4),t(8,"Order #:"),e(),t(9),e(),r(10,"div",3)(11,"span",4),t(12,"Load #:"),e(),t(13),e(),C(14,"div",5),r(15,"a",6)(16,"span",4),t(17,"View Map"),e(),r(18,"span",7),t(19,"\u{1F4CD}"),e()(),r(20,"a",8)(21,"span",9),t(22,"\u2190"),e(),t(23," Go Back "),e()(),r(24,"div",10)(25,"h3",11)(26,"span"),t(27,"\u{1F464}"),e(),t(28," Customer Information "),e(),r(29,"div",12)(30,"div")(31,"span",13),t(32,"Name:"),e(),t(33),e(),r(34,"div")(35,"span",13),t(36,"Contact:"),e(),t(37),e()()(),r(38,"div",14)(39,"h3",11)(40,"span"),t(41,"\u{1F5FA}\uFE0F"),e(),t(42," Route "),e(),r(43,"div",15)(44,"div",16)(45,"span",13),t(46,"Origin:"),e(),r(47,"div",4),t(48),e(),r(49,"div",17),t(50),e()(),r(51,"div",16)(52,"span",13),t(53,"Destination:"),e(),r(54,"div",4),t(55),e(),r(56,"div",17),t(57),e()()()(),r(58,"div",14)(59,"h3",11)(60,"span"),t(61,"\u{1F4E6}"),e(),t(62," Load Details "),e(),r(63,"div")(64,"span",13),t(65,"Description:"),e(),t(66),e()(),r(67,"div",14)(68,"h3",11)(69,"span"),t(70,"\u{1F9D1}\u200D\u2708\uFE0F"),e(),t(71," Driver & Truck "),e(),r(72,"div",15)(73,"div",5)(74,"span",13),t(75,"Driver: "),e(),r(76,"div",18)(77,"select",19),S("ngModelChange",function(a){return D(i.order.driverId,a)||(i.order.driverId=a),a}),u("change",function(){return i.onDriverSelect()}),r(78,"option",20),t(79,"Select a driver"),e(),m(80,ae,2,2,"option",21),e(),m(81,se,5,3,"div",22),e()(),r(82,"div",5)(83,"span",13),t(84,"Truck: "),e(),r(85,"div",18)(86,"select",19),S("ngModelChange",function(a){return D(i.order.truckId,a)||(i.order.truckId=a),a}),u("change",function(){return i.onTruckSelect()}),r(87,"option",20),t(88,"Select a truck"),e(),m(89,ce,2,3,"option",21),e(),m(90,me,5,2,"div",22),e()()(),r(91,"button",23),u("click",function(){return i.assignDriverTruck()}),t(92," Assign Driver & Truck "),e()(),r(93,"div",14)(94,"h3",11)(95,"span"),t(96,"\u{1F4C4}"),e(),t(97," Documents "),e(),m(98,pe,3,1,"div",24),e(),r(99,"div",25)(100,"app-add-document",26),u("documentAdded",function(a){return i.addDocument(a)}),e()(),r(101,"span",13),t(102,"PoD #:"),e(),C(103,"br"),r(104,"input",27),S("ngModelChange",function(a){return D(i.order.podNumber,a)||(i.order.podNumber=a),a}),e(),r(105,"div",28)(106,"h3",11)(107,"span"),t(108,"\u{1F4B2}"),e(),t(109," Driver Costs "),e(),r(110,"div",29),m(111,ve,5,4,"div",30),e()(),r(112,"div",31),m(113,De,9,4,"div",32),r(114,"button",33),u("click",function(){return i.deleteOrder()}),t(115," Delete Order "),e(),r(116,"button",34),u("click",function(){return i.updateOrder()}),t(117," Update Order "),e(),r(118,"button",35),u("click",function(){return i.createInvoice()}),t(119," Convert To Invoice "),e()()(),r(120,"app-document-viewer",36),u("close",function(){return i.closeDocumentViewer()})("downloadError",function(a){return i.onDownloadError(a)}),e()),o&2&&(d(9),v(" ",i.order.orderNumber," "),d(4),v(" ",i.order.loadNumber," "),d(2),c("routerLink",A(34,le,i.order.id)),d(18),v(" ",i.order.brokerName,""),d(4),v(" ",i.order.brokerContact,""),d(11),_(i.order.originStreetAddress),d(2),T("",i.order.originCity,", ",i.order.originState," ",i.order.originZipcode," "),d(5),_(i.order.destinationStreetAddress),d(2),T("",i.order.destinationCity,", ",i.order.destinationState," ",i.order.destinationZipcode,""),d(9),v(" ",i.order.description," "),d(11),h("ngModel",i.order.driverId),d(3),c("ngForOf",i.availableDrivers),d(),c("ngIf",i.order.driverId),d(5),h("ngModel",i.order.truckId),d(3),c("ngForOf",i.availableTrucks),d(),c("ngIf",i.order.truckId),d(),w(!i.order.driverId||!i.order.truckId?"bg-gray-300 text-gray-500 cursor-not-allowed p-2 my-2 rounded":"bg-green-600 hover:bg-green-700 text-white p-2 my-2 rounded"),c("disabled",!i.order.driverId||!i.order.truckId),d(7),c("ngIf",i.order.documents&&i.order.documents.length>0),d(2),c("orderId",i.order.id)("documentTypes",i.documentTypes),d(4),h("ngModel",i.order.podNumber),d(7),c("ngForOf",i.order.driverCosts),d(2),c("ngIf",!i.isValidForInvoice()),d(5),w(i.isValidForInvoice()?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),c("disabled",!i.isValidForInvoice()),d(2),c("document",i.currentDocument)("isVisible",i.showDocumentViewer))},dependencies:[W,P,U,R,X,K,Q,G,z,H,J,q,re,Y],encapsulation:2})};export{de as OrderDetailComponent};
