import{a as A}from"./chunk-S57OZ2R5.js";import{a as L}from"./chunk-YK2LZHPZ.js";import{b as R}from"./chunk-UIIJYSZH.js";import{a as V}from"./chunk-S7HWF73Q.js";import{a as P}from"./chunk-7FUB44TE.js";import{b as N,d as k,g as W,i as B,u as j}from"./chunk-2PVWNWUN.js";import"./chunk-NBSK5KUW.js";import"./chunk-IMHYAPIP.js";import"./chunk-XPCCV2FB.js";import{c as M,e as D,j as O}from"./chunk-3TOGTSGL.js";import"./chunk-FSJQQIFH.js";import{l as w,q as E}from"./chunk-QAAQ2EEP.js";import{$ as x,Ab as T,Bb as l,Eb as m,Fb as c,Gb as p,La as d,Nb as h,Pb as b,Qa as u,Va as S,_ as f,_a as y,gb as C,kb as i,lb as e,pb as I,sb as g,tb as _,zb as t}from"./chunk-QJGZKU5F.js";function z(v,a){if(v&1){let r=I();i(0,"div",32)(1,"span"),t(2),e(),i(3,"div",33)(4,"span",34),t(5,"$"),e(),i(6,"input",35),p("ngModelChange",function(s){let o=f(r).$implicit;return c(o.amount,s)||(o.amount=s),x(s)}),g("change",function(){f(r);let s=_();return x(s.recalculateTotals())}),e()()()}if(v&2){let r=a.$implicit;d(2),T(r.description),d(4),m("ngModel",r.amount)}}var F=class v{constructor(a,r,n,s,o){this.route=a;this.router=r;this.ordersService=n;this.settingsService=s;this.invoiceService=o}order=new R;invoice=new L;paymentTerms="";paymentInstructions="";invoiceNotes="";orderTotal=0;driverTotal=0;dispatcherTotal=0;dispatcherCode="";ngOnInit(){let a=this.route.snapshot.paramMap.get("id");a&&(this.settingsService.getSettings().subscribe(r=>{this.dispatcherCode=r.dispatcherCode,this.paymentTerms=r.paymentTerms,this.paymentInstructions=r.paymentInstructions,this.invoiceNotes=r.invoiceNotes}),this.ordersService.getOrder(a).subscribe(r=>{this.order=r,this.initializeInvoice()}))}initializeInvoice(){this.driverTotal=this.order.driverCosts?.reduce((a,r)=>a+r.amount,0)||0,this.dispatcherTotal=this.order.dispatcherCosts?.reduce((a,r)=>a+r.amount,0)||0,this.orderTotal=this.order.rate+this.driverTotal+this.dispatcherTotal,this.invoice.brokerName=this.order.brokerName,this.invoice.dueDate=new Date().toISOString().split("T")[0],this.invoice.totalCost=this.orderTotal,this.invoice.podNumber=this.order.podNumber||"",this.invoice.loadNumber=this.order.loadNumber||"",this.invoice.status="Draft",this.invoice.invoiceNumber="",this.invoice.invoiceDate=new Date().toISOString().split("T")[0]}generateInvoice(){this.invoice.orderId=this.order.id,this.invoice.totalCost=this.orderTotal,this.invoice.terms=this.paymentTerms,this.invoice.paymentInstructions=this.paymentInstructions,this.invoice.notes=this.invoiceNotes,this.invoiceService.createInvoice(this.invoice).subscribe(a=>{this.order.invoiceId=a.id,this.ordersService.updateOrder(this.order).subscribe(()=>{this.router.navigate(["/dispatcher/invoices",a.id])})})}goBack(){this.router.navigate(["/dispatcher/orders",this.order.id])}recalculateTotals(){this.driverTotal=this.order.driverCosts?.reduce((a,r)=>a+(r.amount||0),0)||0,this.dispatcherTotal=this.order.dispatcherCosts?.reduce((a,r)=>a+(r.amount||0),0)||0,this.orderTotal=this.order.rate+this.driverTotal+this.dispatcherTotal,this.invoice.totalCost=this.orderTotal}static \u0275fac=function(r){return new(r||v)(u(M),u(D),u(P),u(A),u(V))};static \u0275cmp=S({type:v,selectors:[["app-order-to-invoice"]],decls:97,vars:22,consts:[[1,"mx-auto","max-w-3xl","p-6","bg-white","rounded-xl","shadow-lg"],[1,"mb-4"],[1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium",3,"click"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-6","text-green-900","flex","items-center","gap-2"],[1,"mb-6","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"font-semibold"],[1,"mb-6"],[1,"mb-4","bg-blue-50","rounded","p-4"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-bold","text-blue-900"],[1,"flex","justify-end","gap-6"],[1,"bg-gray-50","rounded","p-4","w-1/2"],[1,"font-semibold","mb-2","flex","items-center","gap-2"],[1,"space-y-2"],["class","flex justify-between items-center space-x-4",4,"ngFor","ngForOf"],[1,"border-t","pt-2","mt-4","flex","justify-between","font-semibold"],[1,"mt-4","bg-green-100","p-4","rounded"],[1,"flex","justify-between","items-center","text-lg","font-bold","text-green-900"],[1,"space-y-4"],[1,"flex","gap-4"],[1,"block","font-medium","mb-1"],["type","text","disabled","true",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["type","date",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","2",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","6",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],["rows","3","placeholder","Additional notes for the invoice...",1,"border","rounded","p-2","w-full","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],[1,"bg-green-600","hover:bg-green-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-gray-600","hover:bg-gray-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"flex","justify-between","items-center","space-x-4"],[1,"flex","items-center"],[1,"mr-1"],["type","number","placeholder","0.00",1,"w-24","p-1","border","rounded","focus:border-green-500","focus:outline-none","text-right",3,"ngModelChange","change","ngModel"]],template:function(r,n){r&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return n.goBack()}),i(3,"span",3),t(4,"\u2190"),e(),t(5," Back to Order "),e()(),i(6,"h2",4)(7,"span"),t(8,"\u{1F4C4}"),e(),t(9," Generate Invoice "),e(),i(10,"div",5)(11,"h3",6)(12,"span"),t(13,"\u{1F4E6}"),e(),t(14," Order Information "),e(),i(15,"div",7)(16,"div")(17,"span",8),t(18,"Load #:"),e(),t(19),e(),i(20,"div")(21,"span",8),t(22,"PoD #:"),e(),t(23),e(),i(24,"div")(25,"span",8),t(26,"Customer:"),e(),t(27),e(),i(28,"div")(29,"span",8),t(30,"Contact:"),e(),t(31),e()()(),i(32,"div",9)(33,"h3",6)(34,"span"),t(35,"\u{1F4B2}"),e(),t(36," Cost Summary "),e(),i(37,"div",10)(38,"div",11)(39,"span",8),t(40,"Rate Amount"),e(),i(41,"span",12),t(42),h(43,"number"),e()()(),i(44,"div",13)(45,"div",14)(46,"h4",15)(47,"span"),t(48,"\u{1F69B}"),e(),t(49," Driver Costs "),e(),i(50,"div",16),y(51,z,7,2,"div",17),i(52,"div",18)(53,"span"),t(54,"Driver Total"),e(),i(55,"span"),t(56),h(57,"number"),e()()()()(),i(58,"div",19)(59,"div",20)(60,"span"),t(61,"Order Total"),e(),i(62,"span"),t(63),h(64,"number"),e()()()(),i(65,"div",9)(66,"h3",6)(67,"span"),t(68,"\u{1F4DD}"),e(),t(69," Invoice Details "),e(),i(70,"div",21)(71,"div",22)(72,"div")(73,"label",23),t(74,"Invoice Number"),e(),i(75,"input",24),p("ngModelChange",function(o){return c(n.invoice.invoiceNumber,o)||(n.invoice.invoiceNumber=o),o}),e()(),i(76,"div")(77,"label",23),t(78,"Invoice Date"),e(),i(79,"input",25),p("ngModelChange",function(o){return c(n.invoice.invoiceDate,o)||(n.invoice.invoiceDate=o),o}),e()()(),i(80,"div")(81,"label",23),t(82,"Payment Terms"),e(),i(83,"textarea",26),p("ngModelChange",function(o){return c(n.paymentTerms,o)||(n.paymentTerms=o),o}),e()(),i(84,"div")(85,"label",23),t(86,"Payment Instructions"),e(),i(87,"textarea",27),p("ngModelChange",function(o){return c(n.paymentInstructions,o)||(n.paymentInstructions=o),o}),e()(),i(88,"div")(89,"label",23),t(90,"Notes"),e(),i(91,"textarea",28),p("ngModelChange",function(o){return c(n.invoiceNotes,o)||(n.invoiceNotes=o),o}),e()()()(),i(92,"div",29)(93,"button",30),g("click",function(){return n.generateInvoice()}),t(94," Generate Invoice "),e(),i(95,"button",31),g("click",function(){return n.goBack()}),t(96," Cancel "),e()()()),r&2&&(d(19),l(" ",n.order.loadNumber,""),d(4),l(" ",n.order.podNumber,""),d(4),l(" ",n.order.brokerName,""),d(4),l(" ",n.order.brokerContact,""),d(11),l("$ ",b(43,13,n.order.rate,"1.2-2"),""),d(9),C("ngForOf",n.order.driverCosts),d(5),l("$ ",b(57,16,n.driverTotal,"1.2-2"),""),d(7),l("$ ",b(64,19,n.orderTotal,"1.2-2"),""),d(12),m("ngModel",n.invoice.invoiceNumber),d(4),m("ngModel",n.invoice.invoiceDate),d(4),m("ngModel",n.paymentTerms),d(4),m("ngModel",n.paymentInstructions),d(4),m("ngModel",n.invoiceNotes))},dependencies:[w,O,j,N,B,k,W,E],encapsulation:2})};export{F as OrderToInvoiceComponent};
