import{a as Y}from"./chunk-ZTAFIMI3.js";import{a as Q}from"./chunk-JYZQW2UA.js";import{a as K}from"./chunk-IGQEBQMV.js";import{a as Z}from"./chunk-RYHISPQ6.js";import{a as q}from"./chunk-J75B7AT2.js";import"./chunk-ZFFVO34L.js";import{b as A,c as W,f as z,h as B,i as H,j as G,k as J,o as X}from"./chunk-WIAEWHLW.js";import{b as U,d as N,f as R,g as j,k as L}from"./chunk-3KQDNKNL.js";import{l as F,m as M}from"./chunk-B35W4A7H.js";import{Ab as b,Da as w,Ga as d,Kb as P,La as x,Qa as T,Va as v,ab as s,bb as k,cb as O,db as r,ea as p,eb as e,fa as u,ib as D,lb as _,mb as f,sb as y,tb as i,ub as h,vb as g,wb as V,xb as I,yb as S,zb as E}from"./chunk-WMTXBNFA.js";var C=class{amount;description;constructor(){this.amount=0,this.description=""}};function ee(o,a){if(o&1&&(r(0,"option",31),i(1),e()),o&2){let t=a.$implicit;s("value",t.id),d(),g(" ",t.name," ")}}function te(o,a){if(o&1&&(r(0,"div",32)(1,"div",9),i(2),e(),r(3,"div",17),i(4),e(),r(5,"div",17),i(6),e()()),o&2){let t=f();d(2),h(t.order.driver.name),d(2),h(t.order.driver.phone),d(2),g("License: ",t.order.driver.license,"")}}function ie(o,a){if(o&1&&(r(0,"option",31),i(1),e()),o&2){let t=a.$implicit;s("value",t.id),d(),V(" ",t.plate," - ",t.type," ")}}function re(o,a){if(o&1&&(r(0,"div",32)(1,"div",9),i(2),e(),r(3,"div",17),i(4),e(),r(5,"div",17),i(6),e()()),o&2){let t=f();d(2),h(t.order.truck.plate),d(2),h(t.order.truck.type),d(2),g("DOT: ",t.order.truck.dotNumber,"")}}function ne(o,a){if(o&1){let t=D();r(0,"div")(1,"a",33)(2,"span"),i(3,"\u{1F4C4}"),e(),i(4," View PoD Document "),e(),r(5,"button",34),_("click",function(){p(t);let l=f();return u(l.removePod())}),i(6," Remove "),e()()}if(o&2){let t=f();d(),s("href",t.podUrl,w)}}function oe(o,a){o&1&&(r(0,"span"),i(1,"Upload PoD"),e())}function de(o,a){o&1&&(r(0,"span"),i(1,"Uploading..."),e())}function ae(o,a){if(o&1&&(r(0,"div",40),i(1),e()),o&2){let t=f(2);d(),g(" ",t.uploadError," ")}}function le(o,a){if(o&1){let t=D();r(0,"div",35),i(1,"No PoD uploaded."),e(),r(2,"input",36,1),_("change",function(l){p(t);let c=f();return u(c.onFileSelected(l))}),e(),r(4,"button",37),_("click",function(){p(t);let l=y(3);return u(l.click())}),v(5,oe,2,0,"span",38)(6,de,2,0,"span",38),e(),v(7,ae,2,1,"div",39)}if(o&2){let t=f();d(4),s("disabled",t.isUploading),d(),s("ngIf",!t.isUploading),d(),s("ngIf",t.isUploading),d(),s("ngIf",t.uploadError)}}function se(o,a){if(o&1){let t=D();r(0,"div",41)(1,"div",42)(2,"span",13),i(3),e(),r(4,"input",43),b("ngModelChange",function(l){let c=p(t).$implicit;return E(c.amount,l)||(c.amount=l),u(l)}),e()()()}if(o&2){let t=a.$implicit;k("opacity-60",t.amount===0),d(3),h(t.description),d(),S("ngModel",t.amount)}}function ce(o,a){o&1&&(r(0,"li",49)(1,"span",50),i(2,"\u2022"),e(),i(3," Driver must be selected "),e())}function me(o,a){o&1&&(r(0,"li",49)(1,"span",50),i(2,"\u2022"),e(),i(3," Truck must be selected "),e())}function pe(o,a){o&1&&(r(0,"li",49)(1,"span",50),i(2,"\u2022"),e(),i(3," Proof of Delivery (PoD) document must be uploaded "),e())}function ue(o,a){if(o&1&&(r(0,"div",44)(1,"div",45)(2,"p",46),i(3,"Cannot convert to invoice:"),e(),r(4,"ul",47),v(5,ce,4,0,"li",48)(6,me,4,0,"li",48)(7,pe,4,0,"li",48),e()()()),o&2){let t=f();d(5),s("ngIf",!t.order.driver),d(),s("ngIf",!t.order.truck),d(),s("ngIf",!t.podUrl)}}var $=class o{constructor(a,t,n,l,c,m,ve){this.router=a;this.route=t;this.ordersService=n;this.driversService=l;this.trucksService=c;this.settingsService=m;this.http=ve}order=new K;podUrl=null;availableDrivers=[];availableTrucks=[];selectedDriverId="";selectedTruckId="";costTypes=[];isUploading=!1;uploadError=null;ngOnInit(){let a=this.route.snapshot.paramMap.get("id")||"";this.ordersService.getOrder(a).subscribe(t=>{this.order=t,this.podUrl=this.order?.documents?.find(n=>n.name==="PoD")?.url||null,this.order.driver&&(this.selectedDriverId=this.order.driver.id),this.order.truck&&(this.selectedTruckId=this.order.truck.id),this.settingsService.getSettings().subscribe(n=>{this.costTypes=n.driverCosts,this.costTypes.forEach(l=>{if(!this.order.driverCosts.some(c=>c.description===l)){let c=new C;c.description=l,c.amount=0,this.order.driverCosts.push(c)}})})}),this.driversService.getDrivers().subscribe(t=>{this.availableDrivers=t}),this.trucksService.getTrucks().subscribe(t=>{this.availableTrucks=t.filter(n=>n.status==="Active")})}markDelivered(){this.order&&(this.order.status="Delivered")}markInTransit(){this.order&&(this.order.status="In Transit")}cancelOrder(){this.order&&(this.order.status="Cancelled",this.router.navigate(["/dispatcher/orders"]))}unassignDriver(){this.order&&(this.order.driver=null)}unassignTruck(){this.order&&(this.order.truck=null)}onFileSelected(a){let t=a.target.files[0];if(!t)return;if(!["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)){this.uploadError="Please select a valid file (PDF, JPG, PNG, DOC, DOCX)";return}let l=5*1024*1024;if(t.size>l){this.uploadError="File size must be less than 5MB";return}this.uploadPodFile(t)}uploadPodFile(a){this.isUploading=!0,this.uploadError=null;let t=URL.createObjectURL(a);setTimeout(()=>{let n={name:"PoD",url:t,fileName:a.name,uploadDate:new Date,type:a.type};this.order.documents||(this.order.documents=[]),this.order.documents=this.order.documents.filter(l=>l.name!=="PoD"),this.order.documents.push(n),this.podUrl=t,this.isUploading=!1},1e3)}removePod(){confirm("Are you sure you want to remove the PoD document?")&&(this.order.documents&&(this.order.documents=this.order.documents.filter(a=>a.name!=="PoD")),this.podUrl=null)}createInvoice(){this.router.navigate(["/dispatcher/order-to-invoice",this.order.id])}onDriverSelect(a){let t=a.target.value;if(!t){this.order.driver=null;return}let n=this.availableDrivers.find(l=>l.id===t);n&&(this.order.driver=n)}onTruckSelect(a){let t=a.target.value;if(!t){this.order.truck=null;return}let n=this.availableTrucks.find(l=>l.id===t);n&&(this.order.truck=n)}isValidForInvoice(){return!!(this.order.driver&&this.order.truck&&this.podUrl)}static \u0275fac=function(t){return new(t||o)(x(R),x(N),x(q),x(Q),x(Y),x(Z),x(U))};static \u0275cmp=T({type:o,selectors:[["app-order-detail"]],decls:107,vars:26,consts:[["noPod",""],["fileInput",""],[1,"max-w-3xl","mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"mb-4"],["routerLink","/dispatcher/orders",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-2","text-green-900","flex","items-center","gap-2"],[1,"mb-6","flex","gap-4","text-gray-600"],[1,"bg-gray-100","px-3","py-1","rounded"],[1,"font-medium"],[1,"mb-6","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"font-semibold"],[1,"mb-6"],[1,"flex","flex-col","sm:flex-row","gap-8"],[1,"flex-1","bg-gray-50","rounded","p-4"],[1,"text-xs","text-gray-500"],[1,"mt-2"],[1,"w-full","p-2","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-3 p-3 bg-white rounded shadow-sm",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"mb-6","flex-row"],[1,"space-y-0","w-1/2"],["class","bg-gray-50 p-2 rounded transition-colors",3,"opacity-60",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],["class","w-full mb-4",4,"ngIf"],[1,"bg-red-600","hover:bg-red-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"px-6","py-2","rounded","shadow","font-semibold","transition",3,"click","disabled"],[3,"value"],[1,"mt-3","p-3","bg-white","rounded","shadow-sm"],["target","_blank",1,"text-blue-700","hover:underline","flex","items-center","gap-1","font-medium",3,"href"],[1,"ml-4","bg-red-500","hover:bg-red-600","text-white","px-3","py-1","rounded","text-sm",3,"click"],[1,"text-gray-500","italic","mb-2"],["type","file","accept",".pdf,.jpg,.jpeg,.png,.doc,.docx",1,"hidden",3,"change"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded",3,"click","disabled"],[4,"ngIf"],["class","mt-2 text-red-600 text-sm",4,"ngIf"],[1,"mt-2","text-red-600","text-sm"],[1,"bg-gray-50","p-2","rounded","transition-colors"],[1,"flex","justify-between","items-center","mb-1"],["type","number","placeholder","0.00",1,"w-36","p-1","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-red-50","border","border-red-200","rounded","p-3"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","space-y-1"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500"]],template:function(t,n){if(t&1){let l=D();r(0,"div",2)(1,"div",3)(2,"a",4)(3,"span",5),i(4,"\u2190"),e(),i(5," Go Back "),e()(),r(6,"h2",6)(7,"span"),i(8,"\u{1F4E6}"),e(),i(9," Order Details "),e(),r(10,"div",7)(11,"div",8)(12,"span",9),i(13,"Order #:"),e(),i(14),e(),r(15,"div",8)(16,"span",9),i(17,"Rate Con #:"),e(),i(18),e()(),r(19,"div",10)(20,"h3",11)(21,"span"),i(22,"\u{1F464}"),e(),i(23," Customer Information "),e(),r(24,"div",12)(25,"div")(26,"span",13),i(27,"Name:"),e(),i(28),e(),r(29,"div")(30,"span",13),i(31,"Contact:"),e(),i(32),e()()(),r(33,"div",14)(34,"h3",11)(35,"span"),i(36,"\u{1F5FA}\uFE0F"),e(),i(37," Route "),e(),r(38,"div",15)(39,"div",16)(40,"span",13),i(41,"Origin:"),e(),r(42,"div",9),i(43),e(),r(44,"div",17),i(45),e()(),r(46,"div",16)(47,"span",13),i(48,"Destination:"),e(),r(49,"div",9),i(50),e(),r(51,"div",17),i(52),e()()()(),r(53,"div",14)(54,"h3",11)(55,"span"),i(56,"\u{1F4E6}"),e(),i(57," Load Details "),e(),r(58,"div")(59,"span",13),i(60,"Description:"),e(),i(61),e()(),r(62,"div",14)(63,"h3",11)(64,"span"),i(65,"\u{1F9D1}\u200D\u2708\uFE0F"),e(),i(66," Driver & Truck "),e(),r(67,"div",15)(68,"div",16)(69,"span",13),i(70,"Driver: "),e(),r(71,"div",18)(72,"select",19),b("ngModelChange",function(m){return p(l),E(n.selectedDriverId,m)||(n.selectedDriverId=m),u(m)}),_("change",function(m){return p(l),u(n.onDriverSelect(m))}),r(73,"option",20),i(74,"Select a driver"),e(),v(75,ee,2,2,"option",21),e(),v(76,te,7,3,"div",22),e()(),r(77,"div",16)(78,"span",13),i(79,"Truck: "),e(),r(80,"div",18)(81,"select",19),b("ngModelChange",function(m){return p(l),E(n.selectedTruckId,m)||(n.selectedTruckId=m),u(m)}),_("change",function(m){return p(l),u(n.onTruckSelect(m))}),r(82,"option",20),i(83,"Select a truck"),e(),v(84,ie,2,3,"option",21),e(),v(85,re,7,3,"div",22),e()()()(),r(86,"div",14)(87,"h3",11)(88,"span"),i(89,"\u{1F4C4}"),e(),i(90," Proof of Delivery (PoD) "),e(),v(91,ne,7,1,"div",23)(92,le,8,4,"ng-template",null,0,P),e(),r(94,"div",24)(95,"h3",11)(96,"span"),i(97,"\u{1F4B2}"),e(),i(98," Driver Costs "),e(),r(99,"div",25),v(100,se,5,4,"div",26),e()(),r(101,"div",27),v(102,ue,8,3,"div",28),r(103,"button",29),_("click",function(){return p(l),u(n.cancelOrder())}),i(104," Cancel Order "),e(),r(105,"button",30),_("click",function(){return p(l),u(n.createInvoice())}),i(106," Convert To Invoice "),e()()()}if(t&2){let l=y(93);d(14),g(" ",n.order.orderNumber," "),d(4),g(" ",n.order.rateConNumber," "),d(10),g(" ",n.order.customerName,""),d(4),g(" ",n.order.customerContact,""),d(11),h(n.order.origin.street),d(2),I("",n.order.origin.city,", ",n.order.origin.state," ",n.order.origin.zip," "),d(5),h(n.order.destination.street),d(2),I("",n.order.destination.city,", ",n.order.destination.state," ",n.order.destination.zip,""),d(9),g(" ",n.order.description," "),d(11),S("ngModel",n.selectedDriverId),d(3),s("ngForOf",n.availableDrivers),d(),s("ngIf",n.order.driver),d(5),S("ngModel",n.selectedTruckId),d(3),s("ngForOf",n.availableTrucks),d(),s("ngIf",n.order.truck),d(6),s("ngIf",n.podUrl)("ngIfElse",l),d(9),s("ngForOf",n.order.driverCosts),d(2),s("ngIf",!n.isValidForInvoice()),d(3),O(n.isValidForInvoice()?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),s("disabled",!n.isValidForInvoice())}},dependencies:[M,F,L,j,X,G,J,A,B,H,W,z],encapsulation:2})};export{$ as OrderDetailComponent};
