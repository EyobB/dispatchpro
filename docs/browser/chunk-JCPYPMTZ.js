import{a as c}from"./chunk-DDEBU2FK.js";import{c as B}from"./chunk-7GTRUKFK.js";import{a as j}from"./chunk-2EMIZEML.js";import{d as M,g as L,l as $,m as U,n as F,u as Y}from"./chunk-WJZQNLUY.js";import{a as N}from"./chunk-A3LUHI23.js";import"./chunk-IOPBYQJQ.js";import"./chunk-LFAOHVAW.js";import"./chunk-XPCCV2FB.js";import{e as P}from"./chunk-V26HN3KH.js";import"./chunk-5UMXG57Q.js";import{k as A,l as R,o as k}from"./chunk-O5HBUBIU.js";import{$ as u,Ab as O,Cb as C,Db as h,Eb as w,Fb as I,Ka as s,Nb as E,Pa as S,Pb as b,Rb as V,Ua as D,Za as g,_ as m,fb as x,jb as r,kb as i,lb as y,ob as f,rb as v,sb as p,xb as T,yb as n,zb as _}from"./chunk-ITTAAY47.js";function K(d,t){d&1&&(r(0,"div",9)(1,"div",10),y(2,"div",11),r(3,"p",12),n(4,"Loading orders\u2026"),i()()())}function W(d,t){d&1&&(r(0,"div",13),n(1," No current orders. "),i())}function Z(d,t){if(d&1&&(r(0,"option",33),n(1),i()),d&2){let e=t.$implicit;x("value",e),s(),_(e)}}function G(d,t){if(d&1){let e=f();r(0,"span",30)(1,"select",31),I("ngModelChange",function(o){m(e);let l=p().$implicit;return w(l.status,o)||(l.status=o),u(o)}),v("change",function(){m(e);let o=p().$implicit,l=p();return u(l.updateOrderStatus(o))}),g(2,Z,2,2,"option",32),i()()}if(d&2){let e=p().$implicit,a=p();s(),h("ngModel",e.status),s(),x("ngForOf",a.getNextStatus(e))}}function z(d,t){if(d&1&&(r(0,"span",30),n(1),i()),d&2){let e=p().$implicit;s(),_(e.status)}}function q(d,t){if(d&1){let e=f();r(0,"button",34),v("click",function(){m(e);let o=p().$implicit,l=p();return u(l.uploadPoD(o))}),n(1," Upload PoD "),i()}}function J(d,t){if(d&1){let e=f();r(0,"button",34),v("click",function(){m(e);let o=p().$implicit,l=p();return u(l.completeOrder(o))}),n(1," Complete Order "),i()}}function Q(d,t){if(d&1){let e=f();r(0,"div",14)(1,"div",15)(2,"div",16),n(3),i(),g(4,G,3,2,"span",17)(5,z,2,1,"ng-template",null,0,V),i(),r(7,"div",18)(8,"div")(9,"div",19)(10,"span",20),n(11,"Pickup:"),i(),r(12,"span",21),n(13),E(14,"date"),i()(),r(15,"div",22)(16,"div",23)(17,"div"),n(18),i(),r(19,"div"),n(20),i()(),r(21,"button",24),v("click",function(){let o=m(e).$implicit,l=p();return u(l.copyOriginAddress(o))}),n(22," \u{1F4CB} "),i()()(),r(23,"div")(24,"div",19)(25,"span",20),n(26,"Dropoff:"),i(),r(27,"span",21),n(28),E(29,"date"),i()(),r(30,"div",22)(31,"div",23)(32,"div"),n(33),i(),r(34,"div"),n(35),i()(),r(36,"button",24),v("click",function(){let o=m(e).$implicit,l=p();return u(l.copyDestinationAddress(o))}),n(37," \u{1F4CB} "),i()()()(),r(38,"div",25)(39,"div")(40,"span",21),n(41,"Order #: "),i(),r(42,"span",26),n(43),i()()(),r(44,"div",27)(45,"button",28),v("click",function(){let o=m(e).$implicit,l=p();return u(l.checkIn(o))}),n(46," Check In "),i(),r(47,"button",28),v("click",function(){let o=m(e).$implicit,l=p();return u(l.viewOrder(o))}),n(48," View Details "),i(),g(49,q,2,0,"button",29)(50,J,2,0,"button",29),i()()}if(d&2){let e=t.$implicit,a=T(6),o=p();s(3),_(e.loadNumber),s(),x("ngIf",!o.isPartiallyDelivered(e))("ngIfElse",a),s(9),_(b(14,16,e.pickupDateAndTime,"EEE, MMM dd HH:mm")),s(5),_(e.originStreetAddress),s(2),C("",e.originCity,", ",e.originState," ",e.originZipcode,""),s(8),_(b(29,19,e.dropOffDateAndTime,"EEE, MMM dd HH:mm")),s(5),_(e.destinationStreetAddress),s(2),C("",e.destinationCity,", ",e.destinationState," ",e.destinationZipcode,""),s(8),_(e.orderNumber),s(6),x("ngIf",o.isReadyToUploadPoD(e)),s(),x("ngIf",o.isReadyToComplete(e))}}function X(d,t){d&1&&(r(0,"div",13),n(1," No upcoming orders. "),i())}function ee(d,t){if(d&1&&(r(0,"option",33),n(1),i()),d&2){let e=t.$implicit;x("value",e),s(),_(e)}}function te(d,t){if(d&1){let e=f();r(0,"div",35)(1,"div",15)(2,"div",16),n(3),i(),r(4,"span",30)(5,"select",31),I("ngModelChange",function(o){let l=m(e).$implicit;return w(l.status,o)||(l.status=o),u(o)}),v("change",function(){let o=m(e).$implicit,l=p();return u(l.updateOrderStatus(o))}),g(6,ee,2,2,"option",32),i()()(),r(7,"div",36)(8,"div",37)(9,"div",38)(10,"span",20),n(11,"Pickup:"),i(),r(12,"span",21),n(13),E(14,"date"),i()(),r(15,"div",39)(16,"div")(17,"div"),n(18),i(),r(19,"div"),n(20),i()(),r(21,"div")(22,"button",40),v("click",function(){let o=m(e).$implicit,l=p();return u(l.copyOriginAddress(o))}),n(23," \u{1F4CB} "),i()()()(),r(24,"div")(25,"div",38)(26,"span",20),n(27,"Dropoff:"),i(),r(28,"span",21),n(29),E(30,"date"),i()(),r(31,"div",39)(32,"div")(33,"div"),n(34),i(),r(35,"div"),n(36),i()(),r(37,"button",40),v("click",function(){let o=m(e).$implicit,l=p();return u(l.copyDestinationAddress(o))}),n(38," \u{1F4CB} "),i()()(),r(39,"div",41)(40,"div",42)(41,"span",21),n(42,"Order #:"),i(),r(43,"span",21),n(44),i()(),r(45,"button",34),v("click",function(){let o=m(e).$implicit,l=p();return u(l.viewOrder(o))}),n(46," View Details "),i()()()()}if(d&2){let e=t.$implicit,a=p();s(3),_(e.loadNumber),s(2),h("ngModel",e.status),s(),x("ngForOf",a.getNextStatus(e)),s(7),O(" ",b(14,14,e.pickupDateAndTime,"EEE, MMM dd HH:mm"),""),s(5),_(e.originStreetAddress),s(2),C("",e.originCity,", ",e.originState," ",e.originZipcode,""),s(9),O(" ",b(30,17,e.dropOffDateAndTime,"EEE, MMM dd HH:mm"),""),s(5),_(e.destinationStreetAddress),s(2),C("",e.destinationCity,", ",e.destinationState," ",e.destinationZipcode,""),s(8),_(e.orderNumber)}}var H=class d{constructor(t,e,a){this.router=t;this.ordersService=e;this.toastService=a}orders=[];loading=!1;currentOrders=[];upcomingOrders=[];ngOnInit(){this.loadOrders()}getNextStatus(t){switch(t.status){case c.ASSIGNED:return[t.status,c.EN_ROUTE_TO_PICKUP,c.ARRIVED_AT_PICKUP];case c.EN_ROUTE_TO_PICKUP:return[t.status,c.ASSIGNED,c.ARRIVED_AT_PICKUP];case c.ARRIVED_AT_PICKUP:return[t.status,c.EN_ROUTE_TO_DELIVERY];case c.EN_ROUTE_TO_DELIVERY:return[t.status,c.ARRIVED_AT_DELIVERY];case c.ARRIVED_AT_DELIVERY:return[t.status,c.EN_ROUTE_TO_DELIVERY];default:return[t.status]}}loadOrders(){this.loading=!0,this.ordersService.getDriverOrders().subscribe(t=>{this.orders=t,this.splitOrders(),this.loading=!1},t=>{console.error("Error loading orders:",t),this.toastService.showError("Failed to load orders. Try reloading the app.",5e3),this.loading=!1})}splitOrders(){this.currentOrders=this.orders.filter(t=>t.status===c.EN_ROUTE_TO_PICKUP||t.status===c.ARRIVED_AT_PICKUP||t.status===c.EN_ROUTE_TO_DELIVERY||t.status===c.ARRIVED_AT_DELIVERY||t.status===c.PARTIALLY_DELIVERED),this.upcomingOrders=this.orders.filter(t=>t.status===c.ASSIGNED)}viewOrder(t){this.ordersService.setCurrentOrder(t),this.router.navigate(["/driver/order-detail",t.id])}isReadyToUploadPoD(t){return t.status===c.ARRIVED_AT_DELIVERY||t.status===c.PARTIALLY_DELIVERED}uploadPoD(t){this.ordersService.setCurrentOrder(t),this.router.navigate(["/driver/upload-pod",t.id])}completeOrder(t){this.ordersService.setCurrentOrder(t),this.router.navigate(["/driver/complete-order",t.id])}copyOriginAddress(t){let e=`${t.originStreetAddress}, ${t.originCity}, ${t.originState} ${t.originZipcode}`;navigator.clipboard.writeText(e),this.toastService.showSuccess("Origin address copied to clipboard",2e3)}copyDestinationAddress(t){let e=`${t.destinationStreetAddress}, ${t.destinationCity}, ${t.destinationState} ${t.destinationZipcode}`;navigator.clipboard.writeText(e),this.toastService.showSuccess("Destination address copied to clipboard",2e3)}checkIn(t){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let a={lat:e.coords.latitude,lon:e.coords.longitude};this.ordersService.driverCheckIn(t.id,a).subscribe(()=>{this.toastService.showSuccess("Check-in successful.",2e3)})},e=>{console.warn("Geolocation error:",e),this.toastService.showError("Check-in failed.",5e3)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4}):this.toastService.showError("Check-in failed.",5e3)}updateOrderStatus(t){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let a={lat:e.coords.latitude,lon:e.coords.longitude};this.ordersService.updateOrderStatus(t.id,t.status,a).subscribe(()=>{this.loadOrders(),this.toastService.showSuccess("Status updated.",2e3)})},e=>{console.warn("Geolocation error:",e),this.ordersService.updateOrderStatus(t.id,t.status).subscribe(()=>{this.loadOrders(),this.toastService.showSuccess("Status updated.",2e3)})},{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4}):this.ordersService.updateOrderStatus(t.id,t.status).subscribe(()=>{this.loadOrders(),this.toastService.showSuccess("Status updated.",2e3)})}isPartiallyDelivered(t){return t.status===c.PARTIALLY_DELIVERED}isReadyToComplete(t){return t.status===c.PARTIALLY_DELIVERED&&t.documents.some(e=>e.documentType==B.POD)}static \u0275fac=function(e){return new(e||d)(S(P),S(j),S(N))};static \u0275cmp=D({type:d,selectors:[["app-driver-orders"]],decls:16,vars:5,consts:[["partiallyDelivered",""],["class","fixed inset-0 z-50 grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"max-w-md","mx-auto","pt-0"],[1,"text-2xl","font-bold","text-green-900","mb-4","flex","items-center","gap-2"],[1,"mb-6"],["class","text-gray-500 text-center py-4 bg-gray-50 rounded-lg",4,"ngIf"],["class","mb-3 rounded-xl shadow border border-green-200 bg-green-50 p-2 flex flex-col gap-2",4,"ngFor","ngForOf"],[1,"text-lg","font-semibold","text-blue-800","mb-3","flex","items-center","gap-2"],["class","mb-3 rounded-xl shadow border border-blue-200 bg-blue-50 p-2 flex flex-col gap-2",4,"ngFor","ngForOf"],[1,"fixed","inset-0","z-50","grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"],[1,"text-gray-500","text-center","py-4","bg-gray-50","rounded-lg"],[1,"mb-3","rounded-xl","shadow","border","border-green-200","bg-green-50","p-2","flex","flex-col","gap-2"],[1,"flex","justify-between","items-center"],[1,"font-semibold","text-green-900"],["class","px-2 py-1 rounded text-s font-semibold",4,"ngIf","ngIfElse"],[1,"text-sm","text-gray-700","space-y-3"],[1,"flex","justify-between","items-center","mb-1"],[1,"font-semibold"],[1,"text-xs","text-gray-500"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"text-blue-600","hover:text-blue-800","p-1","ml-2",3,"click"],[1,"flex","justify-between","items-center","pt-2","border-t","border-green-200"],[1,"text-xs","font-medium"],[1,"flex","flex-row","justify-end","mt-2","gap-1"],[1,"bg-blue-600","hover:bg-blue-700","text-white","p-3","rounded","text-s","font-semibold","transition",3,"click"],["class","bg-green-600 hover:bg-green-700 text-white p-3 rounded text-s font-semibold transition",3,"click",4,"ngIf"],[1,"px-2","py-1","rounded","text-s","font-semibold"],[1,"bg-transparent","border-none","text-right","font-semibold","cursor-pointer","outline-none",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"bg-green-600","hover:bg-green-700","text-white","p-3","rounded","text-s","font-semibold","transition",3,"click"],[1,"mb-3","rounded-xl","shadow","border","border-blue-200","bg-blue-50","p-2","flex","flex-col","gap-2"],[1,"text-sm","text-gray-700"],[1,"mb-2"],[1,"flex","flex-row","justify-between","gap-2"],[1,"ml-2","flex","flex-row","items-center","gap-2"],[1,"text-blue-600","hover:text-blue-800","p-1",3,"click"],[1,"flex","flex-row","items-center","justify-between","mt-2","gap-1"],[1,"flex","flex-col"]],template:function(e,a){e&1&&(g(0,K,5,0,"div",1),r(1,"div",2)(2,"h2",3)(3,"span"),n(4,"\u{1F69B}"),i(),n(5," Current Orders "),i(),r(6,"div",4),g(7,W,2,0,"div",5)(8,Q,51,22,"div",6),i(),r(9,"div")(10,"h3",7)(11,"span"),n(12,"\u{1F4C5}"),i(),n(13," Upcoming Orders "),i(),g(14,X,2,0,"div",5)(15,te,47,20,"div",8),i()()),e&2&&(x("ngIf",a.loading),s(7),x("ngIf",a.currentOrders.length===0),s(),x("ngForOf",a.currentOrders),s(6),x("ngIf",a.upcomingOrders.length===0),s(),x("ngForOf",a.upcomingOrders))},dependencies:[A,R,k,Y,U,F,$,M,L],encapsulation:2})};export{H as CurrentOrdersComponent};
