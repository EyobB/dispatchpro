import{b as ee}from"./chunk-DDEBU2FK.js";import{a as te}from"./chunk-D7DOKIYQ.js";import{a as z}from"./chunk-TQHTARCV.js";import{a as $}from"./chunk-SMTY5PGD.js";import"./chunk-7GTRUKFK.js";import{a as J,b as G,d as H,g as K,l as Q,m as X,n as Y,u as Z}from"./chunk-VDT5TDP2.js";import"./chunk-7LAHPUI6.js";import{a as q}from"./chunk-A3LUHI23.js";import"./chunk-25LA7BX7.js";import"./chunk-ZTGCRYCC.js";import"./chunk-XPCCV2FB.js";import{c as R}from"./chunk-KM6ROI6B.js";import"./chunk-2DXK6GBI.js";import{l as W,m as j,p as U,r as L}from"./chunk-TKJYB7RJ.js";import{$ as p,Ab as g,Db as w,Eb as _,Fb as C,Hb as D,Ka as s,Nb as y,Pa as v,Pb as B,Qb as A,Rb as P,Ua as M,Za as f,_ as m,fb as c,jb as t,kb as e,lb as N,mb as T,nb as F,ob as I,rb as h,sb as E,x as k,xb as O,yb as n,zb as x}from"./chunk-ITTAAY47.js";var b=class{street;city;state;zip;constructor(){this.street="",this.city="",this.state="",this.zip=""}};var S=class{id;invoiceNumber;loadNumber;podNumber;brokerName;brokerEmail;invoiceDate;dueDate;totalCost;status;orderId;terms;paymentInstructions;notes;lineItems;factoring;service;loadDetails;pickupDate;deliveryDate;origin;destination;documents;constructor(){this.id="",this.invoiceNumber="",this.loadNumber="",this.podNumber="",this.brokerName="",this.brokerEmail="",this.invoiceDate="",this.dueDate="",this.totalCost=0,this.status="",this.orderId="",this.terms="",this.paymentInstructions="",this.notes="",this.service="",this.loadDetails="",this.pickupDate="",this.deliveryDate="",this.origin=new b,this.destination=new b,this.lineItems=[],this.documents=[]}};var V=()=>({standalone:!0});function ne(a,r){a&1&&(t(0,"div",33)(1,"div",34),N(2,"div",35),t(3,"p",36),n(4,"Loading invoice..."),e()()())}function re(a,r){if(a&1){let o=I();t(0,"li")(1,"a",39),h("click",function(){let d=m(o).$implicit,u=E(2);return p(u.viewDocument(d))}),n(2),e()()}if(a&2){let o=r.$implicit;s(2),g(" ",o.documentType,"")}}function oe(a,r){if(a&1&&(T(0),t(1,"ul",37),f(2,re,3,1,"li",38),e(),F()),a&2){let o=E();s(2),c("ngForOf",o.invoice.documents)}}function ae(a,r){a&1&&(t(0,"div",40),n(1,"No documents available."),e())}function se(a,r){a&1&&(t(0,"span"),n(1,"\u{1F4BE} Update Invoice"),e())}function le(a,r){a&1&&(t(0,"span"),n(1,"\u23F3 Updating..."),e())}var ie=class a{constructor(r,o,i,d){this.carrierService=r;this.invoiceService=o;this.route=i;this.toastService=d}loading=!1;carrier=null;invoice=new S;order=new ee;showDocumentViewer=!1;currentDocument=null;saving=!1;ensureInvoiceDefaults(){this.invoice&&(this.invoice.status==null&&(this.invoice.status="New"),this.invoice.factoring==null&&(this.invoice.factoring=!1),this.invoice.notes==null&&(this.invoice.notes=""))}ngOnInit(){let r=this.route.snapshot.paramMap.get("id");if(!r)throw new Error("Invoice ID is required");this.loading=!0,k({carrier:this.carrierService.getCarrier(),invoice:this.invoiceService.getCarrierInvoice(r)}).subscribe(({carrier:o,invoice:i})=>{this.carrier=o,this.invoice=i,this.ensureInvoiceDefaults(),this.loading=!1},o=>{this.loading=!1,console.error("Error loading invoice details:",o),this.toastService.showError("Failed to load invoice details.")})}get subtotal(){return this.invoice.lineItems?.reduce((r,o)=>r+o.amount,0)}get grandTotal(){return this.subtotal}sendToBroker(){alert("Invoice sent to broker!")}viewDocument(r){this.currentDocument=r,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=null}onDownloadError(r){console.error("Download failed:",r),this.toastService.showError("Failed to download document")}updateInvoice(){if(this.saving)return;this.saving=!0;let r={status:this.invoice.status,notes:this.invoice.notes,factoring:this.invoice.factoring};this.invoiceService.updateCarrierInvoiceStatus(this.invoice.id,r).subscribe(()=>{this.toastService.showSuccess("Invoice updated successfully"),this.saving=!1},o=>{console.error("Failed to save invoice",o),this.toastService.showError("Failed to update invoice"),this.saving=!1})}static \u0275fac=function(o){return new(o||a)(v(z),v(te),v(R),v(q))};static \u0275cmp=M({type:a,selectors:[["app-invoice-detail"]],decls:82,vars:32,consts:[["noDocs",""],["class","fixed inset-0 z-50 grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"mx-auto","max-w-4xl","p-4","bg-white","rounded-2xl","shadow-2xl","border","border-green-100","print:shadow-none","print:border-0","print:p-0"],[1,"flex","items-center","justify-between","gap-4","mb-3"],[1,"text-xl","font-extrabold","text-green-900","tracking-tight","flex","items-center","gap-2"],[1,"hidden","sm:inline-flex","items-center","rounded-full","bg-green-50","text-green-800","px-3","py-1","text-xs","font-medium","border","border-green-100"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-1"],[1,"rounded-lg","border","border-green-100","bg-green-50/40","p-1"],[1,"text-[11px]","font-semibold","uppercase","tracking-wide","text-green-700"],[1,"mt-1","text-base","text-gray-900"],[1,"mt-1","text-xl","font-semibold","text-green-700"],[1,"mt-1","text-gray-900"],[1,"mt-5","border-t","border-green-200","pt-4"],[1,"font-semibold","text-base","text-green-900","mb-2.5","flex","items-center","gap-2"],[1,"mt-1","w-full","border","border-green-200","rounded","px-1.5","py-0.5","focus:outline-none","focus:ring-2","focus:ring-green-400",3,"ngModelChange","ngModel","ngModelOptions"],["value","New"],["value","Sent"],["value","Paid"],["value","Void"],[1,"rounded-lg","border","border-green-100","bg-green-50/40","p-1","flex","items-center"],[1,"inline-flex","items-center","gap-2"],["type","checkbox",1,"h-3","w-3","text-green-600","border-green-300","rounded",3,"ngModelChange","ngModel","ngModelOptions"],[1,"font-medium","text-gray-900"],[1,"rounded-lg","border","border-green-100","bg-green-50/40","p-1","sm:col-span-2","lg:col-span-3"],["rows","3","placeholder","Add notes...",1,"mt-1","w-full","border","border-green-200","rounded","px-2","py-0.5","focus:outline-none","focus:ring-2","focus:ring-green-400",3,"ngModelChange","ngModel","ngModelOptions"],[4,"ngIf","ngIfElse"],[1,"mt-5","flex","flex-col","sm:flex-row","items-stretch","sm:items-center","justify-between","gap-2","print:hidden"],[1,"sm:hidden","inline-flex","items-center","rounded-full","bg-green-50","text-green-800","px-3","py-1","text-xs","font-medium","border","border-green-100"],[1,"flex","gap-2"],[1,"bg-green-600","hover:bg-green-700","text-white","px-3","py-1","rounded","shadow","font-semibold","transition","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[4,"ngIf"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-3","py-1","rounded","shadow","font-semibold","transition",3,"click"],[3,"close","downloadError","document","isVisible"],[1,"fixed","inset-0","z-50","grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"flex","items-center","justify-between","gap-3","rounded-lg","border","border-green-100","bg-white","px-2","py-1","text-blue-700","hover:bg-blue-50/40","hover:border-blue-200","transition","break-all",3,"click"],[1,"text-sm","text-gray-600","italic"]],template:function(o,i){if(o&1){let d=I();f(0,ne,5,0,"div",1),t(1,"div",2)(2,"div",3)(3,"h2",4)(4,"span"),n(5,"\u{1F9FE}"),e(),n(6," Carrier Invoice "),e(),t(7,"span",5),n(8),e()(),t(9,"dl",6)(10,"div",7)(11,"dt",8),n(12,"Invoice #"),e(),t(13,"dd",9),n(14),e()(),t(15,"div",7)(16,"dt",8),n(17,"Load #"),e(),t(18,"dd",9),n(19),e()(),t(20,"div",7)(21,"dt",8),n(22,"PoD #"),e(),t(23,"dd",9),n(24),e()(),t(25,"div",7)(26,"dt",8),n(27,"Total Cost"),e(),t(28,"dd",10),n(29),y(30,"currency"),e()(),t(31,"div",7)(32,"dt",8),n(33,"Invoice Date"),e(),t(34,"dd",11),n(35),y(36,"date"),e()()(),t(37,"div",12)(38,"h3",13)(39,"span"),n(40,"\u{1F6E0}\uFE0F"),e(),n(41," Invoice Settings "),e(),t(42,"div",6)(43,"div",7)(44,"label",8),n(45,"Status"),e(),t(46,"select",14),C("ngModelChange",function(l){return m(d),_(i.invoice.status,l)||(i.invoice.status=l),p(l)}),t(47,"option",15),n(48,"New"),e(),t(49,"option",16),n(50,"Sent"),e(),t(51,"option",17),n(52,"Paid"),e(),t(53,"option",18),n(54,"Void"),e()()(),t(55,"div",19)(56,"label",20)(57,"input",21),C("ngModelChange",function(l){return m(d),_(i.invoice.factoring,l)||(i.invoice.factoring=l),p(l)}),e(),t(58,"span",22),n(59,"Factoring"),e()()(),t(60,"div",23)(61,"label",8),n(62,"Remark"),e(),t(63,"textarea",24),C("ngModelChange",function(l){return m(d),_(i.invoice.notes,l)||(i.invoice.notes=l),p(l)}),e()()()(),t(64,"div",12)(65,"h3",13)(66,"span"),n(67,"\u{1F4CE}"),e(),n(68," Documents "),e(),f(69,oe,3,1,"ng-container",25)(70,ae,2,0,"ng-template",null,0,P),e(),t(72,"div",26)(73,"span",27),n(74),e(),t(75,"div",28)(76,"button",29),h("click",function(){return m(d),p(i.updateInvoice())}),f(77,se,2,0,"span",30)(78,le,2,0,"span",30),e(),t(79,"button",31),h("click",function(){return m(d),p(i.sendToBroker())}),n(80," \u{1F4E4} Send to Broker "),e()()()(),t(81,"app-document-viewer",32),h("close",function(){return m(d),p(i.closeDocumentViewer())})("downloadError",function(l){return m(d),p(i.onDownloadError(l))}),e()}if(o&2){let d=O(71);c("ngIf",i.loading),s(8),g(" Broker: ",i.invoice.brokerEmail||"\u2014"," "),s(6),x(i.invoice.invoiceNumber||"\u2014"),s(5),x(i.invoice.loadNumber||"\u2014"),s(5),x(i.invoice.podNumber||"\u2014"),s(5),g(" ",A(30,21,i.invoice.totalCost,"USD","symbol","1.2-2")," "),s(6),g(" ",B(36,26,i.invoice.invoiceDate,"mediumDate")," "),s(11),w("ngModel",i.invoice.status),c("ngModelOptions",D(29,V)),s(11),w("ngModel",i.invoice.factoring),c("ngModelOptions",D(30,V)),s(6),w("ngModel",i.invoice.notes),c("ngModelOptions",D(31,V)),s(6),c("ngIf",i.invoice.documents==null?null:i.invoice.documents.length)("ngIfElse",d),s(5),g(" Broker: ",i.invoice.brokerEmail||"\u2014"," "),s(2),c("disabled",i.saving||i.loading),s(),c("ngIf",!i.saving),s(),c("ngIf",i.saving),s(3),c("document",i.currentDocument)("isVisible",i.showDocumentViewer)}},dependencies:[j,W,Z,X,Y,G,J,Q,H,K,U,L,$],encapsulation:2})};export{ie as CarrierInvoiceDetailComponent};
