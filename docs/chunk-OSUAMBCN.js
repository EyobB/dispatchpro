import{a as j}from"./chunk-EXVUTR7V.js";import{a as S}from"./chunk-7GTRUKFK.js";import{a as w,b as N}from"./chunk-MHLDLTIM.js";import"./chunk-CQAPK5K2.js";import{a as F}from"./chunk-A3LUHI23.js";import"./chunk-IOPBYQJQ.js";import"./chunk-LFAOHVAW.js";import"./chunk-XPCCV2FB.js";import{e as k}from"./chunk-V26HN3KH.js";import"./chunk-5UMXG57Q.js";import{k as I,l as T}from"./chunk-O5HBUBIU.js";import{$ as p,Ab as v,Ka as m,Pa as x,Rb as C,Ua as R,Za as f,_ as d,fb as u,hb as y,jb as i,kb as n,lb as b,mb as V,nb as D,ob as g,rb as _,sb as c,xb as h,yb as o,zb as E}from"./chunk-ITTAAY47.js";function L(r,t){r&1&&(i(0,"div",10)(1,"div",11),b(2,"div",12),i(3,"p",13),o(4,"Loading RateCon emails"),n()()())}function M(r,t){if(r&1){let e=g();i(0,"li",15),_("click",function(){let a=d(e).$implicit,s=c(2);return p(s.selectEmail(a))}),i(1,"div",16),o(2),n(),i(3,"div",17),o(4),n(),i(5,"div",18),o(6),n()()}if(r&2){let e=t.$implicit,l=c(2);y("bg-green-100",l.selectedEmail===e),m(2),E(e.sender),m(2),E(e.subject),m(2),E(e.date)}}function P(r,t){if(r&1&&(i(0,"ul"),f(1,M,7,5,"li",14),n()),r&2){let e=c();m(),u("ngForOf",e.emails)}}function A(r,t){r&1&&(i(0,"p",19),o(1,"No RateCon emails available."),n())}function q(r,t){if(r&1){let e=g();i(0,"li",31)(1,"a",32),_("click",function(){let a=d(e).$implicit,s=c(2);return p(s.viewDocument(a))}),o(2),n(),i(3,"button",33),_("click",function(){let a=d(e).$implicit,s=c(2);return p(s.viewDocument(a))}),o(4,"View"),n()()}if(r&2){let e=t.$implicit;m(2),v(" ",e.fileName,"")}}function z(r,t){if(r&1){let e=g();V(0),i(1,"h3",20),o(2),n(),i(3,"p",21),o(4),n(),i(5,"p",22),o(6),n(),i(7,"div",23)(8,"textarea",24),o(9),n()(),i(10,"div",25)(11,"h4",26),o(12,"Attachments"),n(),i(13,"ul"),f(14,q,5,1,"li",27),n()(),i(15,"div",28)(16,"button",29),_("click",function(){d(e);let a=c();return p(a.confirmRateCon())}),o(17,"Confirm as RateCon"),n(),i(18,"button",30),_("click",function(){d(e);let a=c();return p(a.dismissEmail())}),o(19,"Dismiss"),n()(),D()}if(r&2){let e=c();m(2),E(e.selectedEmail.subject),m(2),v("From: ",e.selectedEmail.sender,""),m(2),v("Received: ",e.selectedEmail.date,""),m(3),E(e.selectedEmail.body),m(5),u("ngForOf",e.selectedEmail.documents)}}function B(r,t){r&1&&(i(0,"p",34),o(1,"Select an email to review details."),n())}var O=class r{constructor(t,e,l){this.rateConEmailService=t;this.router=e;this.toastService=l}loading=!1;emails=[];selectedEmail=new w;currentDocument=new S;showDocumentViewer=!1;ngOnInit(){this.loadEmails()}loadEmails(){this.loading=!0,this.rateConEmailService.getRateConEmails().subscribe(t=>{this.emails=t,this.selectFirstEmail(),this.loading=!1},t=>{console.error("Error loading RateCon emails:",t),this.toastService.showError("Failed to load RateCon emails. Try reloading the app.",5e3),this.loading=!1})}selectEmail(t){this.selectedEmail=t}confirmRateCon(){this.router.navigate(["dispatcher/ratecon-from-email/",this.selectedEmail.id])}dismissEmail(){this.rateConEmailService.deleteEmail(this.selectedEmail.id).subscribe(()=>{this.removeEmailFromList(),this.toastService.showSuccess("Email dismissed successfully")})}removeEmailFromList(){this.emails=this.emails.filter(t=>t!==this.selectedEmail),this.selectedEmail=new w,this.selectFirstEmail()}selectFirstEmail(){this.emails.length>0?this.selectedEmail=this.emails[0]:this.selectedEmail=new w}viewDocument(t){this.currentDocument=t,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new S}onDownloadError(t){console.error("Download failed:",t),this.toastService.showError("Failed to download document")}static \u0275fac=function(e){return new(e||r)(x(N),x(k),x(F))};static \u0275cmp=R({type:r,selectors:[["app-ratecon-emails"]],decls:14,vars:7,consts:[["noEmails",""],["noSelection",""],["class","grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"flex","h-screen","bg-gray-50"],[1,"w-1/3","border-r","border-gray-300","p-4","overflow-y-auto"],[1,"text-xl","font-semibold","mb-4"],["type","text","placeholder","Search...",1,"w-full","mb-3","p-2","border","rounded"],[4,"ngIf","ngIfElse"],[1,"w-2/3","p-4"],[3,"close","downloadError","document","isVisible"],[1,"grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"],["class","p-2 mb-2 rounded hover:bg-green-50 cursor-pointer",3,"bg-green-100","click",4,"ngFor","ngForOf"],[1,"p-2","mb-2","rounded","hover:bg-green-50","cursor-pointer",3,"click"],[1,"font-medium"],[1,"text-sm","text-gray-600"],[1,"text-xs","text-gray-400"],[1,"text-gray-500"],[1,"text-lg","font-semibold","mb-2"],[1,"text-sm","text-gray-600","mb-1"],[1,"text-sm","text-gray-600","mb-4"],[1,"border","p-3","rounded","mb-4","bg-white"],["rows","10",1,"text-gray-700","w-full"],[1,"mb-4"],[1,"font-medium","mb-2"],["class","flex justify-between bg-gray-100 p-2 mb-1 rounded",4,"ngFor","ngForOf"],[1,"flex","gap-3"],[1,"bg-green-600","text-white","px-4","py-2","rounded","hover:bg-green-700",3,"click"],[1,"bg-red-500","text-white","px-4","py-2","rounded","hover:bg-red-600",3,"click"],[1,"flex","justify-between","bg-gray-100","p-2","mb-1","rounded"],["href","javascript:void(0)",1,"text-blue-500","underline","cursor-pointer",3,"click"],[1,"text-blue-600","hover:underline",3,"click"],[1,"text-gray-400"]],template:function(e,l){if(e&1){let a=g();f(0,L,5,0,"div",2),i(1,"div",3)(2,"div",4)(3,"h2",5),o(4,"RateCon Emails"),n(),b(5,"input",6),f(6,P,2,1,"ul",7)(7,A,2,0,"ng-template",null,0,C),n(),i(9,"div",8),f(10,z,20,5,"ng-container",7)(11,B,2,0,"ng-template",null,1,C),n()(),i(13,"app-document-viewer",9),_("close",function(){return d(a),p(l.closeDocumentViewer())})("downloadError",function($){return d(a),p(l.onDownloadError($))}),n()}if(e&2){let a=h(8),s=h(12);u("ngIf",l.loading),m(6),u("ngIf",l.emails.length>0)("ngIfElse",a),m(4),u("ngIf",l.selectedEmail.id)("ngIfElse",s),m(3),u("document",l.currentDocument)("isVisible",l.showDocumentViewer)}},dependencies:[T,I,j],encapsulation:2})};export{O as RateconEmailsComponent};
