import{a as _}from"./chunk-MSIQXZHU.js";import{a as U}from"./chunk-4CWGDVG7.js";import{a as f,b as G,c as H}from"./chunk-DDEBU2FK.js";import{a as W}from"./chunk-65LLF5LD.js";import{b as B,d as j,g as L,i as F,p as N,u as P}from"./chunk-VDT5TDP2.js";import{a as V}from"./chunk-A3LUHI23.js";import"./chunk-25LA7BX7.js";import"./chunk-ZTGCRYCC.js";import"./chunk-XPCCV2FB.js";import{c as D,e as R}from"./chunk-KM6ROI6B.js";import"./chunk-2DXK6GBI.js";import{l as I,m as A,s as k}from"./chunk-TKJYB7RJ.js";import{$ as T,Db as b,Eb as y,Fb as C,Ka as s,Pa as h,Ua as O,Za as v,_ as E,aa as c,ba as g,fb as m,jb as e,kb as t,lb as p,ob as M,rb as S,sb as x,x as w,yb as a,zb as u}from"./chunk-ITTAAY47.js";function Y(o,i){if(o&1){let n=M();e(0,"div",38)(1,"label",39),a(2),t(),e(3,"input",40),C("ngModelChange",function(d){let l=E(n).$implicit;return y(l.amount,d)||(l.amount=d),T(d)}),t()()}if(o&2){let n=i.$implicit;s(2),u(n.description),s(),b("ngModel",n.amount)}}function Z(o,i){if(o&1&&(e(0,"div",41)(1,"div",42)(2,"span",43),a(3,"Total Additional Costs:"),t(),e(4,"span",44),a(5),t()()()),o&2){let n=x();s(5),u(n.formatCurrency(n.getTotalAdditionalCosts()))}}function q(o,i){o&1&&(e(0,"div",45),c(),e(1,"svg",46),p(2,"path",3),t(),g(),e(3,"p",47),a(4,"No additional costs added"),t(),e(5,"p",48),a(6,"If you had no extra expenses, you can proceed to complete the order"),t()())}function J(o,i){if(o&1&&(e(0,"div",51)(1,"span",52),a(2,"Additional Costs"),t(),e(3,"span",53),a(4),t()()),o&2){let n=x(2);s(4),u(n.formatCurrency(n.getTotalAdditionalCosts()))}}function K(o,i){if(o&1&&(e(0,"div",6)(1,"h2",49),a(2,"Order Summary"),t(),e(3,"div",50)(4,"div",51)(5,"span",52),a(6,"Base Rate"),t(),e(7,"span",53),a(8),t()(),v(9,J,5,1,"div",54),p(10,"hr",55),e(11,"div",56)(12,"span",57),a(13,"Total Amount"),t(),e(14,"span",58),a(15),t()()()()),o&2){let n=x();s(8),u(n.formatCurrency(n.order.rate)),s(),m("ngIf",n.getTotalAdditionalCosts()>0),s(6),u(n.formatCurrency(n.getTotalOrderValue()))}}function Q(o,i){if(o&1&&(e(0,"div",59)(1,"div",60),c(),e(2,"svg",61),p(3,"path",62),t(),g(),e(4,"p",63),a(5),t()()()),o&2){let n=x();s(5),u(n.errorMessage)}}function X(o,i){o&1&&(e(0,"div",64)(1,"div",60),c(),e(2,"svg",65),p(3,"path",3),t(),g(),e(4,"p",66),a(5,"Order completed successfully! Payment has been processed."),t()()())}function ee(o,i){o&1&&(c(),e(0,"svg",67),p(1,"path",32),t())}function te(o,i){o&1&&(c(),e(0,"svg",68),p(1,"path",3),t())}function re(o,i){o&1&&(e(0,"span"),a(1,"Complete Order"),t())}function ie(o,i){o&1&&(e(0,"span"),a(1,"Processing..."),t())}var $=class o{constructor(i,n,r,d,l){this.orderService=i;this.settingsService=n;this.toastService=r;this.route=d;this.router=l}additionalCosts=[];otherReason="";otherAmount=0;isSubmitting=!1;showSuccessMessage=!1;errorMessage=null;order=new G;ngOnInit(){this.loadOrder()}loadOrder(){let i=this.route.snapshot.paramMap.get("id");i&&w({order:this.orderService.getOrder(i),settings:this.settingsService.getSettings()}).subscribe({next:({order:n,settings:r})=>{if(!n){console.error("Order not found");return}this.order=n,r.driverCosts.forEach(d=>{this.additionalCosts.push({description:d,amount:0})})}})}getTotalAdditionalCosts(){let i=this.additionalCosts.reduce((r,d)=>r+(d.amount||0),0),n=this.otherAmount||0;return i+n}getTotalOrderValue(){return this.order?this.order.rate+this.getTotalAdditionalCosts():0}getPickupAddress(){return this.order?`${this.order.originStreetAddress}, ${this.order.originCity}, ${this.order.originState} ${this.order.originZipcode}`:""}getDeliveryAddress(){return this.order?`${this.order.destinationStreetAddress}, ${this.order.destinationCity}, ${this.order.destinationState} ${this.order.destinationZipcode}`:""}completeOrder(){if(!this.order)return;this.isSubmitting=!0,this.errorMessage=null;let i=[];if(this.additionalCosts.forEach((r,d)=>{if(r.amount>0){let l=new _;l.description=r.description,l.amount=r.amount,i.push(l)}}),this.otherReason&&this.otherAmount>0){let r=new _;r.description=this.otherReason,r.amount=this.otherAmount,i.push(r)}this.order.driverCosts=i,this.order.status="Completed";let n=new H(this.order.id,this.order.driverCosts);this.orderService.completeOrder(n).subscribe(r=>{this.isSubmitting=!1,this.showSuccessMessage=!0,setTimeout(()=>{this.router.navigate(["/driver/current-orders"])},1e3)},r=>{this.toastService.showError("Completing order failed."),this.isSubmitting=!1})}resetForm(){this.additionalCosts.forEach(i=>i.amount=0),this.otherReason="",this.otherAmount=0,this.errorMessage=null}formatCurrency(i){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i)}formatDateTime(i){return i?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).format(new Date(i)):""}getDeliveryDuration(){if(!this.order?.pickupDateAndTime||!this.order?.dropOffDateAndTime)return"";let i=new Date(this.order.pickupDateAndTime),r=new Date(this.order.dropOffDateAndTime).getTime()-i.getTime(),d=Math.round(r/(1e3*60));if(d<60)return`${d} mins`;{let l=Math.floor(d/60),z=d%60;return`${l}h ${z}m`}}getStatusBadgeClass(){if(!this.order)return"bg-gray-100 text-gray-800";switch(this.order.status){case f.NEW:return"bg-blue-100 text-blue-800";case f.ASSIGNED:return"bg-yellow-100 text-yellow-800";case f.ARRIVED_AT_PICKUP:return"bg-orange-100 text-orange-800";case f.EN_ROUTE_TO_DELIVERY:return"bg-purple-100 text-purple-800";case f.DELIVERED:return"bg-green-100 text-green-800";case f.PARTIALLY_DELIVERED:return"bg-amber-100 text-amber-800";default:return"bg-gray-100 text-gray-800"}}static \u0275fac=function(n){return new(n||o)(h(W),h(U),h(V),h(D),h(R))};static \u0275cmp=O({type:o,selectors:[["app-complete-order"]],decls:50,vars:15,consts:[[1,"bg-gradient-to-r","from-green-600","to-green-700","text-white","p-6","rounded-t-xl"],[1,"flex","items-center","gap-3","mb-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-2xl","font-bold"],[1,"text-green-100"],[1,"bg-white","rounded-xl","shadow-sm","p-6","mb-6"],[1,"mb-6"],[1,"flex","items-center","gap-3","mb-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-gray-600","text-sm","mb-4"],[1,"space-y-4"],["class","flex flex-col gap-1",4,"ngFor","ngForOf"],[1,"mt-6","border-t","border-gray-200","pt-4"],[1,"flex","flex-col","gap-3"],[1,"block","font-semibold","text-gray-700"],[1,"text-sm","text-gray-500","mb-2"],["type","text","placeholder","Describe other reason (e.g., Extra loading help, Special equipment)",1,"w-full","border","border-green-200","rounded-lg","p-3","focus:ring-2","focus:ring-green-500","focus:border-green-500",3,"ngModelChange","ngModel"],["type","number","min","0","step","0.01","placeholder","Amount (USD)",1,"w-full","border","border-green-200","rounded-lg","p-3","focus:ring-2","focus:ring-green-500","focus:border-green-500",3,"ngModelChange","ngModel","disabled"],["class","mt-6 p-4 bg-green-50 rounded-lg",4,"ngIf"],["class","mt-6 p-4 bg-gray-50 rounded-lg text-center",4,"ngIf"],["class","bg-white rounded-xl shadow-sm p-6 mb-6",4,"ngIf"],["class","bg-red-50 border border-red-200 rounded-lg p-4 mb-6",4,"ngIf"],["class","bg-green-50 border border-green-200 rounded-lg p-4 mb-6",4,"ngIf"],[1,"text-center"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","text-sm","mb-6"],[1,"flex","gap-4","justify-center"],[1,"px-6","py-3","bg-gray-100","text-gray-700","border","border-gray-300","rounded-lg","hover:bg-gray-200","transition-colors","duration-200","disabled:opacity-50",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline-block","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"px-8","py-3","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-colors","duration-200","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2","shadow-lg","hover:shadow-xl","transform","hover:-translate-y-0.5",3,"click","disabled"],["class","w-5 h-5 animate-spin","fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],["class","w-5 h-5","fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],[4,"ngIf"],[1,"text-xs","text-gray-500","mt-4"],[1,"flex","flex-col","gap-1"],[1,"text-sm","font-medium","text-gray-700"],["type","number","min","0","step","0.01","placeholder","Amount (USD)",1,"w-full","border","border-green-200","rounded-lg","p-3","focus:ring-2","focus:ring-green-500","focus:border-green-500",3,"ngModelChange","ngModel"],[1,"mt-6","p-4","bg-green-50","rounded-lg"],[1,"flex","justify-between","items-center"],[1,"font-medium","text-gray-900"],[1,"text-xl","font-bold","text-green-600"],[1,"mt-6","p-4","bg-gray-50","rounded-lg","text-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-3","text-gray-400"],[1,"text-gray-600","font-medium"],[1,"text-gray-500","text-sm"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"space-y-3"],[1,"flex","justify-between"],[1,"text-gray-600"],[1,"font-medium"],["class","flex justify-between",4,"ngIf"],[1,"border-gray-200"],[1,"flex","justify-between","text-lg","font-bold"],[1,"text-gray-900"],[1,"text-green-600"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[1,"flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-red-500","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-700"],[1,"bg-green-50","border","border-green-200","rounded-lg","p-4","mb-6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-green-500","flex-shrink-0"],[1,"text-green-700"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","animate-spin"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"]],template:function(n,r){n&1&&(e(0,"div",0)(1,"div",1),c(),e(2,"svg",2),p(3,"path",3),t(),g(),e(4,"h1",4),a(5,"Complete Your Order"),t()(),e(6,"p",5),a(7,"Finalize your delivery by adding any additional costs and submitting your completion report"),t()(),e(8,"div",6)(9,"div",7)(10,"div",8),c(),e(11,"svg",9),p(12,"path",10),t(),g(),e(13,"h2",11),a(14,"Additional Costs"),t()(),e(15,"p",12),a(16," Enter any additional expenses you incurred during this delivery. These costs will be added to your base payment and reimbursed accordingly. "),t()(),e(17,"div",13),v(18,Y,4,2,"div",14),t(),e(19,"div",15)(20,"div",16)(21,"label",17),a(22,"Other Expenses"),t(),e(23,"p",18),a(24,"Describe any other expenses not listed above"),t(),e(25,"input",19),C("ngModelChange",function(l){return y(r.otherReason,l)||(r.otherReason=l),l}),t(),e(26,"input",20),C("ngModelChange",function(l){return y(r.otherAmount,l)||(r.otherAmount=l),l}),t()()(),v(27,Z,6,1,"div",21)(28,q,7,0,"div",22),t(),v(29,K,16,3,"div",23)(30,Q,6,1,"div",24)(31,X,6,0,"div",25),e(32,"div",6)(33,"div",26)(34,"h3",27),a(35,"Ready to Complete?"),t(),e(36,"p",28),a(37," Review all details above and click the button below to finalize your order completion "),t(),e(38,"div",29)(39,"button",30),S("click",function(){return r.resetForm()}),c(),e(40,"svg",31),p(41,"path",32),t(),a(42," Reset Form "),t(),g(),e(43,"button",33),S("click",function(){return r.completeOrder()}),v(44,ee,2,0,"svg",34)(45,te,2,0,"svg",35)(46,re,2,0,"span",36)(47,ie,2,0,"span",36),t()(),e(48,"p",37),a(49," By completing this order, you confirm that all information is accurate and the delivery has been completed successfully. "),t()()()),n&2&&(s(18),m("ngForOf",r.additionalCosts),s(7),b("ngModel",r.otherReason),s(),b("ngModel",r.otherAmount),m("disabled",!r.otherReason),s(),m("ngIf",r.getTotalAdditionalCosts()>0),s(),m("ngIf",r.getTotalAdditionalCosts()===0),s(),m("ngIf",r.order),s(),m("ngIf",r.errorMessage),s(),m("ngIf",r.showSuccessMessage),s(8),m("disabled",r.isSubmitting),s(4),m("disabled",r.isSubmitting||r.showSuccessMessage),s(),m("ngIf",r.isSubmitting),s(),m("ngIf",!r.isSubmitting),s(),m("ngIf",!r.isSubmitting),s(),m("ngIf",r.isSubmitting))},dependencies:[k,I,A,P,B,F,j,N,L],encapsulation:2})};export{$ as CompleteOrderComponent};
