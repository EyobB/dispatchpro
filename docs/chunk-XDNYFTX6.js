import{a as p}from"./chunk-DDEBU2FK.js";import{c as j}from"./chunk-7GTRUKFK.js";import{a as H}from"./chunk-NOERRO3T.js";import{d as M,g as $,l as L,m as U,n as F,u as B}from"./chunk-ZE6XRCVF.js";import{a as N}from"./chunk-74GXZ5HC.js";import"./chunk-BCYCRGTW.js";import"./chunk-Z2SYLYEN.js";import"./chunk-XPCCV2FB.js";import{e as P}from"./chunk-3IYQXLZN.js";import"./chunk-Z3DWEABJ.js";import{l as A,m as k,p as R}from"./chunk-RIFGPENF.js";import{$ as u,Ab as _,Bb as O,Db as C,Eb as h,Fb as w,Gb as y,La as s,Ob as b,Qa as E,Qb as S,Rb as V,Va as I,_ as m,_a as g,gb as x,kb as r,lb as i,mb as D,pb as f,sb as v,tb as c,yb as T,zb as n}from"./chunk-OP2CD5JB.js";function K(a,t){a&1&&(r(0,"div",9)(1,"div",10),D(2,"div",11),r(3,"p",12),n(4,"Loading orders\u2026"),i()()())}function W(a,t){a&1&&(r(0,"div",13),n(1," No current orders. "),i())}function Z(a,t){if(a&1&&(r(0,"option",34),n(1),i()),a&2){let e=t.$implicit;x("value",e),s(),_(e)}}function G(a,t){if(a&1){let e=f();r(0,"span",31)(1,"select",32),y("ngModelChange",function(o){m(e);let l=c().$implicit;return w(l.status,o)||(l.status=o),u(o)}),v("change",function(){m(e);let o=c().$implicit,l=c();return u(l.updateOrderStatus(o))}),g(2,Z,2,2,"option",33),i()()}if(a&2){let e=c().$implicit,d=c();s(),h("ngModel",e.status),s(),x("ngForOf",d.getNextStatus(e))}}function z(a,t){if(a&1&&(r(0,"span",31),n(1),i()),a&2){let e=c().$implicit;s(),_(e.status)}}function q(a,t){if(a&1){let e=f();r(0,"button",29),v("click",function(){m(e);let o=c().$implicit,l=c();return u(l.completeOrder(o))}),n(1," Complete Order "),i()}}function J(a,t){if(a&1){let e=f();r(0,"div",14)(1,"div",15)(2,"div",16),n(3),i(),g(4,G,3,2,"span",17)(5,z,2,1,"ng-template",null,0,V),i(),r(7,"div",18)(8,"div")(9,"div",19)(10,"span",20),n(11,"Pickup:"),i(),r(12,"span",21),n(13),b(14,"date"),i()(),r(15,"div",22)(16,"div",23)(17,"div"),n(18),i(),r(19,"div"),n(20),i()(),r(21,"button",24),v("click",function(){let o=m(e).$implicit,l=c();return u(l.copyOriginAddress(o))}),n(22," \u{1F4CB} "),i()()(),r(23,"div")(24,"div",19)(25,"span",20),n(26,"Dropoff:"),i(),r(27,"span",21),n(28),b(29,"date"),i()(),r(30,"div",22)(31,"div",23)(32,"div"),n(33),i(),r(34,"div"),n(35),i()(),r(36,"button",24),v("click",function(){let o=m(e).$implicit,l=c();return u(l.copyDestinationAddress(o))}),n(37," \u{1F4CB} "),i()()()(),r(38,"div",25)(39,"div")(40,"span",21),n(41,"Order #: "),i(),r(42,"span",26),n(43),i()()(),r(44,"div",27)(45,"button",28),v("click",function(){let o=m(e).$implicit,l=c();return u(l.checkIn(o))}),n(46," Check In "),i(),r(47,"button",28),v("click",function(){let o=m(e).$implicit,l=c();return u(l.viewOrder(o))}),n(48," View Details "),i(),r(49,"button",29),v("click",function(){let o=m(e).$implicit,l=c();return u(l.uploadPoD(o))}),n(50," Upload PoD "),i(),g(51,q,2,0,"button",30),i()()}if(a&2){let e=t.$implicit,d=T(6),o=c();s(3),_(e.loadNumber),s(),x("ngIf",!o.isPartiallyDelivered(e))("ngIfElse",d),s(9),_(S(14,15,e.pickupDateAndTime,"EEE, MMM dd HH:mm")),s(5),_(e.originStreetAddress),s(2),C("",e.originCity,", ",e.originState," ",e.originZipcode,""),s(8),_(S(29,18,e.dropOffDateAndTime,"EEE, MMM dd HH:mm")),s(5),_(e.destinationStreetAddress),s(2),C("",e.destinationCity,", ",e.destinationState," ",e.destinationZipcode,""),s(8),_(e.orderNumber),s(8),x("ngIf",o.isReadyToComplete(e))}}function Q(a,t){a&1&&(r(0,"div",13),n(1," No upcoming orders. "),i())}function X(a,t){if(a&1&&(r(0,"option",34),n(1),i()),a&2){let e=t.$implicit;x("value",e),s(),_(e)}}function ee(a,t){if(a&1){let e=f();r(0,"div",35)(1,"div",15)(2,"div",16),n(3),i(),r(4,"span",31)(5,"select",32),y("ngModelChange",function(o){let l=m(e).$implicit;return w(l.status,o)||(l.status=o),u(o)}),v("change",function(){let o=m(e).$implicit,l=c();return u(l.updateOrderStatus(o))}),g(6,X,2,2,"option",33),i()()(),r(7,"div",36)(8,"div",37)(9,"div",38)(10,"span",20),n(11,"Pickup:"),i(),r(12,"span",21),n(13),b(14,"date"),i()(),r(15,"div",39)(16,"div")(17,"div"),n(18),i(),r(19,"div"),n(20),i()(),r(21,"div")(22,"button",40),v("click",function(){let o=m(e).$implicit,l=c();return u(l.copyOriginAddress(o))}),n(23," \u{1F4CB} "),i()()()(),r(24,"div")(25,"div",38)(26,"span",20),n(27,"Dropoff:"),i(),r(28,"span",21),n(29),b(30,"date"),i()(),r(31,"div",39)(32,"div")(33,"div"),n(34),i(),r(35,"div"),n(36),i()(),r(37,"button",40),v("click",function(){let o=m(e).$implicit,l=c();return u(l.copyDestinationAddress(o))}),n(38," \u{1F4CB} "),i()()(),r(39,"div",41)(40,"div",42)(41,"span",21),n(42,"Order #:"),i(),r(43,"span",21),n(44),i()(),r(45,"button",29),v("click",function(){let o=m(e).$implicit,l=c();return u(l.viewOrder(o))}),n(46," View Details "),i()()()()}if(a&2){let e=t.$implicit,d=c();s(3),_(e.loadNumber),s(2),h("ngModel",e.status),s(),x("ngForOf",d.getNextStatus(e)),s(7),O(" ",S(14,14,e.pickupDateAndTime,"EEE, MMM dd HH:mm"),""),s(5),_(e.originStreetAddress),s(2),C("",e.originCity,", ",e.originState," ",e.originZipcode,""),s(9),O(" ",S(30,17,e.dropOffDateAndTime,"EEE, MMM dd HH:mm"),""),s(5),_(e.destinationStreetAddress),s(2),C("",e.destinationCity,", ",e.destinationState," ",e.destinationZipcode,""),s(8),_(e.orderNumber)}}var Y=class a{constructor(t,e,d){this.router=t;this.ordersService=e;this.toastService=d}orders=[];loading=!1;currentOrders=[];upcomingOrders=[];ngOnInit(){this.loadOrders()}getNextStatus(t){switch(t.status){case p.ASSIGNED:return[t.status,p.EN_ROUTE_TO_PICKUP,p.ARRIVED_AT_PICKUP];case p.EN_ROUTE_TO_PICKUP:return[t.status,p.ASSIGNED,p.ARRIVED_AT_PICKUP];case p.ARRIVED_AT_PICKUP:return[t.status,p.EN_ROUTE_TO_DELIVERY];case p.EN_ROUTE_TO_DELIVERY:return[t.status,p.ARRIVED_AT_DELIVERY];default:return[t.status]}}loadOrders(){this.loading=!0,this.ordersService.getDriverOrders().subscribe(t=>{this.orders=t,this.splitOrders(),this.loading=!1},t=>{console.error("Error loading orders:",t),this.toastService.showError("Failed to load orders. Try reloading the app.",5e3),this.loading=!1})}splitOrders(){this.currentOrders=this.orders.filter(t=>t.status===p.EN_ROUTE_TO_PICKUP||t.status===p.ARRIVED_AT_PICKUP||t.status===p.EN_ROUTE_TO_DELIVERY||t.status===p.ARRIVED_AT_DELIVERY||t.status===p.PARTIALLY_DELIVERED),this.upcomingOrders=this.orders.filter(t=>t.status===p.ASSIGNED)}viewOrder(t){this.ordersService.setCurrentOrder(t),this.router.navigate(["/driver/order-detail",t.id])}uploadPoD(t){this.ordersService.setCurrentOrder(t),this.router.navigate(["/driver/upload-pod",t.id])}completeOrder(t){this.ordersService.setCurrentOrder(t),this.router.navigate(["/driver/complete-order",t.id])}copyOriginAddress(t){let e=`${t.originStreetAddress}, ${t.originCity}, ${t.originState} ${t.originZipcode}`;navigator.clipboard.writeText(e),this.toastService.showSuccess("Origin address copied to clipboard",2e3)}copyDestinationAddress(t){let e=`${t.destinationStreetAddress}, ${t.destinationCity}, ${t.destinationState} ${t.destinationZipcode}`;navigator.clipboard.writeText(e),this.toastService.showSuccess("Destination address copied to clipboard",2e3)}checkIn(t){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let d={lat:e.coords.latitude,lon:e.coords.longitude};this.ordersService.driverCheckIn(t.id,d).subscribe(()=>{this.toastService.showSuccess("Check-in successful.",2e3)})},e=>{console.warn("Geolocation error:",e),this.toastService.showError("Check-in failed.",5e3)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4}):this.toastService.showError("Check-in failed.",5e3)}updateOrderStatus(t){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let d={lat:e.coords.latitude,lon:e.coords.longitude};this.ordersService.updateOrderStatus(t.id,t.status,d).subscribe(()=>{this.loadOrders(),this.toastService.showSuccess("Status updated.",2e3)})},e=>{console.warn("Geolocation error:",e),this.ordersService.updateOrderStatus(t.id,t.status).subscribe(()=>{this.loadOrders(),this.toastService.showSuccess("Status updated.",2e3)})},{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4}):this.ordersService.updateOrderStatus(t.id,t.status).subscribe(()=>{this.loadOrders(),this.toastService.showSuccess("Status updated.",2e3)})}isPartiallyDelivered(t){return t.status===p.PARTIALLY_DELIVERED}isReadyToComplete(t){return t.status===p.PARTIALLY_DELIVERED&&t.documents.some(e=>e.documentType==j.POD)}static \u0275fac=function(e){return new(e||a)(E(P),E(H),E(N))};static \u0275cmp=I({type:a,selectors:[["app-driver-orders"]],decls:16,vars:5,consts:[["partiallyDelivered",""],["class","fixed inset-0 z-50 grid place-items-center bg-white/70 backdrop-blur-sm",4,"ngIf"],[1,"max-w-md","mx-auto","pt-0"],[1,"text-2xl","font-bold","text-green-900","mb-4","flex","items-center","gap-2"],[1,"mb-6"],["class","text-gray-500 text-center py-4 bg-gray-50 rounded-lg",4,"ngIf"],["class","mb-3 rounded-xl shadow border border-green-200 bg-green-50 p-2 flex flex-col gap-2",4,"ngFor","ngForOf"],[1,"text-lg","font-semibold","text-blue-800","mb-3","flex","items-center","gap-2"],["class","mb-3 rounded-xl shadow border border-blue-200 bg-blue-50 p-2 flex flex-col gap-2",4,"ngFor","ngForOf"],[1,"fixed","inset-0","z-50","grid","place-items-center","bg-white/70","backdrop-blur-sm"],[1,"flex","flex-col","items-center"],[1,"h-10","w-10","border-4","border-green-600","border-t-transparent","rounded-full","animate-spin"],[1,"mt-3","text-sm","text-gray-700","font-medium"],[1,"text-gray-500","text-center","py-4","bg-gray-50","rounded-lg"],[1,"mb-3","rounded-xl","shadow","border","border-green-200","bg-green-50","p-2","flex","flex-col","gap-2"],[1,"flex","justify-between","items-center"],[1,"font-semibold","text-green-900"],["class","px-2 py-1 rounded text-s font-semibold",4,"ngIf","ngIfElse"],[1,"text-sm","text-gray-700","space-y-3"],[1,"flex","justify-between","items-center","mb-1"],[1,"font-semibold"],[1,"text-xs","text-gray-500"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"text-blue-600","hover:text-blue-800","p-1","ml-2",3,"click"],[1,"flex","justify-between","items-center","pt-2","border-t","border-green-200"],[1,"text-xs","font-medium"],[1,"flex","flex-row","justify-end","mt-2","gap-1"],[1,"bg-blue-600","hover:bg-blue-700","text-white","p-3","rounded","text-s","font-semibold","transition",3,"click"],[1,"bg-green-600","hover:bg-green-700","text-white","p-3","rounded","text-s","font-semibold","transition",3,"click"],["class","bg-green-600 hover:bg-green-700 text-white p-3 rounded text-s font-semibold transition",3,"click",4,"ngIf"],[1,"px-2","py-1","rounded","text-s","font-semibold"],[1,"bg-transparent","border-none","text-right","font-semibold","cursor-pointer","outline-none",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mb-3","rounded-xl","shadow","border","border-blue-200","bg-blue-50","p-2","flex","flex-col","gap-2"],[1,"text-sm","text-gray-700"],[1,"mb-2"],[1,"flex","flex-row","justify-between","gap-2"],[1,"ml-2","flex","flex-row","items-center","gap-2"],[1,"text-blue-600","hover:text-blue-800","p-1",3,"click"],[1,"flex","flex-row","items-center","justify-between","mt-2","gap-1"],[1,"flex","flex-col"]],template:function(e,d){e&1&&(g(0,K,5,0,"div",1),r(1,"div",2)(2,"h2",3)(3,"span"),n(4,"\u{1F69B}"),i(),n(5," Current Orders "),i(),r(6,"div",4),g(7,W,2,0,"div",5)(8,J,52,21,"div",6),i(),r(9,"div")(10,"h3",7)(11,"span"),n(12,"\u{1F4C5}"),i(),n(13," Upcoming Orders "),i(),g(14,Q,2,0,"div",5)(15,ee,47,20,"div",8),i()()),e&2&&(x("ngIf",d.loading),s(7),x("ngIf",d.currentOrders.length===0),s(),x("ngForOf",d.currentOrders),s(6),x("ngIf",d.upcomingOrders.length===0),s(),x("ngForOf",d.upcomingOrders))},dependencies:[A,k,R,B,U,F,L,M,$],encapsulation:2})};export{Y as CurrentOrdersComponent};
