import{a as re}from"./chunk-MSIQXZHU.js";import{a as te}from"./chunk-BI46WA4O.js";import{b as ie}from"./chunk-FAZMLUFE.js";import{a as ne}from"./chunk-VXI25XYZ.js";import{a as $}from"./chunk-6BX5BP67.js";import{a as k,c as Y}from"./chunk-CFVKQP3S.js";import{a as ee}from"./chunk-Q2DN34S2.js";import{b as G,d as J,g as Z,i as H,l as X,m as q,n as K,u as Q}from"./chunk-SVMRWARE.js";import"./chunk-DC5KZ2EN.js";import{a as z}from"./chunk-DA7YCHM5.js";import"./chunk-3TXZS4HG.js";import{a as B}from"./chunk-5R44ZK2D.js";import"./chunk-XPCCV2FB.js";import{c as R,e as A,f as W,j as L}from"./chunk-KA6K7UZ3.js";import"./chunk-GDLZFIOX.js";import{l as U,m as j}from"./chunk-GEVPNXBN.js";import{Ab as T,Bb as w,Cb as b,Db as E,Fa as V,Ja as l,Nb as N,Oa as x,Ta as F,Y as p,Ya as v,Z as u,eb as s,gb as M,hb as C,ib as r,jb as e,kb as P,nb as D,qb as g,rb as f,v as O,vb as I,wb as i,xb as S,yb as _,zb as y}from"./chunk-YSP72ENP.js";function de(o,d){if(o&1&&(r(0,"option",37),i(1),e()),o&2){let t=d.$implicit;s("value",t.id),l(),_(" ",t.name," ")}}function le(o,d){if(o&1&&(r(0,"div",38)(1,"div"),i(2),e(),r(3,"div"),i(4),e()()),o&2){let t=f();l(2),S(t.selectedDriver==null?null:t.selectedDriver.phone),l(2),y("License: ",t.selectedDriver==null?null:t.selectedDriver.licenseState," - ",t.selectedDriver==null?null:t.selectedDriver.licenseNumber,"")}}function ae(o,d){if(o&1&&(r(0,"option",37),i(1),e()),o&2){let t=d.$implicit;s("value",t.id),l(),y(" ",t.plate," - ",t.type," ")}}function se(o,d){if(o&1&&(r(0,"div",38)(1,"div"),i(2),e(),r(3,"div"),i(4),e()()),o&2){let t=f();l(2),S(t.selectedTruck==null?null:t.selectedTruck.type),l(2),_("DOT: ",t.selectedTruck==null?null:t.selectedTruck.dotNumber,"")}}function ce(o,d){if(o&1){let t=D();r(0,"li")(1,"a",41),g("click",function(){let a=p(t).$implicit,c=f(2);return u(c.viewDocument(a))}),i(2),e()()}if(o&2){let t=d.$implicit;l(2),y(" ",t.documentType," (",t.fileName,") ")}}function me(o,d){if(o&1&&(r(0,"div")(1,"ul",39),v(2,ce,3,2,"li",40),e()()),o&2){let t=f();l(2),s("ngForOf",t.order.documents)}}function pe(o,d){if(o&1){let t=D();r(0,"div")(1,"a",42)(2,"span"),i(3,"\u{1F4C4}"),e(),i(4," View PoD Document "),e(),r(5,"button",43),g("click",function(){p(t);let a=f();return u(a.removePod())}),i(6," Remove "),e()()}if(o&2){let t=f();l(),s("href",t.podUrl,V)}}function ue(o,d){o&1&&(r(0,"span"),i(1,"Upload PoD"),e())}function ve(o,d){o&1&&(r(0,"span"),i(1,"Uploading..."),e())}function ge(o,d){if(o&1&&(r(0,"div",48),i(1),e()),o&2){let t=f(2);l(),_(" ",t.uploadError," ")}}function fe(o,d){if(o&1){let t=D();r(0,"div",44),i(1,"No PoD uploaded."),e(),r(2,"input",45,1),g("change",function(a){p(t);let c=f();return u(c.onFileSelected(a))}),e(),r(4,"button",46),g("click",function(){p(t);let a=I(3);return u(a.click())}),v(5,ue,2,0,"span",25)(6,ve,2,0,"span",25),e(),v(7,ge,2,1,"div",47)}if(o&2){let t=f();l(4),s("disabled",t.isUploading),l(),s("ngIf",!t.isUploading),l(),s("ngIf",t.isUploading),l(),s("ngIf",t.uploadError)}}function _e(o,d){if(o&1){let t=D();r(0,"div",49)(1,"div",50)(2,"span",13),i(3),e(),r(4,"input",51),E("ngModelChange",function(a){let c=p(t).$implicit;return b(c.amount,a)||(c.amount=a),u(a)}),e()()()}if(o&2){let t=d.$implicit;M("opacity-60",t.amount===0),l(3),S(t.description),l(),w("ngModel",t.amount)}}function xe(o,d){o&1&&(r(0,"li",57)(1,"span",58),i(2,"\u2022"),e(),i(3," Driver must be selected "),e())}function he(o,d){o&1&&(r(0,"li",57)(1,"span",58),i(2,"\u2022"),e(),i(3," Truck must be selected "),e())}function De(o,d){o&1&&(r(0,"li",57)(1,"span",58),i(2,"\u2022"),e(),i(3," Proof of Delivery (PoD) document must be uploaded "),e())}function Se(o,d){o&1&&(r(0,"li",57)(1,"span",58),i(2,"\u2022"),e(),i(3," PoD # must be entered "),e())}function we(o,d){if(o&1&&(r(0,"div",52)(1,"div",53)(2,"p",54),i(3,"Cannot convert to invoice:"),e(),r(4,"ul",55),v(5,xe,4,0,"li",56)(6,he,4,0,"li",56)(7,De,4,0,"li",56)(8,Se,4,0,"li",56),e()()()),o&2){let t=f();l(5),s("ngIf",!t.order.driverId),l(),s("ngIf",!t.order.truckId),l(),s("ngIf",!t.podUrl),l(),s("ngIf",!t.order.podNumber)}}var oe=class o{constructor(d,t,n,a,c,m,h){this.router=d;this.route=t;this.ordersService=n;this.driversService=a;this.trucksService=c;this.settingsService=m;this.toastService=h}order=new ie;podUrl=null;availableDrivers=[];availableTrucks=[];selectedDriver=null;selectedTruck=null;costTypes=[];isUploading=!1;uploadError=null;showDocumentViewer=!1;currentDocument=new k;ngOnInit(){let d=this.route.snapshot.paramMap.get("id")||"";O({order:this.ordersService.getOrder(d),drivers:this.driversService.getDrivers(),trucks:this.trucksService.getTrucks(),settings:this.settingsService.getSettings()}).subscribe(({order:t,drivers:n,trucks:a,settings:c})=>{this.order=t,this.availableDrivers=n,this.availableTrucks=a,this.onDriverSelect(),this.onTruckSelect(),this.costTypes=c.driverCosts,this.costTypes=c.driverCosts,this.costTypes.forEach(m=>{if(this.order.driverCosts=this.order.driverCosts||[],!this.order.driverCosts.some(h=>h.description===m)){let h=new re;h.description=m,h.amount=0,this.order.driverCosts.push(h)}})})}updateOrder(){this.order.driverId=this.order.driverId||null,this.order.truckId=this.order.truckId||null,this.ordersService.updateOrder(this.order).subscribe(()=>{this.toastService.showSuccess("Order updated successfully")},d=>{console.error("Error updating order:",d)})}assignDriverTruck(){this.ordersService.assignDriver(this.order).subscribe(()=>{this.toastService.showSuccess("Driver and Truck assigned successfully")},d=>{console.error("Error assigning driver and truck:",d)})}markDelivered(){this.order&&(this.order.status="Delivered")}markInTransit(){this.order&&(this.order.status="In Transit")}deleteOrder(){this.order&&confirm("Are you sure you want to delete this order?")&&this.ordersService.deleteOrder(this.order.id).subscribe(()=>{this.toastService.showSuccess("Order deleted successfully"),this.router.navigate(["/dispatcher/orders"])},d=>{console.error("Error deleting order:",d),this.toastService.showError("Failed to delete order")})}onFileSelected(d){let t=d.target.files[0];if(!t)return;if(!["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)){this.uploadError="Please select a valid file (PDF, JPG, PNG, DOC, DOCX)";return}let a=5*1024*1024;if(t.size>a){this.uploadError="File size must be less than 5MB";return}this.uploadPodFile(t)}uploadPodFile(d){this.isUploading=!0,this.uploadError=null;let t=URL.createObjectURL(d);setTimeout(()=>{let n={id:"1",documentType:Y.POD,url:t,fileType:d.type,fileName:d.name,expires:"2025-12-31"};this.order.documents||(this.order.documents=[]),this.order.documents=this.order.documents,this.order.documents.push(n),this.podUrl=t,this.isUploading=!1},1e3)}removePod(){confirm("Are you sure you want to remove the PoD document?")&&(this.order.documents&&(this.order.documents=this.order.documents.filter(d=>d.documentType!=="PoD")),this.podUrl=null)}createInvoice(){this.router.navigate(["/dispatcher/order-to-invoice",this.order.id])}onDriverSelect(){this.selectedDriver=this.availableDrivers.find(d=>d.id===this.order.driverId)??null}onTruckSelect(){this.selectedTruck=this.availableTrucks.find(d=>d.id===this.order.truckId)??null}isValidForInvoice(){return!!(this.order.driverId&&this.order.truckId&&this.podUrl&&this.order.podNumber)}viewDocument(d){this.currentDocument=d,this.showDocumentViewer=!0}closeDocumentViewer(){this.showDocumentViewer=!1,this.currentDocument=new k}onDownloadError(d){console.error("Download failed:",d),this.toastService.showError("Failed to download document")}static \u0275fac=function(t){return new(t||o)(x(A),x(R),x(ee),x(B),x(te),x(ne),x(z))};static \u0275cmp=F({type:o,selectors:[["app-order-detail"]],decls:117,vars:33,consts:[["noPod",""],["fileInput",""],[1,"max-w-3xl","mx-auto","p-6","bg-white","rounded-xl","shadow-lg"],[1,"mb-4"],["routerLink","/dispatcher/orders",1,"text-green-800","hover:underline","flex","items-center","gap-1","font-medium"],[1,"text-xl"],[1,"text-3xl","font-bold","mb-2","text-green-900","flex","items-center","gap-2"],[1,"mb-6","flex","gap-4","text-gray-600"],[1,"bg-gray-100","px-3","py-1","rounded"],[1,"font-medium"],[1,"mb-6","bg-green-50","rounded","p-4"],[1,"font-semibold","text-lg","mb-3","text-green-900","flex","items-center","gap-2","bg-green-100","px-3","py-2","rounded"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"font-semibold"],[1,"mb-6"],[1,"flex","flex-col","sm:flex-row","gap-8"],[1,"flex-1","bg-gray-50","rounded","p-4"],[1,"text-xs","text-gray-500"],[1,"flex-1"],[1,"mt-2"],[1,"w-full","p-2","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-2 p-2 mt-0 pt-0 bg-white rounded shadow-sm text-xs text-gray-900",4,"ngIf"],[3,"click","disabled"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"w-36","p-1","mb-4","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"mb-6","flex-row"],[1,"space-y-0","w-1/2"],["class","bg-gray-50 p-2 rounded transition-colors",3,"opacity-60",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-4","mt-6","items-center"],["class","w-full mb-4",4,"ngIf"],[1,"bg-red-600","hover:bg-red-700","text-white","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"bg-green-600","px-6","py-2","rounded","shadow","font-semibold","transition",3,"click"],[1,"px-6","py-2","rounded","shadow","font-semibold","transition",3,"click","disabled"],[3,"close","downloadError","document","isVisible"],[3,"value"],[1,"mt-2","p-2","mt-0","pt-0","bg-white","rounded","shadow-sm","text-xs","text-gray-900"],[1,"list-disc","pl-5","space-y-1"],[4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"text-blue-500","underline",3,"click"],["target","_blank",1,"text-blue-700","hover:underline","flex","items-center","gap-1","font-medium",3,"href"],[1,"ml-4","bg-red-500","hover:bg-red-600","text-white","px-3","py-1","rounded","text-sm",3,"click"],[1,"text-gray-500","italic","mb-2"],["type","file","accept",".pdf,.jpg,.jpeg,.png,.doc,.docx",1,"hidden",3,"change"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded",3,"click","disabled"],["class","mt-2 text-red-600 text-sm",4,"ngIf"],[1,"mt-2","text-red-600","text-sm"],[1,"bg-gray-50","p-2","rounded","transition-colors"],[1,"flex","justify-between","items-center","mb-1"],["type","number","placeholder","0.00",1,"w-36","p-1","border","rounded","focus:border-green-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"w-full","mb-4"],[1,"bg-red-50","border","border-red-200","rounded","p-3"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","space-y-1"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500"]],template:function(t,n){if(t&1){let a=D();r(0,"div",2)(1,"div",3)(2,"a",4)(3,"span",5),i(4,"\u2190"),e(),i(5," Go Back "),e()(),r(6,"h2",6)(7,"span"),i(8,"\u{1F4E6}"),e(),i(9," Order Details "),e(),r(10,"div",7)(11,"div",8)(12,"span",9),i(13,"Order #:"),e(),i(14),e(),r(15,"div",8)(16,"span",9),i(17,"Load #:"),e(),i(18),e()(),r(19,"div",10)(20,"h3",11)(21,"span"),i(22,"\u{1F464}"),e(),i(23," Customer Information "),e(),r(24,"div",12)(25,"div")(26,"span",13),i(27,"Name:"),e(),i(28),e(),r(29,"div")(30,"span",13),i(31,"Contact:"),e(),i(32),e()()(),r(33,"div",14)(34,"h3",11)(35,"span"),i(36,"\u{1F5FA}\uFE0F"),e(),i(37," Route "),e(),r(38,"div",15)(39,"div",16)(40,"span",13),i(41,"Origin:"),e(),r(42,"div",9),i(43),e(),r(44,"div",17),i(45),e()(),r(46,"div",16)(47,"span",13),i(48,"Destination:"),e(),r(49,"div",9),i(50),e(),r(51,"div",17),i(52),e()()()(),r(53,"div",14)(54,"h3",11)(55,"span"),i(56,"\u{1F4E6}"),e(),i(57," Load Details "),e(),r(58,"div")(59,"span",13),i(60,"Description:"),e(),i(61),e()(),r(62,"div",14)(63,"h3",11)(64,"span"),i(65,"\u{1F9D1}\u200D\u2708\uFE0F"),e(),i(66," Driver & Truck "),e(),r(67,"div",15)(68,"div",18)(69,"span",13),i(70,"Driver: "),e(),r(71,"div",19)(72,"select",20),E("ngModelChange",function(m){return p(a),b(n.order.driverId,m)||(n.order.driverId=m),u(m)}),g("change",function(){return p(a),u(n.onDriverSelect())}),r(73,"option",21),i(74,"Select a driver"),e(),v(75,de,2,2,"option",22),e(),v(76,le,5,3,"div",23),e()(),r(77,"div",18)(78,"span",13),i(79,"Truck: "),e(),r(80,"div",19)(81,"select",20),E("ngModelChange",function(m){return p(a),b(n.order.truckId,m)||(n.order.truckId=m),u(m)}),g("change",function(){return p(a),u(n.onTruckSelect())}),r(82,"option",21),i(83,"Select a truck"),e(),v(84,ae,2,3,"option",22),e(),v(85,se,5,2,"div",23),e()()(),r(86,"button",24),g("click",function(){return p(a),u(n.assignDriverTruck())}),i(87," Assign Driver & Truck "),e()(),r(88,"div",14)(89,"h3",11)(90,"span"),i(91,"\u{1F4C4}"),e(),i(92," Documents "),e(),v(93,me,3,1,"div",25)(94,pe,7,1,"div",26)(95,fe,8,4,"ng-template",null,0,N),e(),r(97,"span",13),i(98,"PoD #:"),e(),P(99,"br"),r(100,"input",27),E("ngModelChange",function(m){return p(a),b(n.order.podNumber,m)||(n.order.podNumber=m),u(m)}),e(),r(101,"div",28)(102,"h3",11)(103,"span"),i(104,"\u{1F4B2}"),e(),i(105," Driver Costs "),e(),r(106,"div",29),v(107,_e,5,4,"div",30),e()(),r(108,"div",31),v(109,we,9,4,"div",32),r(110,"button",33),g("click",function(){return p(a),u(n.deleteOrder())}),i(111," Delete Order "),e(),r(112,"button",34),g("click",function(){return p(a),u(n.updateOrder())}),i(113," Update Order "),e(),r(114,"button",35),g("click",function(){return p(a),u(n.createInvoice())}),i(115," Convert To Invoice "),e()()(),r(116,"app-document-viewer",36),g("close",function(){return p(a),u(n.closeDocumentViewer())})("downloadError",function(m){return p(a),u(n.onDownloadError(m))}),e()}if(t&2){let a=I(96);l(14),_(" ",n.order.orderNumber," "),l(4),_(" ",n.order.loadNumber," "),l(10),_(" ",n.order.brokerName,""),l(4),_(" ",n.order.brokerContact,""),l(11),S(n.order.originStreetAddress),l(2),T("",n.order.originCity,", ",n.order.originState," ",n.order.originZipcode," "),l(5),S(n.order.destinationStreetAddress),l(2),T("",n.order.destinationCity,", ",n.order.destinationState," ",n.order.destinationZipcode,""),l(9),_(" ",n.order.description," "),l(11),w("ngModel",n.order.driverId),l(3),s("ngForOf",n.availableDrivers),l(),s("ngIf",n.order.driverId),l(5),w("ngModel",n.order.truckId),l(3),s("ngForOf",n.availableTrucks),l(),s("ngIf",n.order.truckId),l(),C(!n.order.driverId||!n.order.truckId?"bg-gray-300 text-gray-500 cursor-not-allowed p-2 my-2 rounded":"bg-green-600 hover:bg-green-700 text-white p-2 my-2 rounded"),s("disabled",!n.order.driverId||!n.order.truckId),l(7),s("ngIf",n.order.documents&&n.order.documents.length>0),l(),s("ngIf",n.podUrl)("ngIfElse",a),l(6),w("ngModel",n.order.podNumber),l(7),s("ngForOf",n.order.driverCosts),l(2),s("ngIf",!n.isValidForInvoice()),l(5),C(n.isValidForInvoice()?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),s("disabled",!n.isValidForInvoice()),l(2),s("document",n.currentDocument)("isVisible",n.showDocumentViewer)}},dependencies:[j,U,L,W,Q,q,K,G,H,X,J,Z,$],encapsulation:2})};export{oe as OrderDetailComponent};
